<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Android - How to build a service-enabled Android app - Part 3/3 Multithreading | developerlife.com</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Android - How to build a service-enabled Android app - Part 3/3 Multithreading" />
<meta name="author" content="Nazmul Idris" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve written 3 tutorials to show you how to create a service enabled Android application that performs all of it’s network I/O in a background thread (not the UI thread). These tutorials are split into three parts. This tutorial shows you how to use background threads to perform long running network IO operations, so that the main UI thread is not locked up." />
<meta property="og:description" content="I’ve written 3 tutorials to show you how to create a service enabled Android application that performs all of it’s network I/O in a background thread (not the UI thread). These tutorials are split into three parts. This tutorial shows you how to use background threads to perform long running network IO operations, so that the main UI thread is not locked up." />
<link rel="canonical" href="http://developerlife.com/2008/06/04/how-to-build-a-service-enabled-android-app-part-33-multithreading/" />
<meta property="og:url" content="http://developerlife.com/2008/06/04/how-to-build-a-service-enabled-android-app-part-33-multithreading/" />
<meta property="og:site_name" content="developerlife.com" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-06-04T15:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Android - How to build a service-enabled Android app - Part 3/3 Multithreading" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Nazmul Idris"},"dateModified":"2008-06-04T15:00:00-05:00","datePublished":"2008-06-04T15:00:00-05:00","description":"I’ve written 3 tutorials to show you how to create a service enabled Android application that performs all of it’s network I/O in a background thread (not the UI thread). These tutorials are split into three parts. This tutorial shows you how to use background threads to perform long running network IO operations, so that the main UI thread is not locked up.","headline":"Android - How to build a service-enabled Android app - Part 3/3 Multithreading","mainEntityOfPage":{"@type":"WebPage","@id":"http://developerlife.com/2008/06/04/how-to-build-a-service-enabled-android-app-part-33-multithreading/"},"url":"http://developerlife.com/2008/06/04/how-to-build-a-service-enabled-android-app-part-33-multithreading/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css" />

  <!-- Add favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <!-- Add fontawesome (only for bio.html page) -->
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"
    integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
    crossorigin="anonymous"
  /><link type="application/atom+xml" rel="alternate" href="http://developerlife.com/feed.xml" title="developerlife.com" /><!-- https://developers.google.com/analytics/devguides/collection/gtagjs -->
<script async
        src="https://www.googletagmanager.com/gtag/js?id=G-NQY9ECC58H"></script>
<script>
  window.dataLayer = window.dataLayer || []

  function gtag() {
    window.dataLayer.push(arguments)
  }

  gtag("js", new Date())
  gtag("config", "G-NQY9ECC58H")
</script>
</head>
<body><!-- https://github.com/mermaid-js/mermaid/blob/develop/docs/n00b-gettingStarted.md -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<script>
  // https://mermaid-js.github.io/mermaid/#/theming
  mermaid.initialize({
    startOnLoad: true,
    theme: "dark",
    themeVariables: {
      fontFamily: "Fira Code",
      fontSize: "0.95rem",
      darkMode: true,
      primaryColor: "#2f9ece",
      mainBkg: "#303439",
    },
  })
</script>
<header class="site-header" role="banner">

    <div class="wrapper header-wrapper"><div class="logo-container">
        <div class="logo-image">
          <a class="site-title"
             rel="author"
             href="/">
              <!-- This is the logo image placeholder. -->
                <picture>
                  <source srcset="/assets/dl-logo-icon-dark.svg" media="(max-width: 600px)"/>
                  <img  src="/assets/dl-logo-icon-and-text-dark.svg" />
                </picture>
          </a>
        </div>
      </div><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger"/>
            <label for="nav-trigger">
          <span class="menu-icon">
              <svg class="svg-icon">
              <use xlink:href="/assets/minima-social-icons.svg#menu">
              </use>
            </svg>
          </span>
            </label>

            <div class="trigger"><!--
    Iterate over all the pages in the site, where page_cursor holds the current
    page for each pass of the for loop.
    Note that page is the currently loaded page itself.
--><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Android/"> Android </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CC/"> Concurrency </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CLI/"> CLI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CS/"> CS </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/DB/"> Database </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/DI/"> DI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/FE/"> Frontend </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Hardware/"> Hardware </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/IJ/"> IntelliJ </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/KT/"> Kotlin </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Linux/"> Linux </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/MP/"> MP </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Misc/"> Misc </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Node/"> Node </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Productivity/"> Productivity </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/RN/"> React-Native </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/React/"> React </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Rust/"> Rust </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Server/"> Server </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/State/"> State-Management </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Stories/"> Stories </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TDD/"> Testing </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TS/"> TypeScript </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TUI/"> TUI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Web/"> Web </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/about-me/"> Nazmul Idris </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/about-site/"> About Us </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/authors/"> Authors </a></div>
        </nav></div>
</header>

<!-- Debug to show the value of page.title and page.category variables -->
<!--<pre>page_cursor.exclude = nil</pre>-->
<!--<pre>page.exclude = nil</pre>-->
<!--<pre>page.title = &quot;Android - How to build a service-enabled Android app - Part 3/3 Multithreading&quot;</pre>-->
<!--<pre>page.category = nil</pre>-->
<!--<pre>page.title (json) = Android - How to build a service-enabled Android app - Part 3/3 Multithreading</pre>-->
<!--<pre>page.category (json) = </pre>-->
<div class="page-and-sidebar-wrapper">
      <main class="page-content" aria-label="Content">
        <div class="wrapper"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Android - How to build a service-enabled Android app - Part 3/3 Multithreading</h1>

    <!-- Create all the variables needed for this page (and all the includes) -->
    

    <div class="post-meta">
        <p>
            <!-- Date -->Jun 4, 2008

            <!--Author-->
            ∙ <a href="/about-me">Nazmul Idris</a>

            <!-- One line social blurb --><ul class="contact-list">
    <li class="p-name">Hi, I'm
            <a href="/about-me">Nazmul</a>,
            an ex-Googler, <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tui" target="_blank">r3bl_tui maintainer</a>, SWE, entrepreneur, designer, leader,
            TaiChi-er, racer, storyteller.
            <!-- This is fontawesome icon -->
            I <i class="fas fa-heart"></i>
            leadership, authenticity, play,
            <i class="fas fa-code"></i>,
            <i class="fas fa-terminal"></i>, &
            <i class="fas fa-coffee"></i>,
            😃.</li>
</ul>
</p>
    </div><div class="social-media-container">
  <!-- <iframe
    src="https://github.com/sponsors/nazmulidris/button"
    title="Sponsor nazmulidris"
    height="35"
    width="116"
    style="border: 0; padding-right: 6px"
  ></iframe> -->

  <p class="social-media-item">
    <a
      href="https://discord.gg/PhuF4qFpcA"
      target="_blank"
      title="Join our Discord server for comments, feedback, discussions"
    >
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#discord"></use>
      </svg>
    </a>
  </p>

  <p class="social-media-item">
    <a href="https://r3bl.com/#services" target="_blank" title="Need help with code?">
      <img class="svg-icon" src="https://r3bl.com/images/logo.svg" alt="R3BL Logo">
    </a>
  </p>

  <!-- <a class="social-media-item" href="https://discord.gg/PhuF4qFpcA" target="_blank"
    >Feedback & comments</a
  > -->

  <!-- <a class="social-media-item" href="https://r3bl.com#services" target="_blank"
    >Need help with code?</a
  > --><p class="social-media-item">
    <a
      href="https://www.youtube.com/channel/UCMcsxfCwzwDevc3NRqFgfEg"
      target="_blank"
      title="developerlife.com YouTube channel"
    >
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a
      href="https://www.linkedin.com/in/nazmulidris"
      target="_blank"
      title="Nazmul Idris LinkedIn profile"
    >
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a
      href="https://www.github.com/nazmulidris" target="_blank" title="Nazmul Idris github profile">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#github"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a href="/feed.xml" target="_blank" title="RSS feed">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
      </svg>
    </a>
  </p></div>
</header>
<div class="post-content e-content" itemprop="articleBody">
        <!-- If a page has a hero-image defined in it, then show it here -->


        <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#dont-hog-the-ui-thread">Don’t hog the UI Thread</a></li>
  <li><a href="#running-tasks-in-the-background-thread">Running tasks in the background thread</a></li>
  <li><a href="#download-source-code">Download source code</a></li>
</ul>

<!-- END doctoc generated TOC please keep comment here to allow auto update -->
      <h2 id="introduction">
        
        
          Introduction <a href="#introduction">#</a>
        
        
      </h2>
    

<p>I’ve written 3 tutorials to show you how to create a service enabled Android application that
performs all of it’s <a href="http://hc.apache.org/httpcomponents-core-ga/tutorial/html/">network I/O</a> in a
background thread (not the UI thread). Please note that by service I mean web-service, not Android
Service. These tutorials are split into three parts:</p>

<ol>
  <li>
    <p><a href="https://developerlife.com/2008/06/04/how-to-build-a-service-enabled-android-app-part-13-ui/">How to build a simple UI without using XML, by writing Java code to layout the UI.</a></p>
  </li>
  <li>
    <p><a href="https://developerlife.com/2008/06/04/how-to-build-a-service-enabled-android-app-part-23-networking/">How to use Apache HTTP Client to connect to services over HTTP or HTTPS and exchange serialized Java objects with services.</a></p>
  </li>
  <li>
    <p>How to use background threads to perform long running network IO operations, so that the main UI
thread is not locked up.</p>
  </li>
</ol>
      <h2 id="dont-hog-the-ui-thread">
        
        
          Don’t hog the UI Thread <a href="#dont-hog-the-ui-thread">#</a>
        
        
      </h2>
    

<p>Just like with Swing, or any other single threaded GUI toolkit, in Android,
<a href="https://developerlife.com/2010/10/12/android-event-dispatch-thread-or-main-thread/">you shouldn’t perform long running operations in the UI Thread</a>.
Imagine that there’s the equivalent of the EDT in Android, and it’s called the UI thread. There are
also a <a href="http://developer.android.com/reference/android/os/AsyncTask.html">UI thread utilities</a> class
called AsyncTask, much like SwingUtilities for posting events on this UI thread.</p>
      <h2 id="running-tasks-in-the-background-thread">
        
        
          Running tasks in the background thread <a href="#running-tasks-in-the-background-thread">#</a>
        
        
      </h2>
    

<p>The basic structure of creating code that runs in a background thread is in the GetDataFromServlet
class. If you’ve used SwingWorker before, you should see similarities.</p>

<p>Here’s what the first screen looks like:</p>

<p><img src="/assets/and-1.png" alt="" /></p>

<p>Here’s the code that’s executed in the UI thread (called from the first screen) when the Login
button is pressed:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">NetworkActivity</span> <span class="n">activity</span><span class="o">)</span> <span class="o">{</span>

  <span class="n">_activity</span> <span class="o">=</span> <span class="n">activity</span><span class="o">;</span>

  <span class="n">uid</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">ttfUserid</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
  <span class="n">pwd</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="na">ttfPassword</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

  <span class="c1">// allows non-"edt" thread to be re-inserted into the "edt" queue</span>
  <span class="kd">final</span> <span class="nc">Handler</span> <span class="n">uiThreadCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">();</span>

  <span class="c1">// performs rendering in the "edt" thread, after background operation is complete</span>
  <span class="kd">final</span> <span class="nc">Runnable</span> <span class="n">runInUIThread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">_showInUI</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">};</span>

  <span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">_doInBackgroundPost</span><span class="o">();</span>
      <span class="n">uiThreadCallback</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">runInUIThread</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}.</span><span class="na">start</span><span class="o">();</span>

  <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">_activity</span><span class="o">,</span>
                 <span class="s">"Getting data from servlet"</span><span class="o">,</span>
                 <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Some notes on this code:</p>

<ol>
  <li>
    <p>Essentially a callback handler is created, which is activated when the task in the background
thread completes. This callback handler is inserted into the event queue by using
Handler.post(Runnable). This is similar to using SwingUtilities.invokeLater(Runnable). This
callback handler has a method _showInUI() that will get invoked in the UI thread, when the
background task completes.</p>
  </li>
  <li>
    <p>The long running task is performed in _doInBackgroundPost(). The UI thread just creates a new
thread, and this new thread executes this method and calls the callback handler when it’s done.
Any code in this method will run in the “background thread”, and not the UI thread.</p>
  </li>
  <li>
    <p>Once the background method is complete, the callback handler runs _showInUI() in the UI thread
itself; so any code that goes in that method can block the UI. In this example, this code simply
updates the 2nd screen with the Hashtable it downloaded, which is what it’s supposed to do.</p>
  </li>
  <li>
    <p>The calls to Toast are to display a simple status message that pops up and disappears on it’s
own.</p>
  </li>
</ol>

<p>Here’s the code for _doInBackgroundPost():</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** this method is called in a non-"edt" thread */</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">_doInBackgroundPost</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span> <span class="s">"background task - start"</span><span class="o">);</span>

  <span class="nc">Hashtable</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Hashtable</span><span class="o">();</span>
  <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uid"</span><span class="o">,</span> <span class="n">uid</span><span class="o">);</span>
  <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pwd"</span><span class="o">,</span> <span class="n">pwd</span><span class="o">);</span>

  <span class="k">try</span> <span class="o">{</span>
    <span class="nc">HttpParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicHttpParams</span><span class="o">();</span>

    <span class="c1">// set params for connection...</span>
    <span class="nc">HttpConnectionParams</span><span class="o">.</span><span class="na">setStaleCheckingEnabled</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="nc">HttpConnectionParams</span><span class="o">.</span><span class="na">setConnectionTimeout</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="n">NetworkConnectionTimeout_ms</span><span class="o">);</span>
    <span class="nc">HttpConnectionParams</span><span class="o">.</span><span class="na">setSoTimeout</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="n">NetworkConnectionTimeout_ms</span><span class="o">);</span>
    <span class="nc">DefaultHttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultHttpClient</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>

    <span class="c1">// create post method</span>
    <span class="nc">HttpPost</span> <span class="n">postMethod</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpPost</span><span class="o">(</span><span class="nc">LoginServiceUri</span><span class="o">);</span>

    <span class="c1">// create request entity</span>
    <span class="nc">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
    <span class="nc">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span>
    <span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="nc">ByteArrayEntity</span> <span class="n">req_entity</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayEntity</span><span class="o">(</span><span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
    <span class="n">req_entity</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="nc">MIMETypeConstantsIF</span><span class="o">.</span><span class="na">BINARY_TYPE</span><span class="o">);</span>

    <span class="c1">// associating entity with method</span>
    <span class="n">postMethod</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">req_entity</span><span class="o">);</span>

    <span class="c1">// RESPONSE</span>
    <span class="n">httpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">postMethod</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ResponseHandler</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="nc">Void</span> <span class="nf">handleResponse</span><span class="o">(</span><span class="nc">HttpResponse</span> <span class="n">response</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="nc">ClientProtocolException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">HttpEntity</span> <span class="n">resp_entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">resp_entity</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

          <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">EntityUtils</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">(</span><span class="n">resp_entity</span><span class="o">);</span>
            <span class="nc">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span>
                <span class="k">new</span> <span class="nf">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">ByteArrayInputStream</span><span class="o">(</span><span class="n">data</span><span class="o">));</span>
            <span class="n">dataFromServlet</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Hashtable</span><span class="o">&lt;</span><span class="nc">DataKeys</span><span class="o">,</span> <span class="nc">Serializable</span><span class="o">&gt;)</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span>
                <span class="s">"data size from servlet="</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span>
                <span class="s">"data hashtable from servlet="</span> <span class="o">+</span> <span class="n">dataFromServlet</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
          <span class="o">}</span>
          <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span>
                <span class="s">"problem processing post response"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
          <span class="o">}</span>

        <span class="o">}</span>
        <span class="k">else</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">(</span>
              <span class="k">new</span> <span class="nf">StringBuffer</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"HTTP response : "</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">())</span>
                  <span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">});</span>

  <span class="o">}</span>
  <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
<span class="c1">//    Log.e(getClass().getSimpleName(), "problem encountered", e);</span>
    <span class="nc">StringWriter</span> <span class="n">sw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringWriter</span><span class="o">();</span>
    <span class="nc">PrintWriter</span> <span class="n">pw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="n">sw</span><span class="o">);</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="n">pw</span><span class="o">);</span>
    <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span> <span class="n">sw</span><span class="o">.</span><span class="na">getBuffer</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nc">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">(),</span> <span class="s">"background task - end"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Here’s the code for _showInUI():</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** this method is called in the "edt" */</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">_showInUI</span><span class="o">()</span> <span class="o">{</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
    <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">_activity</span><span class="o">,</span>
                   <span class="s">"Got data from service: "</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span>
                   <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
    <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">_activity</span><span class="o">,</span>
                   <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s">"Error"</span> <span class="o">:</span> <span class="s">"Error - "</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span>
                   <span class="nc">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>

<span class="c1">//  Toast.makeText(_activity,</span>
<span class="c1">//                 "completed background task, rejoining \"edt\"",</span>
<span class="c1">//</span>

  <span class="n">_activity</span><span class="o">.</span><span class="na">_displayUserProfile</span><span class="o">(</span><span class="n">dataFromServlet</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Here’s a screenshot of the 2nd screen:</p>

<p><img src="/assets/and-2.png" alt="" /></p>
      <h2 id="download-source-code">
        
        
          Download source code <a href="#download-source-code">#</a>
        
        
      </h2>
    

<p>To download the source code for this tutorial, <a href="/assets/android.zip">click
here</a>. There are 3 folders in this zip file:</p>

<ol>
  <li>
    <p>AndroidTest – This contains the Android UI and web service client code</p>
  </li>
  <li>
    <p>ServiceTest – This contains the web service, or servlet code</p>
  </li>
  <li>
    <p>SharedTest – This contains the code that is shared between the Android code and web service code.</p>
  </li>
</ol>

        <!--
    Display all the categories for this page
    More info:
    - Tutorial - http://tinyurl.com/yc6fq6zx
    - Liquid language reference - http://tinyurl.com/y8s4qpwo
-->
<div class="categories-block">
    
    
    <span class="category">
            <a href="/category/Android">
                #android</a>
        </span>
    
    <span class="category">
            <a href="/category/CC">
                #cc</a>
        </span>
    
</div>

        
<blockquote>

  👀 Watch Rust 🦀 live coding videos on our <a
  href="https://www.youtube.com/@developerlifecom">YouTube Channel</a>.

  <br/>
  <br/>

  <!-- video on rust polymorphism (no playlist) -->
  <iframe
      src="https://www.youtube.com/embed/kYTgGtJjSro?si=XmW-_CAvCfB5e269"
      title="YouTube video player" frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
      >
  </iframe>

  <br/>
  <br/>

  📦 Install our useful Rust command line apps using <code>cargo install r3bl-cmdr</code>
  (they are from the <a href="https://github.com/r3bl-org/r3bl-open-core">r3bl-open-core</a>
  project):
  <ul>
    <li>🐱<code>giti</code>: run interactive git commands with confidence in your terminal</li>
    <li>🦜<code>edi</code>: edit Markdown with style in your terminal</li>
  </ul>

  <p>
  <kbd>giti in action</kbd>
  <video width="100%" controls>
    <source src="https://github.com/nazmulidris/developerlife.com/assets/2966499/262f59d1-a95c-4af3-accf-c3d6cac6e586" type="video/mp4"/>
  </video>
  </p>

  <p>
  <kbd>edi in action</kbd>
  <video width="100%" controls>
    <source src="https://github.com/nazmulidris/developerlife.com/assets/2966499/f2c4b07d-b5a2-4f41-af7a-06d1b6660c41" type="video/mp4"/>
  </video>
  </p>

  </blockquote>

        <!--
    Display related posts (by category)
    More info:
    - Tutorial - http://tinyurl.com/j5tevq7
    - Liquid language reference - http://tinyurl.com/y9ru5msq
-->
<div class="related-post-block">

    <h3>Related Posts</h3>

    <!-- Get all the related posts into the string `postsString`-->
    
    
    

    <!--
        At this point `postsString` string might look like:
        Post 3|Post 1|Post 3|Post 2|Post 1|Post 3|Post 2|
    -->

    <!-- Remove all the dupes from the `postsString` string, and split it into an array -->
    

    <ul>
        
            
                
                <li>
                    <a class="post-list" href="/2020/07/11/annotation-processing-kotlin-android/">
                        Annotation Processing in Kotlin and Android
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2019/05/11/kotlin-vs-java/">
                        Java vs Kotlin for Android development
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2018/10/21/dagger2-in-depth/">
                        In-depth exploration of Dagger 2
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2018/07/21/designing-for-multiple-screen-densities-on-android/">
                        Designing for multiple screen densities on Android
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/12/07/introduction-to-android-architecture-components/">
                        Introduction to Android Architecture Components
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/12/02/android-downloadable-fonts/">
                        Android Downloadable Fonts
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/07/29/getting-started-with-mediaplayer-on-android/">
                        Getting started with MediaPlayer on Android
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/07/09/android-o-n-and-below-component-lifecycles-and-background-tasks/">
                        Deep dive into Android Services
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/04/26/flexbox-layouts-and-lists-with-react-native/">
                        Flexbox layouts and lists with React Native
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/04/14/navigation-and-styling-with-react-native/">
                        Navigation and Styling with React Native
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/03/31/getting-started-with-react-native/">
                        Getting started with React Native
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/01/27/native-android-redux-and-firebase/">
                        Android, Redux, Firebase Auth &amp; Database, and Material Design
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2010/10/20/gps/">
                        Android Location Providers (gps, network, passive)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2010/10/12/android-event-dispatch-thread-or-main-thread/">
                        Android Event Dispatch Thread or Main Thread
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2009/03/06/using-json-for-mobile-object-exchange/">
                        Using JSON for mobile object exchange
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/08/05/android-animation-framework/">
                        Android Animation Framework Tutorial
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/08/04/android-listview/">
                        Android ListView and custom adapter Tutorial
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/08/04/android-linearlayout/">
                        Android LinearLayout Tutorial
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/07/31/android-ui-themes/">
                        Android UI Themes Tutorial
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/07/29/android-tablelayout/">
                        Android TableLayout Tutorial
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/07/16/option-and-context-menu/">
                        Android Option and Context menu Tutorial
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/07/16/android-xml-view-inflation/">
                        Android XML View inflation Tutorial
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/07/14/android-app-lifecycle-activity-intent-and-service-draft/">
                        Android Activity and sub-Activity Tutorial
                    </a>
                </li>
            
        
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/06/04/how-to-build-a-service-enabled-android-app-part-13-ui/">
                        Android - How to build a service-enabled Android app - Part 1/3 UI
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/06/04/how-to-build-a-service-enabled-android-app-part-23-networking/">
                        Android - How to build a service-enabled Android App - Part 2/3 Networking
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2022/03/12/rust-redux/">
                        Write a Redux library in Rust
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2022/03/12/rust-tokio/">
                        Write code using async/await in Rust
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2019/12/02/project-loom-experiment/">
                        Experimenting w/ Fibers in Project Loom preview
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/05/27/task-api-3-of-5-monitoring-http-post-operations/">
                        Task API (3 of 3) - Monitoring HTTP POST operations
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/04/08/task-api-2-of-5-task-api-in-depth/">
                        Task API (2 of 3) - Task API in-depth
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/04/05/task-api-quick-start-guide/">
                        Task API (1 of 3) - Quick Start Guide
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2007/11/09/swingworker-details-canceling-background-tasks-in-flight/">
                        SwingWorker details - canceling background tasks in flight
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2007/01/08/creating-multi-threaded-swing-apps-that-consume-web-services/">
                        Creating multi-threaded Swing apps that consume web services
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2006/06/09/introduction-to-java-50-javautilconcurrent-api/">
                        Introduction to Java 5 java.util.concurrent API
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2000/09/20/advanced-threads/">
                        Advanced Threads
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2000/09/20/introduction-to-threads/">
                        Introduction to Threads
                    </a>
                </li>
            
        
    </ul>

</div>

        <a class="u-url" href="/2008/06/04/how-to-build-a-service-enabled-android-app-part-33-multithreading/" hidden></a>
    </div></article>
</div>
      </main><div>
  <section class="sidebar">
    <!-- video on intro to testing (with playlist) -->
    <!-- <iframe
      src="https://www.youtube.com/embed/videoseries?si=7gmhXY5DVYJG7OdU&amp;list=PLofhE49PEwmwLR_4Noa0dFOSPmSpIg_l8"
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
    >
    </iframe> -->

    <!-- rust async readline and spinner & playlist -->
    <!-- <iframe
      src="https://www.youtube.com/embed/videoseries?si=i37Ei9nCfvslOoaI&amp;list=PLofhE49PEwmwelPkhfiqdFQ9IXnmGdnSE"
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
    >
    </iframe> -->

    <!-- effective async rust & playlist -->
    <h2 class="star-us-github-heading">
      Subscribe to our
      <a href="https://www.youtube.com/@developerlifecom">YT Channel</a
      ><span class="heading-emoji"> 🦀</span>
    </h2>

    <iframe
    src="https://www.youtube.com/embed/qvIt8MF-pCM?si=S40pbhnvVDAohj-6"
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen>
    </iframe>

    <hr />

    <h2 class="star-us-github-heading">
      <a href="https://r3bl.com#services">Need help with code?</a>
      <span class="heading-emoji"> 💼</span>
    </h2>

    <hr />

    <h2 class="star-us-github-heading">
      Use our crates & apps<span class="heading-emoji"> 📦</span>
    </h2>

    <ul class="sidebar-ul">
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/cmdr" target="_blank">
          <img class="star-icon-img" src="/assets/r3bl-apps.svg" />
          <div class="sidebar-list-item">
            <p class="p-tag">INSTALL & USE OUR APPS (giti, edi)</p>
            <h3 class="sidebar-h3"><code>r3bl-cmdr</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tui" target="_blank">
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TUI LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_tui</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://chromewebstore.google.com/detail/r3bl-shortlink/ffhfkgcfbjoadmhdmdcmigopbfkddial?hl=en-US&gl=US" target="_blank">
          <img class="star-icon-img" src="/assets/r3bl-shortlink.svg" />
          <div class="sidebar-list-item">
            <p class="p-tag">SHORTLINK browser extension</p>
            <h3 class="sidebar-h3"><code>shortlink</code></h3>
          </div>
        </a>
      </li>
      <!-- <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tuify" target="_blank">
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TUIFY LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_tuify</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a
          href="https://github.com/r3bl-org/r3bl-open-core/tree/main/terminal_async"
          target="_blank"
        >
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TERMINAL ASYNC LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_terminal_async</code></h3>
          </div>
        </a>
      </li> -->
    </ul>

    <hr />

    <h2 class="star-us-github-heading">
      To provide feedback & comments, join our <a href="https://discord.gg/PhuF4qFpcA">Discord</a>
      <span class="heading-emoji"> 💬</span>
    </h2>

  </section>
</div>
</div><footer class="site-footer h-card">

    <div class="wrapper">

        <div class="footer-col-wrapper">

            <div class="footer-col"><!-- <p>
    developerlife.com site was started in Nov 1998 with coverage for
    topics related to Java, XML, and web and desktop technologies.
    Today it covers Kotlin, TypeScript, Node.js, React, Android, JDK,
    Web, Cloud technologies, User Experience Engineering (UXE)
    and design topics. © Nazmul Idris 1996-2025. All rights reserved.
</p> -->
<div>
  <p class="footer-p">
    developerlife.com site was started in Nov 1998 by <a
    href="https://developerlife.com/about-me/">Nazmul Idris</a>, with coverage for topics
    related to Java, XML, and web and desktop technologies. Today it covers Rust, TUI,
    CLI, Kotlin, TypeScript, Node.js, React, Android, JDK, Web, Cloud technologies, User
    Experience Engineering (UXE) and design topics. © Nazmul Idris 1996-2025. All rights
    reserved.
  </p>

  <!--
  <div class="footer-container">

    <kbd>
      <a class="footer-elem-2" href="https://r3bl.com#services" target="_blank">Need help with code?</a>
    </kbd>

    <kbd>
      <a class="footer-elem-1" href="/subscribe.html" target="_blank"
        >Newsletter</a
      >
    </kbd>

  </div>
  -->
</div>
</div>

        </div>

    </div>

</footer>
<script>
//open external links in a new window
function external_new_window() {
    for(var c = document.getElementsByTagName("a"), a = 0;a < c.length;a++) {
    var b = c[a];
    b.getAttribute("href") && b.hostname !== location.hostname && (b.target = "_blank")
    }
}
//open PDF links in a new window
function pdf_new_window ()
{
    if (!document.getElementsByTagName) return false;
    var links = document.getElementsByTagName("a");
    for (var eleLink=0; eleLink < links.length; eleLink ++) {
    if ((links[eleLink].href.indexOf('.pdf') !== -1)||(links[eleLink].href.indexOf('.doc') !== -1)||(links[eleLink].href.indexOf('.docx') !== -1)) {
        links[eleLink].onclick =
        function() {
            window.open(this.href);
            return false;
        }
    }
    }
} 
pdf_new_window()
external_new_window();
</script></body>
</html>
