<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4) | developerlife.com</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4)" />
<meta name="author" content="Nazmul Idris" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This handbook will take you thru using function components in React and Redux (using TypeScript) and writing tests for them (using react-testing-library). IDEA Ultimate / Webstorm project files are provided. This handbook is written as a reference. You can easily jump to the section that is relevant to you or read them in any order that you like." />
<meta property="og:description" content="This handbook will take you thru using function components in React and Redux (using TypeScript) and writing tests for them (using react-testing-library). IDEA Ultimate / Webstorm project files are provided. This handbook is written as a reference. You can easily jump to the section that is relevant to you or read them in any order that you like." />
<link rel="canonical" href="http://developerlife.com/2021/10/19/react-hooks-redux-typescript-handbook/" />
<meta property="og:url" content="http://developerlife.com/2021/10/19/react-hooks-redux-typescript-handbook/" />
<meta property="og:site_name" content="developerlife.com" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-19T09:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Nazmul Idris"},"dateModified":"2021-10-19T09:00:00-05:00","datePublished":"2021-10-19T09:00:00-05:00","description":"This handbook will take you thru using function components in React and Redux (using TypeScript) and writing tests for them (using react-testing-library). IDEA Ultimate / Webstorm project files are provided. This handbook is written as a reference. You can easily jump to the section that is relevant to you or read them in any order that you like.","headline":"React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4)","mainEntityOfPage":{"@type":"WebPage","@id":"http://developerlife.com/2021/10/19/react-hooks-redux-typescript-handbook/"},"url":"http://developerlife.com/2021/10/19/react-hooks-redux-typescript-handbook/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css" />

  <!-- Add favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <!-- Add font awesome -->
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"
    integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
    crossorigin="anonymous"
  />

  <!-- Add Google fonts-->
  <link
    href="https://fonts.googleapis.com/css?family=Spline+Sans|Work+Sans|Fira+Mono|Fira+Sans|Google+Sans|Lexend+Deca&display=swap"
    rel="stylesheet"
  /><link type="application/atom+xml" rel="alternate" href="http://developerlife.com/feed.xml" title="developerlife.com" /><!-- https://developers.google.com/analytics/devguides/collection/gtagjs -->
<script async
        src="https://www.googletagmanager.com/gtag/js?id=G-NQY9ECC58H"></script>
<script>
  window.dataLayer = window.dataLayer || []

  function gtag() {
    window.dataLayer.push(arguments)
  }

  gtag("js", new Date())
  gtag("config", "G-NQY9ECC58H")
</script>
<!-- https://us14.admin.mailchimp.com/account/connected-sites/site-detail/ -->

<script id="mcjs">
  !(function (c, h, i, m, p) {
    ;(m = c.createElement(h)),
      (p = c.getElementsByTagName(h)[0]),
      (m.async = 1),
      (m.src = i),
      p.parentNode.insertBefore(m, p)
  })(
    document,
    "script",
    "https://chimpstatic.com/mcjs-connected/js/users/c2470ddfa863eb8ace707651b/2bb3bcad193ef862398700457.js"
  )
</script>
</head>
<body><!-- https://github.com/mermaid-js/mermaid/blob/develop/docs/n00b-gettingStarted.md -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<script>
  // https://mermaid-js.github.io/mermaid/#/theming
  mermaid.initialize({
    startOnLoad: true,
    theme: "dark",
    themeVariables: {
      fontFamily: "Fira Code",
      fontSize: "0.95rem",
      darkMode: true,
      primaryColor: "#2f9ece",
      mainBkg: "#303439",
    },
  })
</script>
<header class="site-header" role="banner">

    <div class="wrapper header-wrapper"><div class="logo-container">
        <div class="logo-image">
          <a class="site-title"
             rel="author"
             href="/">
              <!-- This is the logo image placeholder. -->
                <picture>
                  <source srcset="/assets/dl-logo-icon-dark.svg" media="(max-width: 600px)"/>
                  <img  src="/assets/dl-logo-icon-and-text-dark.svg" />
                </picture>
          </a>
        </div>
      </div><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger"/>
            <label for="nav-trigger">
          <span class="menu-icon">
              <svg class="svg-icon">
              <use xlink:href="/assets/minima-social-icons.svg#menu">
              </use>
            </svg>
          </span>
            </label>

            <div class="trigger"><!--
    Iterate over all the pages in the site, where page_cursor holds the current
    page for each pass of the for loop.
    Note that page is the currently loaded page itself.
--><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Android/"> Android </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CC/"> Concurrency </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CLI/"> CLI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CS/"> CS </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/DB/"> Database </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/DI/"> DI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/FE/"> Frontend </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Hardware/"> Hardware </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/IJ/"> IntelliJ </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/KT/"> Kotlin </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Linux/"> Linux </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/MP/"> MP </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Misc/"> Misc </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Node/"> Node </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Productivity/"> Productivity </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/RN/"> React-Native </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/React/"> React </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Rust/"> Rust </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Server/"> Server </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/State/"> State-Management </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Stories/"> Stories </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TDD/"> Testing </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TS/"> TypeScript </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TUI/"> TUI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Web/"> Web </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/about-me/"> Nazmul Idris </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/about-site/"> About Us </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/authors/"> Authors </a></div>
        </nav></div>
</header>

<!-- Debug to show the value of page.title and page.category variables -->
<!--<pre>page_cursor.exclude = nil</pre>-->
<!--<pre>page.exclude = nil</pre>-->
<!--<pre>page.title = &quot;React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4)&quot;</pre>-->
<!--<pre>page.category = nil</pre>-->
<!--<pre>page.title (json) = React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4)</pre>-->
<!--<pre>page.category (json) = </pre>-->
<div class="page-and-sidebar-wrapper">
      <main class="page-content" aria-label="Content">
        <div class="wrapper"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4)</h1>

    <!-- Create all the variables needed for this page (and all the includes) -->
    

    <div class="post-meta">
        <p>
            <!-- Date -->Oct 19, 2021

            <!--Author-->
            ∙ <a href="/about-me">Nazmul Idris</a>

            <!-- One line social blurb --><ul class="contact-list">
    <li class="p-name">Hi, I'm
            <a href="/about-me">Nazmul</a>,
            an ex-Googler, <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tui" target="_blank">r3bl_tui maintainer</a>, SWE, entrepreneur, designer, leader,
            TaiChi-er, racer, storyteller.
            <!-- This is font awesome icon -->
            I <i class="fas fa-heart"></i>
            leadership, authenticity, empowerment, lifelong learning,
            <i class="fas fa-code"></i>,
            <i class="fas fa-terminal"></i>, &
            <i class="fas fa-coffee"></i>,
            😃.</li>
</ul>
</p>
    </div><div class="social-media-container">
  <!-- <iframe
    src="https://github.com/sponsors/nazmulidris/button"
    title="Sponsor nazmulidris"
    height="35"
    width="116"
    style="border: 0; padding-right: 6px"
  ></iframe> -->

  <a href="/subscribe.html" target="_blank"
    ><kbd>Subscribe for updates</kbd></a
  ><p class="social-media-item">
    <a
      href="https://www.linkedin.com/in/nazmulidris"
      target="_blank"
    >
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a href="https://www.youtube.com/channel/UCMcsxfCwzwDevc3NRqFgfEg" target="_blank">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a href="https://www.github.com/nazmulidris" target="_blank">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#github"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a href="/feed.xml" target="_blank">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
      </svg>
    </a>
  </p></div>
</header>
<div class="post-content e-content" itemprop="articleBody">
        
<blockquote>

👀 Watch Rust 🦀 live coding videos on our <a
href="https://www.youtube.com/@developerlifecom">YouTube Channel</a>.

<br/>

<iframe width="560" height="315"
  src="https://www.youtube.com/embed/videoseries?si=7gmhXY5DVYJG7OdU&amp;list=PLofhE49PEwmwLR_4Noa0dFOSPmSpIg_l8"
  title="YouTube video player" frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
</iframe>

</blockquote>

        <!-- If a page has a hero-image defined in it, then show it here -->


        <p><img class="post-hero-image" src="/assets/react-hooks-handbook.svg" /></p>

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#react">React</a></li>
  <li><a href="#react-hooks">React Hooks</a>
    <ul>
      <li><a href="#why">Why?</a></li>
      <li><a href="#limitations-when-using-hooks-must-follow-these-rules">Limitations when using hooks (must follow these rules)</a></li>
      <li><a href="#example-w-explanation-of-react-memory-model">Example w/ explanation of React memory model</a></li>
      <li><a href="#useeffect">useEffect</a>
        <ul>
          <li><a href="#first-render-and-subsequent-re-renders-using-useref-and-useeffect">First render and subsequent re-renders using useRef and useEffect</a></li>
        </ul>
      </li>
      <li><a href="#usestate">useState</a>
        <ul>
          <li><a href="#example">Example</a></li>
          <li><a href="#shared-stateful-logic-vs-shared-state">Shared stateful logic vs shared state</a></li>
          <li><a href="#resources">Resources</a></li>
        </ul>
      </li>
      <li><a href="#usereducer">useReducer</a>
        <ul>
          <li><a href="#two-examples-one-wout-network-and-one-w-network">Two examples (one w/out network, and one w/ network)</a></li>
        </ul>
      </li>
      <li><a href="#usecallback-and-usememo">useCallback and useMemo</a></li>
      <li><a href="#how-to-write-complex-function-components">How to write complex function components</a></li>
      <li><a href="#custom-hooks">Custom hooks</a></li>
      <li><a href="#references-about-hooks">References about hooks</a></li>
    </ul>
  </li>
  <li><a href="#keyboard-focus-and-react">Keyboard focus and React</a>
    <ul>
      <li><a href="#declarative">Declarative</a></li>
      <li><a href="#imperative-using-useref">Imperative using useRef</a></li>
    </ul>
  </li>
  <li><a href="#react-and-css">React and CSS</a>
    <ul>
      <li><a href="#css-modules-example">CSS Modules example</a></li>
      <li><a href="#styled-component-example">Styled component example</a>
        <ul>
          <li><a href="#tooltipoverlay-w-just-css">TooltipOverlay w/ just CSS</a></li>
          <li><a href="#tooltipoverlay-w-just-react">TooltipOverlay w/ just React</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#react-and-svg">React and SVG</a>
    <ul>
      <li><a href="#references-on-svg-and-react">References on SVG and React</a></li>
    </ul>
  </li>
  <li><a href="#redux">Redux</a>
    <ul>
      <li><a href="#step-1---define-the-types-for-the-state-action-then-use-them-to-create-a-reducer-function">Step 1 - Define the types for the state, action, then use them to create a reducer function</a>
        <ul>
          <li><a href="#no-side-effects-pure-functions-only">No side effects, pure functions only</a></li>
        </ul>
      </li>
      <li><a href="#step-2---create-a-store-that-uses-this-reducer-function">Step 2 - Create a store that uses this reducer function</a></li>
      <li><a href="#step-3---wrap-the-components-that-will-share-this-state-with-a-provider-tag">Step 3 - Wrap the component(s) that will share this state with a Provider tag</a></li>
      <li><a href="#step-4---subscribe-your-components-to-the-store-with-useselector-hook">Step 4 - Subscribe your component(s) to the store with useSelector hook</a></li>
      <li><a href="#step-5---make-sure-to-dispatch-actions-in-your-components-to-change-shared-state">Step 5 - Make sure to dispatch actions in your component(s) to change shared state</a></li>
      <li><a href="#immutability">Immutability</a></li>
      <li><a href="#selectors">Selectors</a>
        <ul>
          <li><a href="#useselector-hook-and-react">useSelector hook and React</a></li>
        </ul>
      </li>
      <li><a href="#split-and-combine-reducers">Split and combine reducers</a></li>
      <li><a href="#enhancer">Enhancer</a>
        <ul>
          <li><a href="#intercept-action-dispatch">Intercept action dispatch</a></li>
          <li><a href="#intercept-state-creation">Intercept state creation</a></li>
          <li><a href="#combining-both-overrides">Combining both overrides</a></li>
        </ul>
      </li>
      <li><a href="#middleware">Middleware</a></li>
      <li><a href="#async-logic-and-data-fetching">Async logic and data fetching</a>
        <ul>
          <li><a href="#redux-thunk-middleware">Redux “Thunk” middleware</a></li>
        </ul>
      </li>
      <li><a href="#memoized-selectors-and-reselect">Memoized selectors and Reselect</a></li>
      <li><a href="#undo-history">Undo history</a>
        <ul>
          <li><a href="#data-structure-and-algorithm">Data structure and algorithm</a></li>
          <li><a href="#naive-implementation">Naive implementation</a></li>
          <li><a href="#using-the-redux-undo-package">Using the redux-undo package</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#testing-with-react-testing-library">Testing with react-testing-library</a>
    <ul>
      <li><a href="#use-rtl-instead-of-enzyme">Use RTL instead of Enzyme</a></li>
      <li><a href="#install-the-required-packages-for-rtl">Install the required packages for RTL</a></li>
      <li><a href="#basic-unit-tests">Basic unit tests</a></li>
      <li><a href="#complex-unit-tests">Complex unit tests</a></li>
      <li><a href="#basic-ui-tests">Basic UI tests</a></li>
      <li><a href="#complex-ui-tests">Complex UI tests</a></li>
      <li><a href="#writing-integration-tests">Writing integration tests</a>
        <ul>
          <li><a href="#install-msw-package">Install msw package</a></li>
          <li><a href="#mocking-the-server-rest-api-endpoints">Mocking the server (REST API endpoints)</a></li>
          <li><a href="#testing-the-mocked-server-rest-api-endpoints-itself">Testing the mocked server (REST API endpoints) itself</a></li>
          <li><a href="#using-the-mocked-server-in-a-ui-test">Using the mocked server in a UI test</a></li>
        </ul>
      </li>
      <li><a href="#writing-snapshot-tests">Writing snapshot tests</a></li>
    </ul>
  </li>
  <li><a href="#data-apis-for-development">Data APIs for development</a></li>
  <li><a href="#debugging-in-webstorm-or-idea-ultimate">Debugging in Webstorm or IDEA Ultimate</a></li>
  <li><a href="#upgrade-cra-itself-to-the-latest-version">Upgrade CRA itself to the latest version</a></li>
  <li><a href="#using-cra-and-environment-variables">Using CRA and environment variables</a></li>
  <li><a href="#css-reset">CSS Reset</a></li>
  <li><a href="#using-css-class-pseudo-selectors-to-style-child-elements-of-a-parent">Using CSS class pseudo selectors to style child elements of a parent</a></li>
  <li><a href="#composition-over-inheritance">Composition over inheritance</a></li>
  <li><a href="#callable">Callable</a></li>
  <li><a href="#typescript-namespaces">TypeScript namespaces</a></li>
  <li><a href="#typescript-readonly-vs-readonlyarray">TypeScript readonly vs ReadonlyArray</a></li>
  <li><a href="#typescript-prop-and-state-types">TypeScript prop and state types</a></li>
  <li><a href="#typescript-and-reactnode-reactelement-jsxelement">TypeScript and ReactNode, ReactElement, JSX.Element</a></li>
  <li><a href="#typescript-types-in-array-and-object-destructuring">TypeScript types in array and object destructuring</a></li>
</ul>

<!-- END doctoc generated TOC please keep comment here to allow auto update -->
      <h2 id="introduction">
        
        
          Introduction <a href="#introduction">#</a>
        
        
      </h2>
    

<p>This handbook and its accompanying TypeScript <a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro">code</a> is a reference guide on how
to use React Hooks with TypeScript (and write tests for them using react-testing-library).</p>

<ol>
  <li>This is not a React primer, and is primarily aimed at developers who know React class
components and want to learn to use Hooks to create function components using
TypeScript.</li>
  <li>You can jump directly to any topic in the table of contents that you are curious about
in this handbook, you don’t have to read it from start to finish.</li>
</ol>

<blockquote>
  <p>⚡ The source code for this handbook can be found in this <a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro">github repo</a>.</p>
</blockquote>

<blockquote>
  <p>💡 The source code project accompanying this handbook created using
<a href="https://github.com/facebook/create-react-app"><code class="language-plaintext highlighter-rouge">create-react-app</code> or CRA</a>.</p>
</blockquote>
      <h2 id="react">
        
        
          React <a href="#react">#</a>
        
        
      </h2>
    

<p>To learn more about how React actually works and generates Virtual DOM objects which are
then rendered to the actual DOM, please refer to this great
<a href="https://youtu.be/CGpMlWVcHok">video on how to create a custom React renderer</a>. Here’s the
github repo for the toy <a href="https://github.com/sophiebits/react-dom-mini">React DOM Mini</a>.</p>
      <h2 id="react-hooks">
        
        
          React Hooks <a href="#react-hooks">#</a>
        
        
      </h2>
    

<p>React hooks exist because there were severe limitations in versions before React 16 on
what function components could do. And there were some problems w/ how class components
function. By adding hooks to function components, it basically eliminates these 2 groups
of problems.</p>
      <h3 id="why">
        
        
          Why? <a href="#why">#</a>
        
        
      </h3>
    

<p>Here are the details on the problems w/ class components mentioned above. It is difficult
to reuse stateful logic between components, which results in people doing things like:</p>

<ul>
  <li><a href="https://reactjs.org/docs/render-props.html">render props</a>: Passing functions down the
component hierarchy as via props is cumbersome. However, there are situations where this
can’t be avoided.</li>
  <li><a href="https://reactjs.org/docs/higher-order-components.html">higher-order components</a>: State
can be stored at the top most component in the hierarchy in order to be shared between
children components, which makes it necessary to add “artificial” components at the top
most level (to have a shared scope in the children) just to wrap everything else
underneath it, which is not optimal.</li>
</ul>

<p>With hooks, it is now possible to reuse stateful logic between function components! Thru
the use of <code class="language-plaintext highlighter-rouge">useState</code> hook and others, you can create your own more complex hooks. The
official docs have <a href="https://reactjs.org/docs/hooks-overview.html">Hooks at a Glance</a> which
is a great overview of hooks along w/ an example of how you can make your own.</p>
      <h3 id="limitations-when-using-hooks-must-follow-these-rules">
        
        
          Limitations when using hooks (must follow these rules) <a href="#limitations-when-using-hooks-must-follow-these-rules">#</a>
        
        
      </h3>
    

<p>Read this <a href="https://reactjs.org/docs/hooks-rules.html#explanation">deep dive</a> on how hooks
are implemented and follow these <a href="https://reactjs.org/docs/hooks-rules.html">rules</a>. Hooks
in functional components get turned into objects that are stored in a linked list inside
of a <a href="https://github.com/acdlite/react-fiber-architecture">fiber</a> (which is an object
representation of the DOM that each React component has).</p>

<blockquote>
  <p>💡 More info on
<a href="https://blog.ag-grid.com/inside-fiber-an-in-depth-overview-of-the-new-reconciliation-algorithm-in-react/">React fibers</a>.</p>
</blockquote>

<ol>
  <li>By following these rules:</li>
  <li>You ensure that Hooks are called in the same order each time a component renders.</li>
  <li>You ensure that all stateful logic in a component is clearly visible from its source
code.</li>
  <li>Hooks should not be called in loops, nested functions or conditions. Instead, always
use Hooks at the top level of your React function, before any early returns.</li>
  <li>Don’t call Hooks from regular JavaScript functions.</li>
  <li>React function components can call Hooks.</li>
  <li>Custom Hooks can call other Hooks.</li>
  <li>If we want to run an effect conditionally, we can put that condition <em>inside</em> our Hook.
    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">name</span> <span class="o">!==</span> <span class="dl">""</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">name_field</span><span class="dl">"</span><span class="p">,</span> <span class="nx">name</span><span class="p">)))</span>
</code></pre></div>    </div>
  </li>
</ol>
      <h3 id="example-w-explanation-of-react-memory-model">
        
        
          Example w/ explanation of React memory model <a href="#example-w-explanation-of-react-memory-model">#</a>
        
        
      </h3>
    

<p>Here’s an example from the React official docs.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>

<span class="cm">/** Custom hook. */</span>
<span class="kd">function</span> <span class="nf">useFriendStatus</span><span class="p">(</span><span class="nx">friendID</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">isOnline</span><span class="p">,</span> <span class="nx">setIsOnline</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

  <span class="kd">function</span> <span class="nf">handleStatusChange</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">setIsOnline</span><span class="p">(</span><span class="nx">status</span><span class="p">.</span><span class="nx">isOnline</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ChatAPI</span><span class="p">.</span><span class="nf">subscribeToFriendStatus</span><span class="p">(</span><span class="nx">friendID</span><span class="p">,</span> <span class="nx">handleStatusChange</span><span class="p">)</span>
    <span class="k">return </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">ChatAPI</span><span class="p">.</span><span class="nf">unsubscribeFromFriendStatus</span><span class="p">(</span><span class="nx">friendID</span><span class="p">,</span> <span class="nx">handleStatusChange</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>

  <span class="k">return</span> <span class="nx">isOnline</span> <span class="c1">// This comes from `useState()`.</span>
<span class="p">}</span>

<span class="c1">// FC.</span>
<span class="kd">function</span> <span class="nf">FriendStatus</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">isOnline</span> <span class="o">=</span> <span class="nf">useFriendStatus</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">friend</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>

  <span class="k">if </span><span class="p">(</span><span class="nx">isOnline</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">Loading...</span><span class="dl">"</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">isOnline</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Online</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Offline</span><span class="dl">"</span>
<span class="p">}</span>

<span class="c1">// FC.</span>
<span class="kd">function</span> <span class="nf">FriendListItem</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">isOnline</span> <span class="o">=</span> <span class="nf">useFriendStatus</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">friend</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">li</span> <span class="na">style</span><span class="p">=</span><span class="si">{</span><span class="nf">getColor</span><span class="p">(</span><span class="nx">isOnline</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">friend</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

  <span class="kd">function</span> <span class="nf">getColor</span><span class="p">(</span><span class="nx">isOnline</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">color: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">isOnline</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">green</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">black</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here are some notes on the code to understand what is happening here and how to think
about state in a function component, and how that maps to React’s memory model.</p>

<ol>
  <li>
    <p>With classes, it was easier to understand React’s memory model, because a stateful
class component has a constructor, which then allocates the state up front.
<code class="language-plaintext highlighter-rouge">ReactDOM.render(virtualDom, actualDom)</code> actually takes the <code class="language-plaintext highlighter-rouge">JSX.Element</code> that this
class component represents, and mounts and renders it. Then there are subsequent
re-renders which is where state actually comes into play. In hooks, this part is a
little bit confusing, since there is no constructor. Here’s one way to think about it.</p>
  </li>
  <li>The first time the function component is rendered (after being mounted), React will
allocate any state variables that are declared via calls to <code class="language-plaintext highlighter-rouge">useState()</code>. This is
stored in memory by React and the initial value is the argument passed to
<code class="language-plaintext highlighter-rouge">useState(initialValue)</code>.</li>
  <li>This is also why React cares that these calls should not be wrapped in conditional
logic or loops, because it relies on the lexical order in which these <code class="language-plaintext highlighter-rouge">useState()</code>
calls are declared to do internal bookkeeping to figure out what the values of each
stateful variable is (in its <a href="https://www.newline.co/@CarlMungazi/a-journey-through-the-usestate-hook--a4983397">internal memory model</a>).</li>
  <li>
    <p>When the setter returned by <code class="language-plaintext highlighter-rouge">useState&lt;T&gt;(initialValue:T)</code> which is of type
<code class="language-plaintext highlighter-rouge">Dispatch&lt;SetStateAction&lt;T&gt;&gt;</code>, is called w/ a new value, it will trigger a re-render. A
function can also be passed to <code class="language-plaintext highlighter-rouge">useState&lt;T&gt;(initialValue:(T)=&gt;T)</code> which will compute
the subsequent value based on the previous state’s value. When a re-render is triggered
then the new value of this state will be used to generate the UI.</p>
  </li>
  <li>
    <p>Note that when stateful logic is reused, the state of each component is completely
independent. Hooks are a way to reuse stateful logic, not state itself. In fact, each
call to a Hook has a completely isolated state — so you can even use the same custom
Hook twice in one component.</p>
  </li>
  <li>Custom Hooks are more of a convention than a feature. If a function’s name starts with
”use” and it calls other Hooks, we say it is a custom Hook. The “useSomething” naming
convention is how the linter plugin is able to find bugs in the code using Hooks.</li>
</ol>
      <h3 id="useeffect">
        
        
          useEffect <a href="#useeffect">#</a>
        
        
      </h3>
    

<p>This <a href="https://reactjs.org/docs/hooks-effect.html">hook</a> is kind of <code class="language-plaintext highlighter-rouge">componentDidMount</code>,
<code class="language-plaintext highlighter-rouge">componentDidUpdate</code>, and <code class="language-plaintext highlighter-rouge">componentWillUnmount</code> combined!</p>

<p>It allows you to register a function that is called whenever anything is rendered to the
DOM on the page. And it can be scoped to an array of dependencies (which are state
variables that can change in order to trigger this effect to be run).</p>

<blockquote>
  <ol>
    <li>Read the
<a href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects">official docs</a>
to get the details.</li>
    <li>This <a href="https://stackoverflow.com/a/53974039/2085356">SO thread</a> also has some good
insight on how to use this hook.</li>
  </ol>
</blockquote>

<p>Here is an example that mimics <code class="language-plaintext highlighter-rouge">componentDidMount</code>.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">ReactReplayFunctionComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">AnimationFramesProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">props</span>
<span class="p">):</span> <span class="nx">ReactElement</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/** State: animator (immutable). */</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">animator</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">Animator</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="k">new</span> <span class="nc">Animator</span><span class="p">(</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">delayMs</span><span class="p">,</span> <span class="nx">tick</span><span class="p">,</span> <span class="dl">"</span><span class="s2">[FunctionalComponentAnimator]</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="nf">useEffect</span><span class="p">(</span><span class="nx">runAnimatorAtStart</span><span class="p">,</span> <span class="p">[</span><span class="nx">animator</span><span class="p">])</span>

  <span class="cm">/** Starts the animator. */</span>
  <span class="kd">function</span> <span class="nf">runAnimatorAtStart</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">animator</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>

    <span class="c1">// Cleanup.</span>
    <span class="k">return </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">animator</span><span class="p">.</span><span class="nx">isStarted</span><span class="p">)</span> <span class="nx">animator</span><span class="p">.</span><span class="nf">stop</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">useEffect</code> hook is scoped to the <code class="language-plaintext highlighter-rouge">animator</code> variable, which is returned by
<code class="language-plaintext highlighter-rouge">useState</code>.</p>

<blockquote>
  <p>⚠ This is similar to <code class="language-plaintext highlighter-rouge">componentDidMount</code>, unmount, update, etc. However, there are some
<em>big</em> differences.</p>

  <ul>
    <li>To mimic the functionality of <code class="language-plaintext highlighter-rouge">componentDidMount</code> you have to pass a 2nd argument to
<code class="language-plaintext highlighter-rouge">useEffect</code> which is either an empty array <code class="language-plaintext highlighter-rouge">[]</code> or some state variable that doesn’t
really change.</li>
    <li>To watch for changes in some specific variables, you can pass them in that array.</li>
  </ul>

  <p>💡 Read more about the difference between passing an empty deps array and passing
nothing on this <a href="https://stackoverflow.com/a/58579462/2085356">SO thread</a>.</p>
</blockquote>

<p>If you want a hook to run on every single DOM render, then you can write something like
this.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ReactElement</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">ReactReplayFunctionComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">AnimationFramesProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">props</span>
<span class="p">):</span> <span class="nx">ReactElement</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">useEffect</span><span class="p">(</span><span class="nx">runForEveryDomChange</span><span class="p">)</span>

  <span class="kd">function</span> <span class="nf">runForEveryDomChange</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* code */</span>
  <span class="p">}</span>

  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>⚠ Beware the issue of
<a href="https://dmitripavlutin.com/react-hooks-stale-closures/">“stale closures”</a> when using
<code class="language-plaintext highlighter-rouge">useEffect()</code>. The stale closure problem occurs when a closure captures outdated
variables.</p>
</blockquote>
      <h4 id="first-render-and-subsequent-re-renders-using-useref-and-useeffect">
        
        
          First render and subsequent re-renders using useRef and useEffect <a href="#first-render-and-subsequent-re-renders-using-useref-and-useeffect">#</a>
        
        
      </h4>
    

<p>Out of the box the callback that you pass to <code class="language-plaintext highlighter-rouge">useEffect()</code> can’t tell the difference
between first render, and subsequent re-renders. This is where <code class="language-plaintext highlighter-rouge">useRef</code> can be very useful
(we have seen it used for keyboard focus in <a href="#imperative-using-useref">this section</a>.</p>

<p>You can set whatever value you want in the <code class="language-plaintext highlighter-rouge">current</code> property of the <code class="language-plaintext highlighter-rouge">ref</code> (which is
returned by <code class="language-plaintext highlighter-rouge">React.useRef(initialValue)</code>). This value will be stable when the component is
re-rendered. This can be a simple way of detecting when the first render occurs, and when
subsequent re-renders occur.</p>

<blockquote>
  <p>💡 Note that storing a value in an object returned by <code class="language-plaintext highlighter-rouge">useRef</code> is different than simply
using <code class="language-plaintext highlighter-rouge">setState</code> because React isn’t watching for changes in the state in order to
trigger a re-render.</p>
</blockquote>

<p>Here’s an example of a custom hook that allows you to use <code class="language-plaintext highlighter-rouge">localStorage</code> in order to get
and set key-value pairs.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">MyLocalStorageHook</span> <span class="o">=</span> <span class="p">[</span><span class="kr">string</span><span class="p">,</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;&gt;</span><span class="p">]</span>
<span class="kd">const</span> <span class="nx">useMyLocalStorageHook</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">MyLocalStorageHook</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">isMounted</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nf">useRef</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

  <span class="kd">const</span> <span class="p">[</span><span class="nx">value</span><span class="p">,</span> <span class="nx">setValue</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nf">useState</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">N/A</span><span class="dl">"</span><span class="p">)</span>

  <span class="nx">React</span><span class="p">.</span><span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">isMounted</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">First render</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">isMounted</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Subsequent re-render</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">])</span>

  <span class="k">return</span> <span class="p">[</span><span class="nx">value</span><span class="p">,</span> <span class="nx">setValue</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>⚠ Note that the value of the object returned by <code class="language-plaintext highlighter-rouge">useRef</code> (the <code class="language-plaintext highlighter-rouge">current</code> property of
<code class="language-plaintext highlighter-rouge">ref</code>) is only set in the <code class="language-plaintext highlighter-rouge">useEffect</code> callback. It isn’t set in the code that is doing
the rendering for example.</p>
</blockquote>

<ol>
  <li>This hook can tell the difference between the first render and subsequent re-renders
since it is using <code class="language-plaintext highlighter-rouge">useRef(boolean)</code> in order to set the <code class="language-plaintext highlighter-rouge">current</code> property to <code class="language-plaintext highlighter-rouge">true</code> on
first render (and then doing an early return).</li>
  <li>Subsequent re-renders will skip over this early return condition check and will
actually the work it is intended to.</li>
  <li>When the <code class="language-plaintext highlighter-rouge">setValue</code> dispatch is used to assign a new value to the key, then it will
actually save the key-value pair to local storage.</li>
</ol>

<blockquote>
  <p>💡 Note that <code class="language-plaintext highlighter-rouge">ref.current</code> can also be used as a place to store the results of an
expensive computation that are local to a function component, but isn’t part of the
state. This can be a cache that is local to the component. Perhaps this cache can be
populated on first render and then re-used for subsequent renders.</p>
</blockquote>
      <h3 id="usestate">
        
        
          useState <a href="#usestate">#</a>
        
        
      </h3>
    

<p>Reusing <em>stateful logic</em> isn’t the same as <em>sharing state between function components</em>.
For the latter, <a href="https://reactjs.org/docs/context.html"><code class="language-plaintext highlighter-rouge">useContext</code></a> or <a href="#redux">Redux</a>
might be more appropriate.</p>
      <h4 id="example">
        
        
          Example <a href="#example">#</a>
        
        
      </h4>
    

<p>The following code uses the <code class="language-plaintext highlighter-rouge">useState</code> hook in a function component.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ReactElement</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>

<span class="kd">type</span> <span class="nx">IndexStateHookType</span> <span class="o">=</span> <span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;&gt;</span><span class="p">]</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">ReactReplayFunctionComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">AnimationFramesProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">props</span>
<span class="p">):</span> <span class="nx">ReactElement</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/** State: currentAnimationFrameIndex (mutable). */</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">frameIndex</span><span class="p">,</span> <span class="nx">setFrameIndex</span><span class="p">]:</span> <span class="nx">IndexStateHookType</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="cm">/** State: animator (immutable). */</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">animator</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">Animator</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="k">new</span> <span class="nc">Animator</span><span class="p">(</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">delayMs</span><span class="p">,</span> <span class="nx">tick</span><span class="p">,</span> <span class="dl">"</span><span class="s2">[FunctionalComponentAnimator]</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>⚡ Here’s the complete source file
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/animate/ReactReplayFunctionComponent.tsx">ReactReplayFunctionComponent.tsx</a>.</p>
</blockquote>

<p>Here’s the anatomy of each call to <code class="language-plaintext highlighter-rouge">useState</code>.</p>

<ol>
  <li>On the 👈 <em>left hand side</em> of the call to <code class="language-plaintext highlighter-rouge">useState</code> hook, it returns an array (of type
<code class="language-plaintext highlighter-rouge">IndexStateHookType</code>).</li>
  <li>The first item is a reference to the state variable (of type <code class="language-plaintext highlighter-rouge">T</code>).</li>
  <li>The second item is the setter function for it (of type <code class="language-plaintext highlighter-rouge">Dispatch&lt;SetStateAction&lt;T&gt;&gt;</code>).
This mutates the state and triggers are render of the function component.</li>
  <li>It has to be initialized w/ whatever value is on the <em>right hand side</em> 👉 expression.
So it is a pretty simple way of making function components have initial state.</li>
</ol>

<blockquote>
  <p>⚠ Beware the issue of
<a href="https://dmitripavlutin.com/react-hooks-stale-closures/">“stale closures”</a> when using
<code class="language-plaintext highlighter-rouge">useState()</code>. The stale closure problem occurs when a closure captures outdated
variables.</p>
</blockquote>
      <h4 id="shared-stateful-logic-vs-shared-state">
        
        
          Shared stateful logic vs shared state <a href="#shared-stateful-logic-vs-shared-state">#</a>
        
        
      </h4>
    

<p>Here’s a <a href="https://stackoverflow.com/a/53455474/2085356">SO question about this</a> that goes
into quite a bit of detail about the differences between sharing state between components
and stateful logic that is shared. Here are some tips from this SO answer.</p>

<ul>
  <li>
    <p>Stateful logic is different from state. Stateful logic is stuff that you do that
modifies state. For e.g., a component subscribing to a store in <code class="language-plaintext highlighter-rouge">componentDidMount()</code>
and unsubscribing in <code class="language-plaintext highlighter-rouge">componentWillUnmount()</code>. This subscribing/unsubscribing behavior
can be implemented in a hook and components which need this behavior can just use the
hook.</p>
  </li>
  <li>
    <p>Here are some ways to share state between components (each w/ its pros and cons):</p>

    <ol>
      <li>
        <p>Lift state up to a common ancestor component of the two components. This is the same
approach taken with class components, the only difference w/ hook is how we declare
the state.</p>

        <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Parent</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="o">&lt;</span><span class="nx">ChildA</span> <span class="nx">count</span><span class="o">=</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span> <span class="nx">onCountChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setCount</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">ChildB</span> <span class="nx">count</span><span class="o">=</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span> <span class="nx">onCountChange</span><span class="o">=</span><span class="p">{</span><span class="nx">setCount</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>If the child components are deep in the hierarchy to be passed down at every level,
then <a href="https://reactjs.org/docs/context.html#when-to-use-context"><code class="language-plaintext highlighter-rouge">useContext</code></a> hook
might be the way to go.</p>
      </li>
      <li>
        <p>External state management libraries like <a href="#redux">Redux</a> might be the way to go. Your
state will then live in a store outside of React and components can subscribe to the
store to receive updates.</p>
      </li>
    </ol>

    <blockquote>
      <p>⚠ Note - Avoid the open source custom hook called
<a href="https://github.com/betula/use-between"><code class="language-plaintext highlighter-rouge">useBetween</code></a> since it is a useless hack.</p>
    </blockquote>
  </li>
</ul>
      <h4 id="resources">
        
        
          Resources <a href="#resources">#</a>
        
        
      </h4>
    

<p>Here are some great resources on learning about <code class="language-plaintext highlighter-rouge">useState</code>.</p>

<ol>
  <li><a href="https://reactjs.org/docs/hooks-state.html">Official docs</a></li>
  <li><a href="https://www.carlrippon.com/typed-usestate-with-TypeScript/">TypeScript and useState</a></li>
</ol>
      <h3 id="usereducer">
        
        
          useReducer <a href="#usereducer">#</a>
        
        
      </h3>
    

<p>This hook is very similar to the <code class="language-plaintext highlighter-rouge">useState</code> hook. You can use both in a component as well.
The main difference between them is unlike <code class="language-plaintext highlighter-rouge">setState</code>, a reducer function must be provided
that deals w/ generating a new state when employing <code class="language-plaintext highlighter-rouge">useReducer</code>.</p>

<blockquote>
  <p>💡 This is very similar to Redux! And this might just be the simplest way to learn Redux
patterns. Jump to this <a href="#redux">section</a> to learn all about how to use React and Redux
(using the modern <code class="language-plaintext highlighter-rouge">redux-toolkit</code> and not old-school <code class="language-plaintext highlighter-rouge">redux-react</code>).</p>
</blockquote>

<p>It is possible to replace code that employs <code class="language-plaintext highlighter-rouge">useState</code> w/ code that employs <code class="language-plaintext highlighter-rouge">useReducer</code>.
Here’s an example.</p>

<p>Code that employs <code class="language-plaintext highlighter-rouge">useState</code> hook.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">StoriesStateHookType</span> <span class="o">=</span> <span class="p">[</span><span class="nx">Story</span><span class="p">[],</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="nx">Story</span><span class="p">[]</span><span class="o">&gt;&gt;</span><span class="p">]</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">ListOfStoriesComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">ListOfStoriesProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Store Story[] in the function component's state.</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">myStories</span><span class="p">,</span> <span class="nx">setMyStories</span><span class="p">]:</span> <span class="nx">StoriesStateHookType</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="o">&lt;</span><span class="nx">Story</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">([])</span>

  <span class="c1">// Simply call `setMyStories` to set a value to the function component's state.</span>
  <span class="nx">React</span><span class="p">.</span><span class="nf">useEffect</span><span class="p">(</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">getAsyncStoriesWithSimulatedNetworkLag</span><span class="p">().</span><span class="nf">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nf">setMyStories</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">},</span>
    <span class="p">[]</span> <span class="cm">/* Only run this effect once; akin to componentDidMount. */</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Function to remove a story by simply using `setMyStories`.</span>
<span class="kd">const</span> <span class="nx">handleRemoveItem</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="k">void</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">setMyStories</span><span class="p">(</span><span class="nx">myStories</span><span class="p">.</span><span class="nf">filter</span><span class="p">((</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">it</span><span class="p">.</span><span class="nx">objectID</span> <span class="o">!==</span> <span class="nx">id</span><span class="p">))</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`handleRemoveItem('</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">) called'`</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Equivalent code that employs <code class="language-plaintext highlighter-rouge">useReducer</code> hook.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">ListOfStoriesComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">ListOfStoriesProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Create a reducer to manage Story[] in the state.</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">myStories</span><span class="p">,</span> <span class="nx">dispatchMyStories</span><span class="p">]:</span> <span class="nx">ReducerHookType</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useReducer</span><span class="o">&lt;</span><span class="nx">ReducerType</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="nx">storiesReducer</span><span class="p">,</span>
    <span class="k">new</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Story</span><span class="o">&gt;</span><span class="p">()</span>
  <span class="p">)</span>

  <span class="c1">// To make changes to the state managed by the reducer, you have to dispatch an action w/</span>
  <span class="c1">// a payload. In this example, we have 2 actions: "setState" and "removeItem".</span>

  <span class="nx">React</span><span class="p">.</span><span class="nf">useEffect</span><span class="p">(</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">getAsyncStoriesWithSimulatedNetworkLag</span><span class="p">().</span><span class="nf">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nf">dispatchMyStories</span><span class="p">({</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">setState</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">payload</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
        <span class="p">})</span>
      <span class="p">})</span>
    <span class="p">},</span>
    <span class="p">[]</span> <span class="cm">/* Only run this effect once; akin to componentDidMount. */</span>
  <span class="p">)</span>

  <span class="kd">const</span> <span class="na">handleRemoveItem</span><span class="p">:</span> <span class="nx">FnWithSingleArg</span><span class="o">&lt;</span><span class="nx">Story</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="na">objectToRemove</span><span class="p">:</span> <span class="nx">Story</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">handleRemoveItem called w/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">objectToRemove</span><span class="p">)</span>
    <span class="nf">dispatchMyStories</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">removeItem</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">payload</span><span class="p">:</span> <span class="nx">objectToRemove</span><span class="p">,</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This is the reducer function.</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">StateType</span> <span class="o">=</span> <span class="nx">Story</span><span class="p">[]</span>
<span class="kr">interface</span> <span class="nx">ActionSetState</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">setState</span><span class="dl">"</span>
  <span class="nx">payload</span><span class="p">:</span> <span class="nx">Story</span><span class="p">[]</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionRemoveItem</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">removeItem</span><span class="dl">"</span>
  <span class="nx">payload</span><span class="p">:</span> <span class="nx">Story</span>
<span class="p">}</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">ActionType</span> <span class="o">=</span> <span class="nx">ActionSetState</span> <span class="o">|</span> <span class="nx">ActionRemoveItem</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">ReducerType</span> <span class="o">=</span> <span class="nx">Reducer</span><span class="o">&lt;</span><span class="nx">StateType</span><span class="p">,</span> <span class="nx">ActionType</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">ReducerHookType</span> <span class="o">=</span> <span class="p">[</span><span class="nx">StateType</span><span class="p">,</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">ActionType</span><span class="o">&gt;</span><span class="p">]</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">storiesReducer</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">currentState</span><span class="p">:</span> <span class="nx">StateType</span><span class="p">,</span>
  <span class="nx">action</span><span class="p">:</span> <span class="nx">ActionType</span>
<span class="p">):</span> <span class="nx">StateType</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">storiesReducer -&gt; </span><span class="se">\n</span><span class="s2">currentState:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">currentState</span><span class="p">,</span> <span class="dl">"</span><span class="se">\n</span><span class="s2">-&gt; action:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
  <span class="kd">let</span> <span class="na">newState</span><span class="p">:</span> <span class="nx">StateType</span>
  <span class="k">switch </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">removeItem</span><span class="dl">"</span><span class="p">:</span>
      <span class="kd">const</span> <span class="nx">itemToRemove</span> <span class="o">=</span> <span class="nx">action</span><span class="p">?.</span><span class="nx">payload</span>
      <span class="nx">newState</span> <span class="o">=</span> <span class="nx">currentState</span><span class="p">.</span><span class="nf">filter</span><span class="p">((</span><span class="nx">story</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">story</span><span class="p">.</span><span class="nx">objectID</span> <span class="o">!==</span> <span class="nx">itemToRemove</span><span class="p">.</span><span class="nx">objectID</span><span class="p">)</span>
      <span class="k">break</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">setState</span><span class="dl">"</span><span class="p">:</span>
      <span class="nx">newState</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span>
      <span class="k">break</span>
    <span class="na">default</span><span class="p">:</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="s2">`Invalid action: </span><span class="p">${</span><span class="nx">action</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">return newState</span><span class="dl">"</span><span class="p">,</span> <span class="nx">newState</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nf">clone</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
      <h4 id="two-examples-one-wout-network-and-one-w-network">
        
        
          Two examples (one w/out network, and one w/ network) <a href="#two-examples-one-wout-network-and-one-w-network">#</a>
        
        
      </h4>
    

<ol>
  <li>For a simple example that doesn’t use any network, and that is decomposed into many
files, check out the
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/list/ListOfStoriesComponent.tsx"><code class="language-plaintext highlighter-rouge">ListOfStoriesComponent</code></a>
which utilizes both <code class="language-plaintext highlighter-rouge">useState</code> and <code class="language-plaintext highlighter-rouge">useReducer</code> hooks.</li>
  <li>For an example that has network calls, and does everything in one file, check out the
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/CatApiComponent.tsx"><code class="language-plaintext highlighter-rouge">CatApiComponent</code></a>
which only uses <code class="language-plaintext highlighter-rouge">useReducer</code> and no <code class="language-plaintext highlighter-rouge">useState</code>.</li>
</ol>
      <h3 id="usecallback-and-usememo">
        
        
          useCallback and useMemo <a href="#usecallback-and-usememo">#</a>
        
        
      </h3>
    

<p>These two hooks are very tricky, since they cache objects that are tightly bound to
React’s lifecycle, and might have memory and CPU impacts that you’re not able to predict
using your intuition. Most of the time, its best not to use them.</p>

<p>These articles go into great details about why they should not be used unless you have a
very specific use case that warrants their use as.</p>

<ol>
  <li><a href="https://kentcdodds.com/blog/usememo-and-usecallback">Article - useMemo and useCallback</a></li>
  <li><a href="https://dmitripavlutin.com/dont-overuse-react-usecallback">Article - Don’t overuse React useCallback</a></li>
</ol>

<p>Reference docs</p>

<ul>
  <li><a href="https://reactjs.org/docs/hooks-reference.html#usememo">useMemo</a></li>
  <li><a href="https://reactjs.org/docs/hooks-reference.html#usecallback">useCallback</a></li>
</ul>

<p>Here are some acceptable use cases where these can be used.</p>

<ul>
  <li>When functions that are declared inside of a hook have some internal state, such as when
the function is debounced or throttled.</li>
  <li>When the function object is a dependency on other hooks (eg: passing the function
returned by <code class="language-plaintext highlighter-rouge">useCallback</code> to <code class="language-plaintext highlighter-rouge">useEffect</code>).</li>
  <li>When the function component wrapped inside of <code class="language-plaintext highlighter-rouge">useMemo</code> accepts a function object prop.</li>
</ul>
      <h3 id="how-to-write-complex-function-components">
        
        
          How to write complex function components <a href="#how-to-write-complex-function-components">#</a>
        
        
      </h3>
    

<p>If the FCs (<code class="language-plaintext highlighter-rouge">ItemComponent</code>, <code class="language-plaintext highlighter-rouge">ListComponent</code>, <code class="language-plaintext highlighter-rouge">SearchComponent</code> ) are defined inside the
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/list/ListOfStoriesComponent.tsx"><code class="language-plaintext highlighter-rouge">ListOfStoriesComponent</code></a>
they behave differently with keyboard focus, than if they are defined outside it!</p>

<ol>
  <li>If they are declared <em>outside</em>, the keyboard focus inside the <code class="language-plaintext highlighter-rouge">input</code> element is
retained as you type different search terms.</li>
  <li>
    <p>If they are declared <em>inside</em>, the keyboard focus is lost every time you generate a
single keyboard event.</p>

    <blockquote>
      <p>⚠ This might have something to do with
<a href="https://stackoverflow.com/a/56655447/2085356">this</a>, function components being
stateless. If things are declared inside of a function, then they will be recreated
everytime that function is run, vs if they are declared outside, then they won’t be
recreated on every (render) call.</p>
    </blockquote>
  </li>
</ol>
      <h3 id="custom-hooks">
        
        
          Custom hooks <a href="#custom-hooks">#</a>
        
        
      </h3>
    

<p>When writing custom hooks, that relay external async events (eg, happening via a
<strong>listener function</strong> that is attached to the DOM, or Node.js, or a database) please note
that this listener function, which is passed to <code class="language-plaintext highlighter-rouge">useEffect()</code>, <strong>can not directly call</strong>
into the React function component 🧨! If you have functions defined inside of your React
function component, even though they look and feel like regular TypeScript / JavaScript
functions they don’t work the same way if code outside the component invokes them vs. code
that is inside.</p>

<blockquote>
  <p>🤔 This is a very subtle but important point to remember when figuring how to “relay”
the non-React async event into the React function component world (via a custom hook
that you’re writing). When using “normal” React (host components in a browser) we don’t
get to see this because the code that interfaces with the browser’s DOM is provided to
us. So we are used to attaching a callback function to an
<a href="https://reactjs.org/docs/handling-events.html"><code class="language-plaintext highlighter-rouge">onclick</code> props of a <code class="language-plaintext highlighter-rouge">button</code> in React</a>,
and it would just work 🧙. However, under the covers this host component is taking care
of interfacing w/ a DOM async event emitter to invoke callback function via
<a href="https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener"><code class="language-plaintext highlighter-rouge">addEventListener</code></a> and
doing something similar to this hook.</p>
</blockquote>

<p>It might be tempting to simply pass a React-function-component-callback function to a
hook, which then passes it on to an external event emitter listener 😈. When the listener
is then executed by the external event emitter (which is not a React function component)
then problems will arise! The state information that this
React-function-component-callback will get will be wrong.</p>

<p>The way to get around this issue is to do the following:</p>

<ol>
  <li>Introduce an intermediate state variable (via <code class="language-plaintext highlighter-rouge">useState()</code> hook).</li>
  <li>Have your external event listener use the setter for this state variable to let your
hook know that some external event just came in.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">useEffect()</code> and pass the getter for this state variable as a dependency to a
function that gets called when this state variable changes. This function will be able
to then run the React-function-component-callback that is passed into the hook to begin
with.</li>
</ol>

<p>Here’s a diagram of this.</p>

<p><img src="/assets/use-hook-outside.svg" /></p>

<p>For a real world example, please take a look at this
<a href="https://github.com/r3bl-org/r3bl-ts-utils/commit/a3248540ea325d3896ee56a84d003f15529169cd">commit in r3bl-ts-utils</a>,
<a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/c0725a415b2e07b928ac725770569d6af8359ed4/src/react-ink-hook-utils/use-event-emitter.ts">this hook</a>,
and
<a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/c0725a415b2e07b928ac725770569d6af8359ed4/src/node-keyboard/use-node-keypress.ts">this other hook</a>
for more information on how the hook “binds” the two disparate worlds of Node.js
<code class="language-plaintext highlighter-rouge">process.stdin</code>’s <code class="language-plaintext highlighter-rouge">keypress</code> events, and the React function component that ends up using
this hook to get async events that are generated by an end user who’s typing in a
terminal.</p>

<blockquote>
  <p>🤔 When using <code class="language-plaintext highlighter-rouge">useEffect()</code> and your own custom hooks, it is important to be mindful of
the sequence of steps that React takes in order to clean up your hooks, when a reference
in the dependency array changes. Here’s an example of this actually plays out for a
scenario where you have <code class="language-plaintext highlighter-rouge">useEffect()</code> with <code class="language-plaintext highlighter-rouge">[ foo ]</code> as a dependency (from the diagram
above). After the first time the effect runs, all subsequent changes in <code class="language-plaintext highlighter-rouge">foo</code> trigger
the cleanup function to be executed prior to the effect callback function.</p>

  <table>
    <thead>
      <tr>
        <th>foo</th>
        <th>function calls</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>“a”</td>
        <td>callbackFn</td>
      </tr>
      <tr>
        <td>undefined</td>
        <td>cleanupFn, then callbackFn</td>
      </tr>
      <tr>
        <td>“b”</td>
        <td>cleanupFn, then callbackFn</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<p>Here are some examples:</p>

<ul>
  <li><a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/c0725a415b2e07b928ac725770569d6af8359ed4/src/react-ink-hook-utils/use-event-emitter.ts"><code class="language-plaintext highlighter-rouge">useEventEmitter</code></a>
    <ul>
      <li>Real example of the diagram shown above.</li>
    </ul>
  </li>
  <li><a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/c0725a415b2e07b928ac725770569d6af8359ed4/src/node-keyboard/use-node-keypress.ts"><code class="language-plaintext highlighter-rouge">useNodeKeypress</code></a>
    <ul>
      <li>Real example of the diagram shown above.</li>
    </ul>
  </li>
  <li><a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/list/hooks.tsx"><code class="language-plaintext highlighter-rouge">useLocalStorage</code></a>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">useLocalStorage</code> shows how to use <code class="language-plaintext highlighter-rouge">localStorage</code> to back a state variable.</li>
      <li><code class="language-plaintext highlighter-rouge">LocalStorageEvents</code> shows how to deal w/ <code class="language-plaintext highlighter-rouge">localStorage</code> limitations when setting the
value in the same <code class="language-plaintext highlighter-rouge">document</code>. <code class="language-plaintext highlighter-rouge">localStorage</code> changes can be initiated in 3 ways:
        <ol>
          <li>from this hook (calls to the setter / dispatcher returned by this hook).</li>
          <li>from calls to MyLocalStorageEvents.storage.setValue().</li>
          <li>from other document(s) (running the same app in other tabs in the same browser
instance) changing the key value pairs in localStorage.</li>
        </ol>
      </li>
    </ul>
  </li>
  <li><a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/animate/hooks.tsx"><code class="language-plaintext highlighter-rouge">useAnimator</code></a>
    <ul>
      <li><a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/animate/ReactReplayFunctionComponent.tsx"><code class="language-plaintext highlighter-rouge">ReactReplayFunctionComponent</code></a>
uses this hook in order to show frames in a pre-rendered array of frames
(<code class="language-plaintext highlighter-rouge">ReactElement[]</code>).</li>
    </ul>
  </li>
</ul>
      <h3 id="references-about-hooks">
        
        
          References about hooks <a href="#references-about-hooks">#</a>
        
        
      </h3>
    

<p>To learn about hooks, here are some important resources.</p>

<ul>
  <li><a href="https://youtu.be/dpw9EHDh2bM">Great video introducing hooks</a></li>
  <li>[Best practices on using React function components][h-5]</li>
  <li><a href="https://reactjs.org/docs/hooks-custom.html">Official docs on writing custom hooks</a></li>
  <li><a href="https://reactjs.org/docs/hooks-reference.html#usestate">Official Hooks API Reference for useState</a></li>
  <li><a href="https://www.newline.co/@CarlMungazi/a-journey-through-the-usestate-hook--a4983397">Deep dive into useState hook and React memory model</a></li>
</ul>

<p>[h-5]:
  https://www.infoworld.com/article/3603276/how-to-use-react-functional-components.html</p>
      <h2 id="keyboard-focus-and-react">
        
        
          Keyboard focus and React <a href="#keyboard-focus-and-react">#</a>
        
        
      </h2>
    

<p>We can do this declaratively (which is relatively simple, but extremely limiting) or
imperatively, which is probably more realistic (and more complex).</p>
      <h3 id="declarative">
        
        
          Declarative <a href="#declarative">#</a>
        
        
      </h3>
    

<p>Here’s a way to get keyboard focus into a single element declaratively. The <code class="language-plaintext highlighter-rouge">autoFocus</code>
attribute on the <code class="language-plaintext highlighter-rouge">input</code> element is set to a boolean value that is passed as a props.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">SearchProps</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">searchTerm</span><span class="p">:</span> <span class="kr">string</span>
  <span class="na">onSearchFn</span><span class="p">:</span> <span class="nx">OnSearchFn</span>
  <span class="na">initialKeybFocus</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">ListOfStoriesComponent</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/** snip */</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">Container</span><span class="dl">"</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">My</span> <span class="nx">Searchable</span> <span class="nx">Stories</span><span class="o">&lt;</span><span class="sr">/strong</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">SearchComponent</span>
        <span class="nx">searchTerm</span><span class="o">=</span><span class="p">{</span><span class="nx">searchTerm</span><span class="p">}</span>
        <span class="nx">onSearchFn</span><span class="o">=</span><span class="p">{</span><span class="nx">onSearchFn</span><span class="p">}</span>
        <span class="nx">initialKeybFocus</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span>
      <span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="na">Search</span><span class="p">:</span> <span class="o">&lt;</span><span class="sr">/strong</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/SearchComponent</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">ListComponent</span> <span class="nx">list</span><span class="o">=</span><span class="p">{</span><span class="nx">filteredStories</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">SearchComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">SearchProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">searchTerm</span><span class="p">,</span>
  <span class="nx">onSearchFn</span><span class="p">,</span>
  <span class="nx">children</span><span class="p">,</span>
  <span class="nx">initialKeybFocus</span><span class="p">,</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">section</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">search</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">input</span>
        <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">search</span><span class="dl">"</span>
        <span class="kd">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">searchTerm</span><span class="p">}</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">onSearchFn</span><span class="p">}</span>
        <span class="nx">autoFocus</span><span class="o">=</span><span class="p">{</span><span class="nx">initialKeybFocus</span><span class="p">}</span>
      <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/section</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
      <h3 id="imperative-using-useref">
        
        
          Imperative using useRef <a href="#imperative-using-useref">#</a>
        
        
      </h3>
    

<p>Here’s another way to do the same thing imperatively (programmatically) using <code class="language-plaintext highlighter-rouge">useRef()</code>
and <code class="language-plaintext highlighter-rouge">useEffect()</code>.</p>

<blockquote>
  <p>💡 Using ref (DOM element of a React element) and hooks:</p>

  <ol>
    <li>In order to use a ref, you must first create it using the <code class="language-plaintext highlighter-rouge">useRef()</code> hook, and then
pass it to use the <code class="language-plaintext highlighter-rouge">ref</code> attribute in a React component.</li>
    <li>When this component is rendered to DOM, it will “set” the <code class="language-plaintext highlighter-rouge">current</code> property of this
ref (which is the DOM element corresponding to this React component). This is used
later in the <code class="language-plaintext highlighter-rouge">useEffect()</code> hook to actually call <code class="language-plaintext highlighter-rouge">focus()</code> on the DOM element.</li>
  </ol>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">SearchComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">SearchProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">takeInitialKeyboardFocus</span><span class="p">,</span>
  <span class="nx">searchTerm</span><span class="p">,</span>
  <span class="nx">onSearchFn</span><span class="p">,</span>
  <span class="nx">children</span><span class="p">,</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// useEffect hook for initial keyboard focus on input element.</span>
  <span class="kd">const</span> <span class="na">inputRef</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">MutableRefObject</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nf">useRef</span><span class="p">()</span>
  <span class="nx">React</span><span class="p">.</span><span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">inputRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">takeInitialKeyboardFocus</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inputRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nf">focus</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">})</span>

  <span class="c1">// Run this effect to log inputRef.</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">showUi</span><span class="p">,</span> <span class="nx">setShowUi</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nf">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="kd">function</span> <span class="nf">onButtonClicked</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">setShowUi</span><span class="p">((</span><span class="nx">prevState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">prevState</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">showUi</span><span class="dl">"</span><span class="p">,</span> <span class="nx">showUi</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">React</span><span class="p">.</span><span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">✨ Creating inputRef related effect</span><span class="dl">"</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">logInputRef</span> <span class="o">=</span> <span class="p">(</span><span class="na">msg</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">msg</span><span class="p">}</span><span class="s2">\n`</span><span class="p">,</span>
        <span class="nx">inputRef</span><span class="p">.</span><span class="nx">current</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">🎉 has DOM element</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">🧨 does not have DOM element</span><span class="dl">"</span>
      <span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">logInputRef</span><span class="p">(</span><span class="dl">"</span><span class="s2">🎹✨ inputRef</span><span class="dl">"</span><span class="p">)</span>
    <span class="k">return </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">logInputRef</span><span class="p">(</span><span class="dl">"</span><span class="s2">🎹🗑 Do something here to unregister the DOM element, inputRef</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">showUi</span><span class="p">])</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">section</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">showUi</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
        <span class="o">&lt;&gt;</span>
          <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">htmlFor</span><span class="o">=</span><span class="dl">"</span><span class="s2">search</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">input</span>
            <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">search</span><span class="dl">"</span>
            <span class="kd">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
            <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">searchTerm</span><span class="p">}</span>
            <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">onSearchFn</span><span class="p">}</span>
            <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">inputRef</span><span class="p">}</span>
          <span class="sr">/</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>      <span class="p">)}</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onButtonClicked</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">mount</span><span class="o">/</span><span class="nx">unmount</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/section</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>💡 You can also utilize <code class="language-plaintext highlighter-rouge">useRef()</code> in order to detect the first render vs subsequent
re-render by pairing it w/ <code class="language-plaintext highlighter-rouge">useEffect()</code> hook; more in
<a href="#first-render-and-subsequent-re-renders-using-useref-and-useeffect">this section</a>.</p>
</blockquote>
      <h2 id="react-and-css">
        
        
          React and CSS <a href="#react-and-css">#</a>
        
        
      </h2>
    

<p>At a high level there are 2 strategies to consider when using CSS in React (which are both
bundled when you use <code class="language-plaintext highlighter-rouge">create-react-app</code> (CRA).</p>

<ol>
  <li>Styled components (CSS in JS) - This is where you simply use the <code class="language-plaintext highlighter-rouge">className</code> prop to
specify which CSS rules to use.</li>
  <li>CSS Modules (CSS in CSS) - This is where you leverage
<a href="https://css-tricks.com/css-modules-part-1-need/">CSS modules</a> which locally scope the
styles to prevent collisions w/ synonymous styles declared in other files. Look
<a href="#css-modules-example">below</a> for more details.</li>
</ol>
      <h3 id="css-modules-example">
        
        
          CSS Modules example <a href="#css-modules-example">#</a>
        
        
      </h3>
    

<p>The following are the main differences that you have to be aware of when compared to
styled components:</p>

<ol>
  <li>Instead of using <code class="language-plaintext highlighter-rouge">XXX.css</code>, make <code class="language-plaintext highlighter-rouge">XXX.module.css</code> files. This tells CRA to use CSS
modules.</li>
  <li>Instead of importing the CSS file like you would for a styled component, do this
instead <code class="language-plaintext highlighter-rouge">import YYY from './XXX.module.css'</code>, where <code class="language-plaintext highlighter-rouge">YYY</code> is what you choose to call
the variable holding all the imported styles.
    <blockquote>
      <p>When using styled components you only have to import the CSS file once (eg: in
<code class="language-plaintext highlighter-rouge">App.tsx</code>) and these are available (implicitly) to all the React components that are
nested in it. But using modules you have to import them in each file that uses the
style.</p>
    </blockquote>
  </li>
  <li>Then use these styles in your JSX like this: <code class="language-plaintext highlighter-rouge">&lt;Component className{YYY.XYZ}/&gt;</code>.</li>
</ol>

<p>Here’s a simple example that shows how to use CSS modules or CSS in CSS approach.</p>

<blockquote>
  <p>⚡ Read the
<a href="https://create-react-app.dev/docs/adding-a-css-modules-stylesheet/">CRA official docs</a>
on using CSS modules.</p>
</blockquote>

<p>Step 1 - Create a <code class="language-plaintext highlighter-rouge">XYZ.module.css</code> file, eg: <code class="language-plaintext highlighter-rouge">App.module.css</code> and not a <code class="language-plaintext highlighter-rouge">App.css</code> file.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100vw</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="n">to</span> <span class="nb">left</span><span class="p">,</span> <span class="m">#b6fbff</span><span class="p">,</span> <span class="m">#83a4d4</span><span class="p">);</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#171212</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Step 2 - In your JSX component, you have to do the following import to use the style.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">myStyles</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./App.module.css</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">App</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">myStyles</span><span class="p">.</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Content</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div>

<blockquote>
  <p>⚠ Note how this is different from the usual <code class="language-plaintext highlighter-rouge">&lt;div className="container"&gt;...&lt;/div&gt;</code>.</p>
</blockquote>
      <h3 id="styled-component-example">
        
        
          Styled component example <a href="#styled-component-example">#</a>
        
        
      </h3>
    
      <h4 id="tooltipoverlay-w-just-css">
        
        
          TooltipOverlay w/ just CSS <a href="#tooltipoverlay-w-just-css">#</a>
        
        
      </h4>
    

<p>It is actually very simple to implement a tooltip using just CSS. The key is using the
<code class="language-plaintext highlighter-rouge">:hover</code> pseudo selector on the tooltip’s parent container to display a tooltip.</p>

<p>Here’s an overview of what this CSS does:</p>

<ul>
  <li>An empty parent container (<code class="language-plaintext highlighter-rouge">span</code>) is created so that its position can be set to
<code class="language-plaintext highlighter-rouge">relative</code>, so that any child elements inside of it (other <code class="language-plaintext highlighter-rouge">span</code> elements) can be
positioned as <code class="language-plaintext highlighter-rouge">absolute</code> w/ a <code class="language-plaintext highlighter-rouge">z-index</code> of <code class="language-plaintext highlighter-rouge">1000</code>.</li>
  <li>The <code class="language-plaintext highlighter-rouge">:hover</code> pseudo selector on the <code class="language-plaintext highlighter-rouge">.tooltipContainer</code> takes care of showing the
<code class="language-plaintext highlighter-rouge">.tooltip</code> by setting its <code class="language-plaintext highlighter-rouge">display</code> to <code class="language-plaintext highlighter-rouge">block</code>.</li>
</ul>

<blockquote>
  <p>⚡
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/utils/Tooltip.module.css"><code class="language-plaintext highlighter-rouge">TooltipOverlay.module.css</code></a></p>
</blockquote>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.tooltipContainer</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.tooltip</span> <span class="p">{</span>
  <span class="py">--radius</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
  <span class="py">--alpha</span><span class="p">:</span> <span class="m">0.8</span><span class="p">;</span>
  <span class="py">--fillColor</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">26</span><span class="p">,</span> <span class="m">31</span><span class="p">,</span> <span class="m">48</span><span class="p">,</span> <span class="n">var</span><span class="p">(</span><span class="n">--alpha</span><span class="p">));</span>
  <span class="py">--borderColor</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">149</span><span class="p">,</span> <span class="m">237</span><span class="p">,</span> <span class="n">var</span><span class="p">(</span><span class="n">--alpha</span><span class="p">));</span>
<span class="p">}</span>

<span class="nc">.tooltip</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">z-index</span><span class="p">:</span> <span class="m">1000</span><span class="p">;</span>

  <span class="nl">padding</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">--defaultPadding</span><span class="p">)</span> <span class="err">*</span> <span class="m">0.5</span><span class="p">);</span>
  <span class="nl">background</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--fillColor</span><span class="p">);</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--radius</span><span class="p">);</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">2px</span> <span class="nb">solid</span> <span class="n">var</span><span class="p">(</span><span class="n">--borderColor</span><span class="p">);</span>

  <span class="c">/* This ensures that the tooltip does not obstruct the element that is being hovered */</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.tooltipContainer</span><span class="nd">:hover</span> <span class="nc">.tooltip</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The (minimal) React component below uses the CSS above.</p>

<blockquote>
  <p>⚡
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/utils/TooltipOverlay.tsx"><code class="language-plaintext highlighter-rouge">TooltipOverlay.tsx</code></a></p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">FC</span><span class="p">,</span> <span class="nx">PropsWithChildren</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">componentStyles</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./TooltipOverlay.module.css</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">TooltipOverlayProps</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">tooltipText</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">TooltipOverlay</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">PropsWithChildren</span><span class="o">&lt;</span><span class="nx">TooltipOverlayProps</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">children</span><span class="p">,</span>
  <span class="nx">tooltipText</span><span class="p">,</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">componentStyles</span><span class="p">.</span><span class="nx">tooltipContainer</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">componentStyles</span><span class="p">.</span><span class="nx">tooltip</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">tooltipText</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>      <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>⚡ React bootstrap package has an example using this pattern
<a href="https://react-bootstrap.github.io/components/overlays/">here</a>.</p>
</blockquote>
      <h4 id="tooltipoverlay-w-just-react">
        
        
          TooltipOverlay w/ just React <a href="#tooltipoverlay-w-just-react">#</a>
        
        
      </h4>
    

<p>Here is an example of implementing a tooltip that uses mostly React, and not much CSS as
shown in the previous example.</p>

<p>Here’s the React code - The <code class="language-plaintext highlighter-rouge">useState</code> hook is essentially used to apply a “hover” effect
on any React elements that are children of a <code class="language-plaintext highlighter-rouge">TooltipOverlay</code> component.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">componentStyles</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./TooltipOverlay.module.css</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">type</span> <span class="nx">TooltipOverlayProps</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">tooltipText</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">TooltipOverlay</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">PropsWithChildren</span><span class="o">&lt;</span><span class="nx">TooltipOverlayProps</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">children</span><span class="p">,</span>
  <span class="nx">tooltipText</span><span class="p">,</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">showTooltip</span><span class="p">,</span> <span class="nx">setShowTooltip</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nf">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">onMouseEnter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">setShowTooltip</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">onMouseLeave</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">setShowTooltip</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">styleVisible</span> <span class="o">=</span> <span class="nx">componentStyles</span><span class="p">.</span><span class="nx">tooltip</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">componentStyles</span><span class="p">.</span><span class="nx">visible</span>
  <span class="kd">const</span> <span class="nx">styleInvisible</span> <span class="o">=</span> <span class="nx">componentStyles</span><span class="p">.</span><span class="nx">tooltip</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">span</span>
      <span class="nx">onMouseEnter</span><span class="o">=</span><span class="p">{</span><span class="nx">onMouseEnter</span><span class="p">}</span>
      <span class="nx">onMouseLeave</span><span class="o">=</span><span class="p">{</span><span class="nx">onMouseLeave</span><span class="p">}</span>
      <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">componentStyles</span><span class="p">.</span><span class="nx">tooltipContainer</span><span class="p">}</span>
    <span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">showTooltip</span> <span class="p">?</span> <span class="nx">styleVisible</span> <span class="p">:</span> <span class="nx">styleInvisible</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">tooltipText</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>      <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The CSS is the same as in the previous example, with the only following difference.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.tooltip.visible</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
      <h2 id="react-and-svg">
        
        
          React and SVG <a href="#react-and-svg">#</a>
        
        
      </h2>
    

<p>It is very easy to use SVG w/ React. There are various ways of importing the SVG asset
into a React component itself:</p>

<ol>
  <li>
    <p>You can import it from a file (static asset). The imported file is actually a React
component itself. And you can style the SVG directly by passing <code class="language-plaintext highlighter-rouge">className</code> or inline
styles to this component. Here’s an example of importing the SVG file.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ReactComponent</span> <span class="k">as</span> <span class="nx">Car</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./car.svg</span><span class="dl">"</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">SvgExample</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">Car</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">SvgImage</span><span class="dl">"</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span></code></pre></div>    </div>

    <p>Here’s an example of styling it in CSS.</p>

    <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.SvgImage</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.SvgImage</span><span class="nd">:hover</span> <span class="o">&gt;</span> <span class="nt">g</span> <span class="p">{</span>
  <span class="py">stroke</span><span class="p">:</span> <span class="no">yellow</span><span class="p">;</span>
  <span class="py">stroke-width</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>You can declare it in JSX. Here’s an example.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">BasicSvg</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">svg</span> <span class="nx">width</span><span class="o">=</span><span class="dl">"</span><span class="s2">100</span><span class="dl">"</span> <span class="nx">height</span><span class="o">=</span><span class="dl">"</span><span class="s2">100</span><span class="dl">"</span> <span class="nx">xmlns</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://www.w3.org/2000/svg</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">circle</span> <span class="nx">cx</span><span class="o">=</span><span class="dl">"</span><span class="s2">50</span><span class="dl">"</span> <span class="nx">cy</span><span class="o">=</span><span class="dl">"</span><span class="s2">50</span><span class="dl">"</span> <span class="nx">r</span><span class="o">=</span><span class="dl">"</span><span class="s2">40</span><span class="dl">"</span> <span class="nx">stroke</span><span class="o">=</span><span class="dl">"</span><span class="s2">blue</span><span class="dl">"</span> <span class="nx">strokeWidth</span><span class="o">=</span><span class="dl">"</span><span class="s2">4</span><span class="dl">"</span> <span class="nx">fill</span><span class="o">=</span><span class="dl">"</span><span class="s2">lightblue</span><span class="dl">"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="sr">/svg</span><span class="err">&gt;
</span><span class="p">)</span>
</code></pre></div>    </div>

    <p>You can then just use it as a React component.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SvgExample</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">BasicSvg</span> <span class="o">/&gt;</span>
</code></pre></div>    </div>

    <p>Or you can use it inside an <code class="language-plaintext highlighter-rouge">img</code> tag like so.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SvgExample</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">logo</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">logo</span><span class="dl">"</span> <span class="nx">alt</span><span class="o">=</span><span class="dl">"</span><span class="s2">logo</span><span class="dl">"</span> <span class="o">/&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>You can load it as a string using the <code class="language-plaintext highlighter-rouge">data:image/svg+xml</code> pattern. Here’s an example
of defining the SVG in CSS.</p>

    <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.topography-pattern</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#ffffff</span><span class="p">;</span>
  <span class="nl">background-image</span><span class="p">:</span> <span class="sx">url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' ... ")</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>And then using it in a React component.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">SvgExample</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">topography-pattern</span><span class="dl">"</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div>    </div>
  </li>
</ol>
      <h3 id="references-on-svg-and-react">
        
        
          References on SVG and React <a href="#references-on-svg-and-react">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="https://create-react-app.dev/docs/adding-images-fonts-and-files/">CRA and SVG</a></li>
  <li><a href="https://www.robinwieruch.de/react-svg-patterns">Using SVG as backgrounds in React</a></li>
</ul>
      <h2 id="redux">
        
        
          Redux <a href="#redux">#</a>
        
        
      </h2>
    

<p><a href="https://redux.js.org/tutorials/fundamentals/part-1-overview">Redux</a> is a great way to
share state between components. The <code class="language-plaintext highlighter-rouge">redux-toolkit</code> uses the underlying <code class="language-plaintext highlighter-rouge">react-redux</code>
module, but is easier to use. Here’s how you can install it in your project.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> @reduxjs/toolkit react-redux
</code></pre></div></div>

<blockquote>
  <p>💡 To understand Redux it is best to start w/ ‘useReducer’ hook as show in this
<a href="#usereducer">section</a>. It is an easy way to understand the fundamentals of Redux which
is actions, state, reducer functions, and immutable state.</p>
</blockquote>

<p>While Redux helps you deal with shared state management, it has tradeoffs. You have to buy
into its mental model, and structure your code and thoughts in a Redux-compliant way. As a
developer you are used to modifying state imperatively, and the notion of having to
request changes to be made declaratively might be something you’ve not seen before. It
also adds some indirection to your code, and asks you to follow certain restrictions. It’s
a trade-off between short term and long term productivity.</p>

<p>Here’s a simple example (no async, middleware, thunks, or splitting reducers, etc). There
are the 5 steps to using Redux in your React component(s).</p>
      <h3 id="step-1---define-the-types-for-the-state-action-then-use-them-to-create-a-reducer-function">
        
        
          Step 1 - Define the types for the state, action, then use them to create a reducer function <a href="#step-1---define-the-types-for-the-state-action-then-use-them-to-create-a-reducer-function">#</a>
        
        
      </h3>
    

<p>We will use a TypeScript feature called
<a href="https://www.TypeScriptlang.org/docs/handbook/2/narrowing.html#discriminated-unions">discriminated unions</a>
in order to make our actions typesafe.</p>

<ol>
  <li>The type of the reducer function is <code class="language-plaintext highlighter-rouge">Reducer&lt;State | undefined, Action&gt;</code>. The
<code class="language-plaintext highlighter-rouge">undefined</code> is to cover the case when the initial state must be created by the reducer.</li>
  <li>If you try and replace the <code class="language-plaintext highlighter-rouge">Reducer&lt;State ... , Action&gt;</code> w/ a type variable that holds
the same thing, then it will not work for some reason w/ TypeScript.</li>
</ol>

<blockquote>
  <p>💡 The reducer function is called that because it is meant to be analogous to
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce"><code class="language-plaintext highlighter-rouge">Array.reduce()</code></a>
which takes all the items in an array and returns a single “thing”.</p>

  <p>Reducer functions take the state and current action and produce a single “thing”, which
is the new state.</p>

  <p>Now, imagine putting all the actions that would be dispatched over the lifetime of an
app and then put them into an array and then “apply” them to the reducer function
(taking the resulting state from dispatching an action and passing it to the next action
and so on). Ultimately you end up w/ a single result which is the final state of the
app. Thinking of it this way, it sort of fits how the <code class="language-plaintext highlighter-rouge">Array.reduce()</code> function works
🤷.</p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Types.</span>
<span class="kd">type</span> <span class="nx">Text</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">id</span><span class="p">:</span> <span class="kr">string</span>
  <span class="na">content</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">textArray</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionAdd</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span>
  <span class="nx">content</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionRemove</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">Action</span> <span class="o">=</span> <span class="nx">ActionAdd</span> <span class="o">|</span> <span class="nx">ActionRemove</span>

<span class="c1">// Reducer function.</span>
<span class="kd">const</span> <span class="nx">reducerFn</span><span class="p">:</span> <span class="nx">Reducer</span><span class="o">&lt;</span><span class="nx">State</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">):</span> <span class="nx">State</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">textArray</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nf">uniqueId</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">),</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fffff</span><span class="dl">"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nf">uniqueId</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">),</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gggg</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">],</span>
    <span class="p">}</span>

  <span class="k">switch </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="na">newText</span><span class="p">:</span> <span class="nx">Text</span> <span class="o">=</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nf">uniqueId</span><span class="p">(</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">),</span> <span class="na">content</span><span class="p">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">content</span> <span class="p">}</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">add</span><span class="dl">"</span><span class="p">,</span> <span class="nx">newText</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">copyOfArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="p">().</span><span class="nf">concat</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">textArray</span><span class="p">)</span>
      <span class="nx">copyOfArray</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">newText</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span> <span class="na">textArray</span><span class="p">:</span> <span class="nx">copyOfArray</span> <span class="p">})</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Get the index (the string we want to remove).</span>
      <span class="kd">const</span> <span class="na">id</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span>
      <span class="c1">// Make a copy of the old state and remove the element w/ the given id</span>
      <span class="kd">const</span> <span class="nx">copyOfArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Text</span><span class="o">&gt;</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">textArray</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">filter</span><span class="p">((</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">it</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">id</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
      <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">({}</span> <span class="k">as</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span> <span class="na">textArray</span><span class="p">:</span> <span class="nx">copyOfArray</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">state</span>
<span class="p">}</span>
</code></pre></div></div>
      <h4 id="no-side-effects-pure-functions-only">
        
        
          No side effects, pure functions only <a href="#no-side-effects-pure-functions-only">#</a>
        
        
      </h4>
    

<p>Reducer functions can’t have side effects, and must be pure functions; so there can’t be
things like fetch calls, async timers, console logging, random number generator use, or
even <code class="language-plaintext highlighter-rouge">Date.now()</code> in them.</p>

<p>In order to do these important things, please use <a href="#enhancer">enhancers</a> and / or
<a href="#middleware">middleware</a>.</p>

<p>Here are a
<a href="https://redux.js.org/tutorials/fundamentals/part-3-state-actions-reducers#rules-of-reducers">list of rules</a>
that reducers must follow.</p>

<blockquote>
  <p>💡 One of the benefits of using pure functions here is easy implementation of
<a href="#undo-history">undo history</a>.</p>
</blockquote>
      <h3 id="step-2---create-a-store-that-uses-this-reducer-function">
        
        
          Step 2 - Create a store that uses this reducer function <a href="#step-2---create-a-store-that-uses-this-reducer-function">#</a>
        
        
      </h3>
    

<blockquote>
  <p>💡 If you split reducers, then this is where you would declare all the ones that
comprise the root reducer function.</p>
</blockquote>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Redux store.</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">configureStore</span><span class="p">({</span>
  <span class="na">reducer</span><span class="p">:</span> <span class="nx">reducerFn</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div></div>
      <h3 id="step-3---wrap-the-components-that-will-share-this-state-with-a-provider-tag">
        
        
          Step 3 - Wrap the component(s) that will share this state with a Provider tag <a href="#step-3---wrap-the-components-that-will-share-this-state-with-a-provider-tag">#</a>
        
        
      </h3>
    

<p>Wrap the component(s) that will share this state with
<code class="language-plaintext highlighter-rouge">&lt;Provider store={store}&gt;...&lt;/Provider&gt;</code> where <code class="language-plaintext highlighter-rouge">store</code> is what you created and exported in
<a href="#step-2---create-a-store-that-uses-this-reducer-function">this step</a>.</p>

<blockquote>
  <p>💡 Wrapping your component in this tag and passing the store allows hooks like
<a href="#step-5---make-sure-to-dispatch-actions-in-your-components-to-change-shared-state"><code class="language-plaintext highlighter-rouge">useDispatch()</code></a>
and
<a href="#step-4---subscribe-your-components-to-the-store-with-useselector-hook"><code class="language-plaintext highlighter-rouge">useSelector()</code></a>
to work their “magic” (ie, not having to explicitly import and use the store).</p>
</blockquote>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store</span><span class="p">=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nc">SimpleReduxComponent</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>💡 Here’s the official Redux documentation on using a
<a href="https://redux.js.org/tutorials/fundamentals/part-5-ui-react#passing-the-store-with-provider"><code class="language-plaintext highlighter-rouge">Provider</code></a>.</p>
</blockquote>
      <h3 id="step-4---subscribe-your-components-to-the-store-with-useselector-hook">
        
        
          Step 4 - Subscribe your component(s) to the store with useSelector hook <a href="#step-4---subscribe-your-components-to-the-store-with-useselector-hook">#</a>
        
        
      </h3>
    

<p>In your component, make sure to subscribe to the store, using the
<a href="#useselector-hook-and-react"><code class="language-plaintext highlighter-rouge">useSelector()</code></a> hook.</p>

<blockquote>
  <p>💡 This is used instead of the old
<a href="https://react-redux.js.org/using-react-redux/connect-mapstate"><code class="language-plaintext highlighter-rouge">mapStateToProps</code> / ‘connect’</a>
mechanism. When the state changes in the store then, the new state will be passed to
this component (by the hook), and it will be re-rendered.</p>

  <p>This is somewhat equivalent to the <a href="#usereducer"><code class="language-plaintext highlighter-rouge">useReducer()</code></a> hook, in the sense that
you will get the state from this hook.</p>

  <p>If you split reducers, then you can select just a subset of the state that you are
interested in (in the function that you pass to the <code class="language-plaintext highlighter-rouge">useSelector()</code> hook).</p>
</blockquote>

<div class="language-tsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">_also</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="c1">// function component.</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">SimpleReduxComponent</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">state</span><span class="p">:</span> <span class="nx">DefaultRootState</span> <span class="o">=</span> <span class="nf">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">myState</span> <span class="o">=</span> <span class="nx">state</span> <span class="k">as</span> <span class="nx">State</span>
  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>⚡ Note the <code class="language-plaintext highlighter-rouge">_also</code> is a scope function (that is inspired by Kotlin) which you can get
from <a href="https://www.npmjs.com/package/r3bl-ts-utils"><code class="language-plaintext highlighter-rouge">r3bl-ts-utils</code></a> npm module.</p>
</blockquote>
      <h3 id="step-5---make-sure-to-dispatch-actions-in-your-components-to-change-shared-state">
        
        
          Step 5 - Make sure to dispatch actions in your component(s) to change shared state <a href="#step-5---make-sure-to-dispatch-actions-in-your-components-to-change-shared-state">#</a>
        
        
      </h3>
    

<p>In your component, make sure to call <code class="language-plaintext highlighter-rouge">store.dispatch({/* action */})</code> in order to request
changes to happen to your store. This will trigger re-renders of the components that are
subscribed to the store.</p>

<blockquote>
  <p>💡 Instead of importing the store in order to dispatch actions to it, you can also use
the
<a href="https://redux.js.org/tutorials/fundamentals/part-5-ui-react#dispatching-actions-with-usedispatch"><code class="language-plaintext highlighter-rouge">useDispatch()</code></a>
hook, which simply returns the store (that your React component has access to, since
there’s a <code class="language-plaintext highlighter-rouge">Provider</code> in its hierarchy).</p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">_also</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="c1">// function component.</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">SimpleReduxComponent</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">state</span><span class="p">:</span> <span class="nx">DefaultRootState</span> <span class="o">=</span> <span class="nf">useSelector</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">myState</span> <span class="o">=</span> <span class="nx">state</span> <span class="k">as</span> <span class="nx">State</span>

  <span class="kd">const</span> <span class="nx">addListItem</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span>
    <span class="nf">_also</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Nazmulnadiaidris</span><span class="dl">"</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)),</span>
      <span class="p">}</span> <span class="k">as</span> <span class="nx">ActionAdd</span><span class="p">,</span>
      <span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="nx">it</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">)</span>

  <span class="kd">const</span> <span class="nx">removeListItem</span> <span class="o">=</span> <span class="p">(</span><span class="na">it</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nf">_also</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="nx">it</span> <span class="p">}</span> <span class="k">as</span> <span class="nx">ActionRemove</span><span class="p">,</span> <span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="nx">it</span><span class="p">)</span>
    <span class="p">})</span>

  <span class="kd">const</span> <span class="nx">render</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">Container</span><span class="dl">"</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">addListItem</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Add</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">ol</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">myState</span><span class="p">.</span><span class="nx">textArray</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">text</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
          <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">text</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nf">removeListItem</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="nx">text</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>        <span class="p">))}</span>
      <span class="o">&lt;</span><span class="sr">/ol</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">)</span>

  <span class="k">return</span> <span class="nf">render</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>⚡ Here’s the full example in a single source file
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/redux/SimpleReduxComponent.tsx"><code class="language-plaintext highlighter-rouge">SimpleReduxComponent.tsx</code></a>.</p>
</blockquote>
      <h3 id="immutability">
        
        
          Immutability <a href="#immutability">#</a>
        
        
      </h3>
    

<p>One of the core concepts in Redux is that the state is immutable. There are a few
approaches to make this happen.</p>

<p>This is a great
<a href="https://reactkungfu.com/2015/08/pros-and-cons-of-using-immutability-with-react-js/">article</a>
on reference equality, value equality, shallow and deep copy, and how to achieve
immutability w/out using any external libraries using the following idioms.</p>

<ul>
  <li>Objects: <code class="language-plaintext highlighter-rouge">Object.assign({}, originalObject, {propertyToChange:'value'})</code></li>
  <li>Arrays: <code class="language-plaintext highlighter-rouge">[].concat(oldArray)</code></li>
</ul>

<p>Since Redux and React compare references to determine equality, it isn’t necessary to
perform a deep copy of all the things, and copying objects and arrays that are contained
in the state should suffice for most situations.</p>

<blockquote>
  <p>💡 Here are other approaches you can take instead of the idioms shown above.</p>

  <ol>
    <li>You can use lodash <a href="https://lodash.com/docs#clone"><code class="language-plaintext highlighter-rouge">clone</code></a>.</li>
    <li>Yet another approach is to use the <a href="https://immerjs.github.io/immer/">immer</a> library.</li>
  </ol>
</blockquote>
      <h3 id="selectors">
        
        
          Selectors <a href="#selectors">#</a>
        
        
      </h3>
    

<p><a href="https://redux.js.org/tutorials/fundamentals/part-2-concepts-data-flow#selectors">Selectors</a>
are simply functions that know how to extract specific pieces of information from a
store’s state value. As an application grows larger, this is a way to keep from repeating
this logic which would provide slices of state data needed by different parts of the app.
Here’s an example:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="nx">Foo</span> <span class="p">}</span>
<span class="kd">type</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="nx">object</span>

<span class="kd">const</span> <span class="nx">selectFooValue</span><span class="p">:</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">foo</span>

<span class="kd">const</span> <span class="nx">fooValue</span><span class="p">:</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="nf">selectFooValue</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nf">getState</span><span class="p">())</span>
</code></pre></div></div>
      <h4 id="useselector-hook-and-react">
        
        
          useSelector hook and React <a href="#useselector-hook-and-react">#</a>
        
        
      </h4>
    

<p>The
<a href="https://redux.js.org/tutorials/fundamentals/part-5-ui-react#reading-state-from-the-store-with-useselector"><code class="language-plaintext highlighter-rouge">useSelector()</code></a>
hook that comes w/ <code class="language-plaintext highlighter-rouge">react-redux</code> takes a selector and automatically subscribes it to the
store, all in a single step. It also
<a href="https://github.com/reduxjs/react-redux/blob/v7.2.2/src/hooks/useSelector.js#L81">automatically unsubscribes</a>
from the store.</p>

<blockquote>
  <p>💡 When you wrap your component in a <code class="language-plaintext highlighter-rouge">Provider</code> tag, this allows the hook to get access
to the store and do its thing. This is similar to how the <code class="language-plaintext highlighter-rouge">useDispatch()</code> hook gets
access to the store.</p>
</blockquote>
      <h3 id="split-and-combine-reducers">
        
        
          Split and combine reducers <a href="#split-and-combine-reducers">#</a>
        
        
      </h3>
    

<p>Instead of having a single “root” reducer function you can split them up based on the
shape of your store’s state value. For example if your state has two top level properties
like this <code class="language-plaintext highlighter-rouge">{ foo:{}, bar:{} }</code> then you could have two reducer functions: <code class="language-plaintext highlighter-rouge">fooReducer()</code>
and <code class="language-plaintext highlighter-rouge">barReducer()</code>.</p>

<blockquote>
  <p>⚠ The state parameter is different for every reducer, and corresponds to the part of the
state it manages.</p>
</blockquote>

<p>You can then join them together like this:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="nx">Foo</span><span class="p">;</span> <span class="nl">bar</span><span class="p">:</span> <span class="nx">Bar</span> <span class="p">}</span>
<span class="kd">type</span> <span class="nx">Foo</span> <span class="o">=</span> <span class="nx">object</span>
<span class="kd">type</span> <span class="nx">Bar</span> <span class="o">=</span> <span class="nx">object</span>

<span class="kd">function</span> <span class="nf">fooReducer</span><span class="p">(</span><span class="nx">stateFragment</span><span class="p">:</span> <span class="nx">Foo</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">function</span> <span class="nf">barReducer</span><span class="p">(</span><span class="nx">stateFragment</span><span class="p">:</span> <span class="nx">Bar</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">rootReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">foo</span><span class="p">:</span> <span class="nf">fooReducer</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">foo</span><span class="p">,</span> <span class="nx">action</span><span class="p">),</span>
  <span class="na">bar</span><span class="p">:</span> <span class="nf">barReducer</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">bar</span><span class="p">,</span> <span class="nx">action</span><span class="p">),</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Or even more concisely using the following:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">combineReducers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">rootReducer</span> <span class="o">=</span> <span class="nf">combineReducers</span><span class="p">({</span>
  <span class="na">foo</span><span class="p">:</span> <span class="nx">fooReducer</span><span class="p">,</span>
  <span class="na">bar</span><span class="p">:</span> <span class="nx">barReducer</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div></div>

<blockquote>
  <p>💡 Here’s more information on
<a href="https://redux.js.org/tutorials/fundamentals/part-3-state-actions-reducers#splitting-reducers">splitting</a>
and
<a href="https://redux.js.org/tutorials/fundamentals/part-3-state-actions-reducers#combining-reducers">combining</a>
reducers.</p>
</blockquote>
      <h3 id="enhancer">
        
        
          Enhancer <a href="#enhancer">#</a>
        
        
      </h3>
    

<p>A
<a href="https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers">store enhancer</a>
is a
<a href="https://en.wikipedia.org/wiki/Higher-order_function#JavaScript">higher-order function</a>
that allows you to override the following store methods, and allow you to write code that
hooks into the store’s lifecycle events.</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">dispatch()</code> - You can modify the original <code class="language-plaintext highlighter-rouge">store.dispatch()</code> method, and do things
like log actions and states.</p>

    <blockquote>
      <p>💡 You can generate <a href="#no-side-effects-pure-functions-only">side effects</a>, by making
async calls here (timers and REST APIs), do logging, crash reporting, routing, modify
actions, pause or even stop the action entirely, etc. If you just want to override
this and nothing else, you can use <a href="#middleware">middleware</a> instead of
<a href="#enhancer">enhancers</a>.</p>
    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">getState()</code> - You can modify the original <code class="language-plaintext highlighter-rouge">store.getState()</code> method, and modify the
state that gets returned.</li>
  <li><code class="language-plaintext highlighter-rouge">subscribe()</code> - You can modify the original <code class="language-plaintext highlighter-rouge">store.subscribe()</code> method.</li>
</ol>

<blockquote>
  <p>⚡ Here’s a source code example from the official Redux docs.</p>

  <ol>
    <li><a href="https://codesandbox.io/s/github/reduxjs/redux-fundamentals-example-app/tree/master/">codesandbox.io</a>.</li>
    <li><a href="https://github.com/reduxjs/redux-fundamentals-example-app/tree/master/">github repo</a>.</li>
  </ol>
</blockquote>
      <h4 id="intercept-action-dispatch">
        
        
          Intercept action dispatch <a href="#intercept-action-dispatch">#</a>
        
        
      </h4>
    

<p>Here’s an example of how to create an enhancer that just calls <code class="language-plaintext highlighter-rouge">console.log</code> when actions
are dispatched.</p>

<blockquote>
  <p>💡 Note that the original store is enhanced w/ a new <code class="language-plaintext highlighter-rouge">dispatch</code> property which has the
<code class="language-plaintext highlighter-rouge">myDispatchFn</code> function (which simply adds to the original <code class="language-plaintext highlighter-rouge">store.dispatch()</code> function).</p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">consoleLogOnDispatch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">createStore</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="nx">preloadedState</span><span class="p">,</span> <span class="nx">enhancers</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="nx">preloadedState</span><span class="p">,</span> <span class="nx">enhancers</span><span class="p">)</span>

    <span class="kd">function</span> <span class="nf">myDispatchFn</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">action dispatched</span><span class="dl">"</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">new state</span><span class="dl">"</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">result</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">store</span><span class="p">,</span> <span class="na">dispatch</span><span class="p">:</span> <span class="nx">myDispatchFn</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">consoleLogOnDispatch</span><span class="p">)</span>
</code></pre></div></div>
      <h4 id="intercept-state-creation">
        
        
          Intercept state creation <a href="#intercept-state-creation">#</a>
        
        
      </h4>
    

<p>You can also intercept new state creation. This is a really powerful way of modifying the
state. This is an example of state modification that adds <code class="language-plaintext highlighter-rouge">timestampMs</code> which is a
property that holds the current time in ms when the state was created.</p>

<blockquote>
  <p>💡 Note that the original store is enhanced w/ a new <code class="language-plaintext highlighter-rouge">getState</code> property which has the
<code class="language-plaintext highlighter-rouge">myGetStateFn</code> function (which simply adds to the original <code class="language-plaintext highlighter-rouge">store.getState()</code> function).</p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">includeTimestamp</span> <span class="o">=</span> <span class="p">(</span><span class="nx">createStore</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="nx">preloadedState</span><span class="p">,</span> <span class="nx">enhancers</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="nx">preloadedState</span><span class="p">,</span> <span class="nx">enhancers</span><span class="p">)</span>

    <span class="kd">function</span> <span class="nf">myGetStateFn</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">store</span><span class="p">.</span><span class="nf">getState</span><span class="p">(),</span>
        <span class="na">timestampMs</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">store</span><span class="p">,</span> <span class="na">getState</span><span class="p">:</span> <span class="nx">myGetStateFn</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
      <h4 id="combining-both-overrides">
        
        
          Combining both overrides <a href="#combining-both-overrides">#</a>
        
        
      </h4>
    

<p>In order to use both of these enhancers shown above, you can use the
<a href="https://redux.js.org/api/compose"><code class="language-plaintext highlighter-rouge">compose</code></a> function.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">compose</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span>
  <span class="nx">rootReducer</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="nf">compose</span><span class="p">(</span><span class="nx">includeTimestamp</span><span class="p">,</span> <span class="nx">consoleLogOnDispatch</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>
      <h3 id="middleware">
        
        
          Middleware <a href="#middleware">#</a>
        
        
      </h3>
    

<p>Unlike <a href="#enhancer">enhancers</a> middleware restrict store enhancements to just changing the
<code class="language-plaintext highlighter-rouge">dispatch()</code> function. Redux middleware provides an extension point, where we can attach
our code, between Redux dispatching an action to the store, and the moment it reaches the
reducer.</p>

<blockquote>
  <p>💡 You can generate <a href="#no-side-effects-pure-functions-only">side effects</a>, by making
async calls here (timers and REST APIs), do logging, crash reporting, routing, modify
actions, pause or even stop the action entirely, etc. If you just want to override this
and nothing else, you can use <a href="#middleware">middleware</a> instead of
<a href="#enhancer">enhancers</a>.</p>
</blockquote>

<blockquote>
  <p>⚡ Here is the
<a href="https://redux.js.org/tutorials/fundamentals/part-4-store#middleware">official Redux middleware documentation</a>.</p>
</blockquote>

<p>Here’s an example of a single middleware function. You can actually have many of them
chained together.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">composeWithDevTools</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux-devtools-extension</span><span class="dl">"</span>

<span class="kd">function</span> <span class="nf">myMiddlewareWithResultOnDispatch</span><span class="p">(</span><span class="nx">store</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nf">wrapDispatch</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nf">handleAction</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Do anything here, then pass the action onwards with next(action),</span>
      <span class="c1">// or restart the pipeline with store.dispatch(action).</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">dispatching</span><span class="dl">"</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>

      <span class="c1">// Can also use store.getState() here.</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">next state</span><span class="dl">"</span><span class="p">,</span> <span class="nx">store</span><span class="p">.</span><span class="nf">getState</span><span class="p">())</span>
      <span class="c1">// Will be returned by store.dispatch(action).</span>
      <span class="k">return</span> <span class="nx">result</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span>
  <span class="nx">rootReducer</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="nf">composeWithDevTools</span><span class="p">(</span><span class="nf">applyMiddleware</span><span class="p">(</span><span class="nx">myMiddlewareWithResultOnDispatch</span><span class="p">))</span>
<span class="p">)</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<blockquote>
  <p>💡 <a href="https://github.com/zalmoxisus/redux-devtools-extension"><code class="language-plaintext highlighter-rouge">composeWithDevTools</code></a> wraps
the middleware so that you can debug it in
<a href="https://developer.chrome.com/docs/devtools/">Chrome DevTools</a> after you install the
<a href="https://github.com/zalmoxisus/redux-devtools-extension">Redux DevTools Chrome extension</a>.</p>
</blockquote>

<p>Notes on this code.</p>

<ol>
  <li>This middleware actually returns something when <code class="language-plaintext highlighter-rouge">store.dispatch(action)</code> is called. You
don’t have to use this but its there if you need this behavior. Typically the last line
would be <code class="language-plaintext highlighter-rouge">return next(action)</code>.</li>
  <li>The call to <code class="language-plaintext highlighter-rouge">next(action)</code> is a continuation of the journey of the <code class="language-plaintext highlighter-rouge">action</code> to the next
middleware in the chain of middleware that may be in the pipeline.</li>
  <li>You can use <code class="language-plaintext highlighter-rouge">store.getState()</code> to access the store’s state object at any point.</li>
</ol>

<p>Here’s a chain of simpler middleware that don’t return a result and use more concise arrow
functions syntax.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">middlewareConsoleLog</span> <span class="o">=</span> <span class="p">(</span><span class="nx">store</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">action</span><span class="dl">"</span><span class="p">,</span> <span class="nx">action</span><span class="p">,</span> <span class="dl">"</span><span class="s2">state</span><span class="dl">"</span><span class="p">,</span> <span class="nx">store</span><span class="p">.</span><span class="nf">getState</span><span class="p">())</span>
  <span class="k">return</span> <span class="nf">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">middlewareConsoleError</span> <span class="o">=</span> <span class="p">(</span><span class="nx">store</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">action</span><span class="dl">"</span><span class="p">,</span> <span class="nx">action</span><span class="p">,</span> <span class="dl">"</span><span class="s2">state</span><span class="dl">"</span><span class="p">,</span> <span class="nx">store</span><span class="p">.</span><span class="nf">getState</span><span class="p">())</span>
  <span class="k">return</span> <span class="nf">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span>
  <span class="nx">rootReducer</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="nf">applyMiddleware</span><span class="p">(</span><span class="nx">middlewareConsoleLog</span><span class="p">,</span> <span class="nx">middlewareConsoleError</span><span class="p">)</span>
<span class="p">)</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<p>Notes on this code.</p>

<ol>
  <li>Middleware form a pipeline around the store’s dispatch method. When we call
<code class="language-plaintext highlighter-rouge">store.dispatch(action)</code> we are actually just calling the first middleware in the
pipeline (which is <code class="language-plaintext highlighter-rouge">middlewareConsoleLog</code> function). Typically, a middleware will check
to see if the action is a specific type that it cares about, much like a reducer would.
If it’s the right type, the middleware might run some custom logic. Otherwise, it
passes the action to the next middleware in the pipeline.</li>
  <li>Unlike a reducer, middleware can have
<a href="#no-side-effects-pure-functions-only">side effects</a>, including timeouts and other
async logic.</li>
  <li>When an action is dispatched to the store, the <code class="language-plaintext highlighter-rouge">middlewareConsoleLog</code> middleware is the
first to run and the last to finish. Here are the functions that the <code class="language-plaintext highlighter-rouge">action</code> is passed
thru, when <code class="language-plaintext highlighter-rouge">store.dispatch(action)</code> is called.</li>
  <li><code class="language-plaintext highlighter-rouge">middlewareConsoleLog</code> (due to <code class="language-plaintext highlighter-rouge">store.dispatch(action)</code> call)</li>
  <li><code class="language-plaintext highlighter-rouge">middlewareConsoleError</code></li>
  <li>Original call to <code class="language-plaintext highlighter-rouge">store.dispatch(action)</code></li>
  <li>The root reducer inside <code class="language-plaintext highlighter-rouge">store</code></li>
</ol>
      <h3 id="async-logic-and-data-fetching">
        
        
          Async logic and data fetching <a href="#async-logic-and-data-fetching">#</a>
        
        
      </h3>
    

<p>Here is an example of running async code in middleware:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">delayedActionMiddleware</code> uses <code class="language-plaintext highlighter-rouge">setTimeout()</code> to delay execution of an action.</li>
  <li><code class="language-plaintext highlighter-rouge">fetchTodosMiddleware</code> uses <code class="language-plaintext highlighter-rouge">axios</code> to make a REST API call.</li>
</ol>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">delayedActionMiddleware</span> <span class="o">=</span> <span class="p">(</span><span class="nx">store</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">todos/todoAdded</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Delay this action by one second.</span>
    <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nf">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">fetchTodosMiddleware</span> <span class="o">=</span> <span class="p">(</span><span class="nx">store</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">todos/fetchTodos</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Make an async API call to fetch todos from the server.</span>
    <span class="nf">_also</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://myapi.com/endpoint</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">it</span><span class="p">)</span>
      <span class="c1">// Dispatch an action with the todos we received.</span>
      <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">todos/todosLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nf">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span>
  <span class="nx">rootReducer</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="nf">applyMiddleware</span><span class="p">(</span><span class="nx">delayedActionMiddleware</span><span class="p">,</span> <span class="nx">fetchTodosMiddleware</span><span class="p">)</span>
<span class="p">)</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">todos/todoAdded</span><span class="dl">"</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="p">[]</span> <span class="p">})</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">todos/fetchTodos</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>
      <h4 id="redux-thunk-middleware">
        
        
          Redux “Thunk” middleware <a href="#redux-thunk-middleware">#</a>
        
        
      </h4>
    

<p>Additionally, Redux provides a
<a href="https://github.com/reduxjs/redux-thunk"><code class="language-plaintext highlighter-rouge">redux-thunk</code> middleware</a> which allows you to
dispatch functions to the store rather than actions.</p>

<blockquote>
  <p>⚡ This is available via npm (<code class="language-plaintext highlighter-rouge">npm i redux-thunk</code>) if you want to use it.</p>
</blockquote>

<ul>
  <li>Pros:
    <ol>
      <li>You can re-use business logic that isn’t tied to a specific store.</li>
    </ol>
  </li>
  <li>Cons:
    <ol>
      <li>You <a href="https://redux.js.org/usage/usage-with-TypeScript#type-checking-middleware">lose</a>
some TypeScript protections and have to
<a href="https://mariusschulz.com/blog/the-unknown-type-in-TypeScript"><code class="language-plaintext highlighter-rouge">unknown</code></a> type escape
hatch.</li>
      <li>It is yet another pattern to learn / adopt, even though you can just make your own
<a href="#enhancer">enhancer</a> or <a href="#middleware">middleware</a>. And the code for thunk middleware
is about <a href="https://github.com/reduxjs/redux-thunk/blob/master/src/index.js">14 LOC</a>.</li>
    </ol>
  </li>
</ul>

<blockquote>
  <p>💡 This <a href="https://morioh.com/p/8f447daaaca6">article</a> goes into a lot of detail about
thunks and how to think about them, and use them.</p>
</blockquote>

<p>This is how you can use the <code class="language-plaintext highlighter-rouge">redux-thunk</code> middleware.</p>

<blockquote>
  <p>💡 A thunk can also return a promise. And a component can await the result of that
promise in a component. You can pass both async and “normal” functions to <code class="language-plaintext highlighter-rouge">dispatch</code>.
Here are the
<a href="https://redux.js.org/tutorials/fundamentals/part-7-standard-patterns#thunks-and-promises">official Redux docs</a>
on this.</p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">thunkMiddleware</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux-thunk</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">composeWithDevTools</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux-devtools-extension</span><span class="dl">"</span>

<span class="c1">// The store now has the ability to accept thunk functions in `dispatch`.</span>
<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span>
  <span class="nx">rootReducer</span><span class="p">,</span>
  <span class="kc">undefined</span><span class="p">,</span>
  <span class="nf">composeWithDevTools</span><span class="p">(</span><span class="nf">applyMiddleware</span><span class="p">(</span><span class="nx">thunkMiddleware</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1">// This function returns a function which returns a promise.</span>
<span class="c1">// More info: https://stackoverflow.com/q/54426176/2085356</span>
<span class="kd">function</span> <span class="nf">loadDataReturnsPromise</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return </span><span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">axios</span>
      <span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://myapi.com/endpoint</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">())</span>
      <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">todos/todosLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span> <span class="p">}))</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">error loading data</span><span class="dl">"</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// function component that uses the async function (aka a promise is returned) above.</span>
<span class="kd">const</span> <span class="nx">Header</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">text</span><span class="p">,</span> <span class="nx">setText</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="dl">""</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">status</span><span class="p">,</span> <span class="nx">setStatus</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="dl">"</span><span class="s2">idle</span><span class="dl">"</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="nf">useDispatch</span><span class="p">()</span>

  <span class="kd">const</span> <span class="nx">handleChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">setText</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">handleKeyDown</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// If the user pressed the Enter key:</span>
    <span class="kd">const</span> <span class="nx">trimmedText</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nf">trim</span><span class="p">()</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">===</span> <span class="mi">13</span> <span class="o">&amp;&amp;</span> <span class="nx">trimmedText</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Create and dispatch the thunk function itself</span>
      <span class="nf">setStatus</span><span class="p">(</span><span class="dl">"</span><span class="s2">loading</span><span class="dl">"</span><span class="p">)</span>

      <span class="c1">// Wait for the promise returned by loadDataReturnsPromise.</span>
      <span class="k">await</span> <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="nx">loadDataReturnsPromise</span><span class="p">)</span> <span class="c1">// We are dispatching a function, not an action!</span>

      <span class="c1">// And clear out the text input</span>
      <span class="nf">setText</span><span class="p">(</span><span class="dl">""</span><span class="p">)</span>
      <span class="nf">setStatus</span><span class="p">(</span><span class="dl">"</span><span class="s2">idle</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">let</span> <span class="nx">isLoading</span> <span class="o">=</span> <span class="nx">status</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">loading</span><span class="dl">"</span>
  <span class="kd">let</span> <span class="nx">placeholder</span> <span class="o">=</span> <span class="nx">isLoading</span> <span class="p">?</span> <span class="dl">""</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">Press enter to load data</span><span class="dl">"</span>
  <span class="kd">let</span> <span class="nx">loader</span> <span class="o">=</span> <span class="nx">isLoading</span> <span class="p">?</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">loader</span><span class="dl">"</span> <span class="o">/&gt;</span> <span class="p">:</span> <span class="kc">null</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">header</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">input</span>
        <span class="nx">placeholder</span><span class="o">=</span><span class="p">{</span><span class="nx">placeholder</span><span class="p">}</span>
        <span class="nx">autoFocus</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span>
        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">text</span><span class="p">}</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">handleChange</span><span class="p">}</span>
        <span class="nx">onKeyDown</span><span class="o">=</span><span class="p">{</span><span class="nx">handleKeyDown</span><span class="p">}</span>
        <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span>
      <span class="sr">/</span><span class="err">&gt;
</span>      <span class="p">{</span><span class="nx">loader</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/header</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>💡 <a href="https://github.com/zalmoxisus/redux-devtools-extension"><code class="language-plaintext highlighter-rouge">composeWithDevTools</code></a> wraps
the middleware so that you can debug it in
<a href="https://developer.chrome.com/docs/devtools/">Chrome DevTools</a> after you install the
<a href="https://github.com/zalmoxisus/redux-devtools-extension">Redux DevTools Chrome extension</a>.</p>
</blockquote>

<p>The following is a simplistic example of how we could implement the “Thunk” middleware
itself. Also,
<a href="https://github.com/reduxjs/redux-thunk/blob/master/src/index.js">here is the actual implementation</a>
of <code class="language-plaintext highlighter-rouge">redux-thunk</code>.</p>

<blockquote>
  <p>💡 The core idea here is creating a function that takes <code class="language-plaintext highlighter-rouge">dispatch</code> and <code class="language-plaintext highlighter-rouge">getState</code>
functions from the store, and then uses them in order to dispatch an action after
executing some async logic. By passing the <code class="language-plaintext highlighter-rouge">dispatch</code> and <code class="language-plaintext highlighter-rouge">getState</code> to the lambda that
you’re passing, it frees this logic from being tied to a specific store.</p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">asyncFunctionMiddleware</span> <span class="o">=</span> <span class="p">(</span><span class="nx">store</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// If the "action" is actually a function instead ...</span>
  <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">action</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">function</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Then call the function and pass `dispatch` and `getState` as arguments.</span>
    <span class="k">return</span> <span class="nf">action</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// Otherwise, it's a normal action - send it onwards.</span>
  <span class="k">return</span> <span class="nf">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">fetchSomeData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Make an async API call to fetch todos from the server.</span>
  <span class="nf">_also</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://myapi.com/endpoint</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">it</span><span class="p">)</span>
    <span class="c1">// Dispatch an action with the todos we received.</span>
    <span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">todos/todosLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">})</span>
    <span class="c1">// Check the updated store state after dispatching</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">State after loading: </span><span class="dl">"</span><span class="p">,</span> <span class="nf">getState</span><span class="p">())</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="nf">applyMiddleware</span><span class="p">(</span><span class="nx">asyncFunctionMiddleware</span><span class="p">))</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="nx">fetchSomeData</span><span class="p">)</span> <span class="c1">// We are dispatching a function, not an action!</span>
</code></pre></div></div>

<blockquote>
  <p>⚡ If you want to explore <code class="language-plaintext highlighter-rouge">redux-thunk</code> more deeply, here are the
<a href="https://redux.js.org/tutorials/fundamentals/part-6-async-logic#redux-async-data-flow">official Redux docs</a>.</p>
</blockquote>
      <h3 id="memoized-selectors-and-reselect">
        
        
          Memoized selectors and Reselect <a href="#memoized-selectors-and-reselect">#</a>
        
        
      </h3>
    

<p><a href="#useselector-hook-and-react">Selector</a> functions accept the Redux <code class="language-plaintext highlighter-rouge">state</code> object as an
argument and return a value. This is a great place where we can not only access parts of
the state, but also <em>derive</em> data from it.</p>

<p>Here’s an example of a selector function that takes some “todo” items in the state and
only returns an array of ids (for each todo item).</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Todo</span> <span class="p">{</span>
  <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">text</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">done</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">State</span> <span class="p">{</span>
  <span class="nl">todos</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">[]</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">selectTodoIds</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">):</span> <span class="kr">string</span><span class="p">[]</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">todos</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">it</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">it</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</code></pre></div></div>

<p>However, <code class="language-plaintext highlighter-rouge">Array.map()</code> will always return a new array reference. The <code class="language-plaintext highlighter-rouge">useSelector()</code> hook
will be run after every action is dispatched. And since this will result in a new array,
the component will re-render. Regardless of whether the <code class="language-plaintext highlighter-rouge">state.todos</code> has changed or not.</p>

<p>Clearly this is not desirable. We need to cache this array, so as not to force needless
re-renders. But we do need this selector function to return a new array when the
underlying <code class="language-plaintext highlighter-rouge">state.todos</code> actually changes.</p>

<p>What we need is a
<a href="https://redux.js.org/tutorials/fundamentals/part-7-standard-patterns#memoized-selectors">memoized selector function</a>.
Memoized selector functions are selectors that save the most recent result value, and if
you call them multiple times with the same inputs, will return the same result value. If
you call them with different inputs than last time, they will recalculate a new result
value, cache it, and return the new result.</p>

<p>This is where the <code class="language-plaintext highlighter-rouge">reselect</code> npm package comes in. We do have to modify our selector
function in order to use it w/ <code class="language-plaintext highlighter-rouge">reselect</code>.</p>

<blockquote>
  <p>⚡ You can install <code class="language-plaintext highlighter-rouge">reselect</code> via <code class="language-plaintext highlighter-rouge">npm i reselect</code>.</p>
</blockquote>

<p>We have to split our logic into two pieces:</p>

<ol>
  <li><em>Input selector</em> - This function allows <code class="language-plaintext highlighter-rouge">reselect</code> to understand what the inputs are.
It can cache the output for a given input, and if these don’t change, then it will be a
cache hit. When the input changes (from what was calculated earlier) then this is a
cache miss.</li>
  <li><em>Output selector</em> - This function allows the output value that will be cached, to
actually be generated. When there’s a cache hit, this won’t be run. When there’s a
cache miss, this will be executed with the argument(s) passed from the input selector.</li>
</ol>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createSelector</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">reselect</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">FC</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useSelector</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-redux</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">_also</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="kr">interface</span> <span class="nx">Todo</span> <span class="p">{</span>
  <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">text</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">done</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">State</span> <span class="p">{</span>
  <span class="nl">todos</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">[]</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">selectTodoIds</span> <span class="o">=</span> <span class="nf">createSelector</span><span class="p">(</span>
  <span class="cm">/* Input selector : */</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">):</span> <span class="nx">Todo</span><span class="p">[]</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span>
  <span class="cm">/* Output selector: */</span> <span class="p">(</span><span class="nx">todos</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">[]):</span> <span class="kr">string</span><span class="p">[]</span> <span class="o">=&gt;</span> <span class="nx">todos</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">it</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">it</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">TodoList</span><span class="p">:</span> <span class="nx">FC</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">todoIds</span><span class="p">:</span> <span class="kr">string</span><span class="p">[]</span> <span class="o">=</span> <span class="nf">useSelector</span><span class="p">(</span><span class="nx">selectTodoIds</span><span class="p">)</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nf">_also</span><span class="p">(</span><span class="k">new</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">ReactElement</span><span class="o">&gt;</span><span class="p">(),</span> <span class="p">(</span><span class="na">elem</span><span class="p">:</span> <span class="nx">ReactElement</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">todoIds</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="na">todoId</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="nx">elem</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">todoId</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">todoId</span><span class="o">=</span><span class="p">{</span><span class="nx">todoId</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/li&gt;</span><span class="err">)
</span>        <span class="p">)</span>
      <span class="p">})}</span>
    <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Any time the <code class="language-plaintext highlighter-rouge">state.todos</code> array changes, we’re going to create a new todo IDs array as a
result. That includes any immutable updates to todo items like toggling their <code class="language-plaintext highlighter-rouge">done</code>
field, since we have to create a new array for the immutable update.</p>

<p>This example only showed how to deal w/ one argument. What if you have a selector that can
handle multiple arguments? The <code class="language-plaintext highlighter-rouge">createSelector()</code> function can actually take any number of
input selectors as long as there is a single output selector. The set of values for the
input selectors and the output selector be cached. So let’s say that we want to extend the
example above to create a selector that only returns the todo ids that are marked as done.
Here’s what this might look like.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createSelector</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">reselect</span><span class="dl">"</span>

<span class="kr">interface</span> <span class="nx">Todo</span> <span class="p">{</span>
  <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">text</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">done</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">State</span> <span class="p">{</span>
  <span class="nl">todos</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">[]</span>
  <span class="nx">filterByDone</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">selectDoneTodoIds</span> <span class="o">=</span> <span class="nf">createSelector</span><span class="p">(</span>
  <span class="cm">/* Input selector #1 : */</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">):</span> <span class="nx">Todo</span><span class="p">[]</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">todos</span><span class="p">,</span>
  <span class="cm">/* Input selector #2 : */</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">filterByDone</span><span class="p">,</span>
  <span class="cm">/* Output selector   : */</span> <span class="p">(</span><span class="nx">todos</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">[],</span> <span class="nx">filterByDone</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">):</span> <span class="kr">string</span><span class="p">[]</span> <span class="o">=&gt;</span>
    <span class="nx">todos</span><span class="p">.</span><span class="nf">filter</span><span class="p">((</span><span class="nx">todo</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">done</span> <span class="o">===</span> <span class="kc">true</span><span class="p">).</span><span class="nf">map</span><span class="p">((</span><span class="nx">todo</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>
      <h3 id="undo-history">
        
        
          Undo history <a href="#undo-history">#</a>
        
        
      </h3>
    

<p>With Redux implementing undo history is a breeze.
<a href="https://redux.js.org/usage/implementing-undo-history">Here</a> are the official docs on
this. Since reducers are pure functions w/ no
<a href="#no-side-effects-pure-functions-only">side effects</a>, state is immutable, it makes it
possible to very easily switch to an older state in the stack of state histories!</p>
      <h4 id="data-structure-and-algorithm">
        
        
          Data structure and algorithm <a href="#data-structure-and-algorithm">#</a>
        
        
      </h4>
    

<p>Here’s the basic shape of the undo history data structure (or stack). <code class="language-plaintext highlighter-rouge">T</code> is the type of
the <code class="language-plaintext highlighter-rouge">state</code> object that’s in our Redux store.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">UndoHistory</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="na">past</span><span class="p">:</span> <span class="nx">T</span><span class="p">[]</span>
  <span class="na">present</span><span class="p">:</span> <span class="nx">T</span>
  <span class="na">future</span><span class="p">:</span> <span class="nx">T</span><span class="p">[]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We have to define two additional
<a href="#step-1---define-the-types-for-the-state-action-then-use-them-to-create-a-reducer-function">actions</a>
to operate on this state: <code class="language-plaintext highlighter-rouge">UndoAction</code> and <code class="language-plaintext highlighter-rouge">RedoAction</code>.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Undo and redo actions.</span>
<span class="kr">interface</span> <span class="nx">ActionUndo</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">UNDO</span><span class="dl">"</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionRedo</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">REDO</span><span class="dl">"</span>
<span class="p">}</span>

<span class="c1">// Other actions.</span>
<span class="kr">interface</span> <span class="nx">ActionAdd</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span>
  <span class="nx">content</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionRemove</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Action</span> <span class="o">=</span> <span class="nx">ActionAdd</span> <span class="o">|</span> <span class="nx">ActionRemove</span> <span class="o">|</span> <span class="nx">ActionUndo</span> <span class="o">|</span> <span class="nx">ActionRedo</span>
</code></pre></div></div>

<blockquote>
  <p>⚠ The undo and redo action types are both in all caps to preserve compatibility w/ the
<code class="language-plaintext highlighter-rouge">redux-undo</code> package (in case you want to use that) which is shown in the
<a href="#using-the-redux-undo-package">next section</a>.</p>
</blockquote>

<p>Here’s our algorithm to implement undo and redo.</p>

<ul>
  <li>Handling Other Actions:
    <ol>
      <li>Insert the <code class="language-plaintext highlighter-rouge">present</code> at the end of the <code class="language-plaintext highlighter-rouge">past</code>.</li>
      <li>Set the <code class="language-plaintext highlighter-rouge">present</code> to the new state after handling the action.</li>
      <li>Clear the <code class="language-plaintext highlighter-rouge">future</code>.</li>
    </ol>
  </li>
  <li>Handling Undo:
    <ol>
      <li>Remove the last element from the <code class="language-plaintext highlighter-rouge">past</code>.</li>
      <li>Set the <code class="language-plaintext highlighter-rouge">present</code> to the element we removed in the previous step.</li>
      <li>Insert the old <code class="language-plaintext highlighter-rouge">present</code> state at the beginning of the <code class="language-plaintext highlighter-rouge">future</code>.</li>
    </ol>
  </li>
  <li>Handling Redo:
    <ol>
      <li>Remove the first element from the <code class="language-plaintext highlighter-rouge">future</code>.</li>
      <li>Set the <code class="language-plaintext highlighter-rouge">present</code> to the element we removed in the previous step.</li>
      <li>Insert the old <code class="language-plaintext highlighter-rouge">present</code> state at the end of the <code class="language-plaintext highlighter-rouge">past</code>.</li>
    </ol>
  </li>
</ul>
      <h4 id="naive-implementation">
        
        
          Naive implementation <a href="#naive-implementation">#</a>
        
        
      </h4>
    

<p>Here’s what the code for this might look like, by creating a higher-order reducer to
handle the undo and redo actions.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux</span><span class="dl">"</span>

<span class="cm">/**
 * Define the undo reducer enhancer function, and the wrapped state shape.
 *
 * - S: the type of the actual state.
 * - A: the Action type of the discriminated union.
 */</span>

<span class="kr">interface</span> <span class="nx">UndoHistoryStateWrapper</span><span class="o">&lt;</span><span class="nx">S</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="na">past</span><span class="p">:</span> <span class="nx">S</span><span class="p">[]</span>
  <span class="na">present</span><span class="p">:</span> <span class="nx">S</span>
  <span class="na">future</span><span class="p">:</span> <span class="nx">S</span><span class="p">[]</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">undoable</span><span class="o">&lt;</span><span class="nx">S</span><span class="p">,</span> <span class="nx">A</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">reducer</span><span class="p">:</span> <span class="p">(</span><span class="nx">wrappedState</span><span class="p">:</span> <span class="nx">UndoHistoryStateWrapper</span><span class="o">&lt;</span><span class="nx">S</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">action</span><span class="p">:</span> <span class="nx">A</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">S</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Call the reducer with empty action to populate the initial state.</span>
  <span class="kd">const</span> <span class="nx">initialState</span><span class="p">:</span> <span class="nx">UndoHistoryStateWrapper</span><span class="o">&lt;</span><span class="nx">S</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">past</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">S</span><span class="o">&gt;</span><span class="p">(),</span>
    <span class="na">present</span><span class="p">:</span> <span class="nf">reducer</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{}),</span>
    <span class="na">future</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">S</span><span class="o">&gt;</span><span class="p">(),</span>
  <span class="p">}</span>

  <span class="c1">// Return a reducer that handles undo and redo</span>
  <span class="k">return</span> <span class="nf">function </span><span class="p">(</span>
    <span class="nx">wrappedState</span><span class="p">:</span> <span class="nx">UndoHistoryStateWrapper</span><span class="o">&lt;</span><span class="nx">S</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span>
    <span class="nx">action</span><span class="p">:</span> <span class="nx">A</span>
  <span class="p">):</span> <span class="nx">UndoHistoryStateWrapper</span><span class="o">&lt;</span><span class="nx">S</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">past</span><span class="p">,</span> <span class="nx">present</span><span class="p">,</span> <span class="nx">future</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">wrappedState</span>

    <span class="k">switch </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">undo</span><span class="dl">"</span><span class="p">:</span>
        <span class="kd">const</span> <span class="nx">previous</span> <span class="o">=</span> <span class="nx">past</span><span class="p">[</span><span class="nx">past</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="kd">const</span> <span class="nx">newPast</span> <span class="o">=</span> <span class="nx">past</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">past</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">past</span><span class="p">:</span> <span class="nx">newPast</span><span class="p">,</span>
          <span class="na">present</span><span class="p">:</span> <span class="nx">previous</span><span class="p">,</span>
          <span class="na">future</span><span class="p">:</span> <span class="p">[</span><span class="nx">present</span><span class="p">,</span> <span class="p">...</span><span class="nx">future</span><span class="p">],</span>
        <span class="p">}</span>
      <span class="k">case</span> <span class="dl">"</span><span class="s2">redo</span><span class="dl">"</span><span class="p">:</span>
        <span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">future</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="kd">const</span> <span class="nx">newFuture</span> <span class="o">=</span> <span class="nx">future</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">past</span><span class="p">:</span> <span class="p">[...</span><span class="nx">past</span><span class="p">,</span> <span class="nx">present</span><span class="p">],</span>
          <span class="na">present</span><span class="p">:</span> <span class="nx">next</span><span class="p">,</span>
          <span class="na">future</span><span class="p">:</span> <span class="nx">newFuture</span><span class="p">,</span>
        <span class="p">}</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="c1">// Delegate handling the action to the passed reducer.</span>
        <span class="kd">const</span> <span class="na">newPresent</span><span class="p">:</span> <span class="nx">S</span> <span class="o">=</span> <span class="nf">reducer</span><span class="p">(</span><span class="nx">present</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">present</span> <span class="o">===</span> <span class="nx">newPresent</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">wrappedState</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">past</span><span class="p">:</span> <span class="p">[...</span><span class="nx">past</span><span class="p">,</span> <span class="nx">present</span><span class="p">],</span>
          <span class="na">present</span><span class="p">:</span> <span class="nx">newPresent</span><span class="p">,</span>
          <span class="na">future</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use the enhanced reducer in the code below.</span>

<span class="kr">interface</span> <span class="nx">ActionUndo</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">UNDO</span><span class="dl">"</span> <span class="c1">// All caps for compatibility w/ `redux-undo` package.</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionRedo</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">REDO</span><span class="dl">"</span> <span class="c1">// All caps for compatibility w/ `redux-undo` package.</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionAdd</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span>
  <span class="nx">content</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">ActionRemove</span> <span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">Action</span> <span class="o">=</span> <span class="nx">ActionAdd</span> <span class="o">|</span> <span class="nx">ActionRemove</span> <span class="o">|</span> <span class="nx">ActionUndo</span> <span class="o">|</span> <span class="nx">ActionRedo</span>

<span class="kr">interface</span> <span class="nx">ActualState</span> <span class="p">{</span>
  <span class="nl">todos</span><span class="p">:</span> <span class="nx">Todo</span><span class="p">[]</span>
<span class="p">}</span>
<span class="kr">interface</span> <span class="nx">Todo</span> <span class="p">{</span>
  <span class="nl">text</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">done</span><span class="p">:</span> <span class="nx">boolean</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">reducerFn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">UndoHistoryStateWrapper</span><span class="o">&lt;</span><span class="nx">ActualState</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{}</span>
<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span><span class="nx">undoable</span><span class="o">&lt;</span><span class="nx">ActualState</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">reducerFn</span><span class="p">))</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Use Redux</span><span class="dl">"</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">UNDO</span><span class="dl">"</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div></div>
      <h4 id="using-the-redux-undo-package">
        
        
          Using the redux-undo package <a href="#using-the-redux-undo-package">#</a>
        
        
      </h4>
    

<p>Instead of implementing all this from scratch (like we did in previous section), we can
simply use the <code class="language-plaintext highlighter-rouge">redux-undo</code> package.</p>

<blockquote>
  <p>⚡ You can install the <code class="language-plaintext highlighter-rouge">redux-undo</code> package using <code class="language-plaintext highlighter-rouge">npm i redux-undo</code>.</p>
</blockquote>

<p>This package provides an <code class="language-plaintext highlighter-rouge">undoable()</code> function, that replaces ours (which is shown in the
previous section). You can use it like so.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">undoable</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">redux-undo</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nf">createStore</span><span class="p">(</span><span class="nf">undoable</span><span class="p">(</span><span class="nx">reducerFn</span><span class="p">))</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Use Redux</span><span class="dl">"</span><span class="p">,</span>
<span class="p">})</span>
<span class="nx">store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">UNDO</span><span class="dl">"</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div></div>

<p>If you were using your actual reducer function (<code class="language-plaintext highlighter-rouge">reducerFn</code>) in other parts of your code,
then you can just continue doing so w/out any changes (eg: in any <code class="language-plaintext highlighter-rouge">combineReducers()</code>
calls).</p>

<p>However, the way in which you access your state will change. Instead of using
<code class="language-plaintext highlighter-rouge">state.todos</code> like you would in the past, you now have to use <code class="language-plaintext highlighter-rouge">state.todos.present</code>, since
the <code class="language-plaintext highlighter-rouge">ActualState</code> is wrapped in <code class="language-plaintext highlighter-rouge">UndoHistoryStateWrapper&lt;ActualState&gt;</code>.</p>

<p>If you want to add buttons for undo and redo, you will need the following information.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">state.todos.past.length &gt; 0</code> means you can enable undo button.</li>
  <li><code class="language-plaintext highlighter-rouge">state.todos.future.length &gt; 0</code> means you can enable redo button.</li>
  <li>In order to dispatch the undo action, you can write <code class="language-plaintext highlighter-rouge">store.dispatch( {type: "UNDO"} )</code>.</li>
  <li>In order to dispatch the redo action, you can write <code class="language-plaintext highlighter-rouge">store.dispatch( {type: "REDO"} )</code>.</li>
</ul>

<blockquote>
  <p>⚡ Here’s more information on undo redo in the
<a href="https://redux.js.org/usage/implementing-undo-history">official Redux documentation</a>.</p>
</blockquote>
      <h2 id="testing-with-react-testing-library">
        
        
          Testing with react-testing-library <a href="#testing-with-react-testing-library">#</a>
        
        
      </h2>
    

<p>CRA comes w/ Jest and TypeScript support built-in, so writing tests using Jest,
TypeScript, and <code class="language-plaintext highlighter-rouge">react-testing-library</code> (aka RTL or React Testing Library) is really
straightforward.</p>

<blockquote>
  <p>⚡ You can get more info about what comes out of the box w/ CRA
<a href="https://create-react-app.dev/docs/running-tests/#react-testing-library">here</a>.</p>
</blockquote>

<p>Here are some of the top benefits of using Jest &amp; RTL:</p>

<ol>
  <li>You can test your components in isolation from the child components they render.</li>
  <li>You can use real DOM nodes because the tests assert actual behavior that a user would
experience and not React <a href="https://reactjs.org/docs/faq-internals.html">Virtual DOM</a>
implementation / internals.</li>
  <li>A real browser isn’t used to run your tests. Jest will use
<a href="https://github.com/jsdom/jsdom">JSDOM</a> which implements the DOM API in pure
Javascript, and runs in a Node.js instance on your machine (or whatever machine you run
the tests on).</li>
  <li>You can do blackbox and integration testing by
<a href="https://github.com/mswjs/msw">mocking web services</a>.</li>
</ol>

<blockquote>
  <p>⚡ More information on RTL:</p>

  <ol>
    <li><a href="https://testing-library.com/docs/react-testing-library/intro/">Introduction</a></li>
    <li><a href="https://testing-library.com/docs/react-testing-library/example-intro/">Example w/ explanation</a></li>
    <li><a href="https://codesandbox.io/s/github/kentcdodds/react-testing-library-examples">Example in codesandbox.io</a></li>
    <li><a href="https://testing-library.com/docs/react-testing-library/cheatsheet">Cheatsheet</a></li>
  </ol>
</blockquote>
      <h3 id="use-rtl-instead-of-enzyme">
        
        
          Use RTL instead of Enzyme <a href="#use-rtl-instead-of-enzyme">#</a>
        
        
      </h3>
    

<ol>
  <li>RTL is a replacement for <a href="http://airbnb.io/enzyme/"><code class="language-plaintext highlighter-rouge">Enzyme</code></a>.</li>
</ol>

<ul>
  <li>Both <code class="language-plaintext highlighter-rouge">Enzyme</code> and RTL are built on top of:
    <ul>
      <li><a href="https://reactjs.org/docs/react-dom.html"><code class="language-plaintext highlighter-rouge">react-dom</code></a></li>
      <li><a href="https://reactjs.org/docs/test-utils.html"><code class="language-plaintext highlighter-rouge">react-dom/test-utils</code></a></li>
      <li><a href="https://reactjs.org/docs/test-renderer.html"><code class="language-plaintext highlighter-rouge">react-test-renderer</code></a></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Enzyme</code> encourages (and provides utilities for) testing implementation details with
rendered instances of components, whereas RTL encourages testing only the “end result”
by querying for and making assertions about actual DOM nodes.</li>
  <li><a href="https://stackoverflow.com/a/54153026/2085356">Here is a list</a> of differences between
the two.</li>
</ul>

<ol>
  <li>Rather than dealing with (<a href="https://reactjs.org/docs/faq-internals.html">Virtual DOM</a>)
instances of rendered React components, your tests will work with actual DOM nodes.</li>
</ol>

<ul>
  <li>The utilities RTL provides facilitate querying the DOM in the same way the user would.</li>
  <li>Finding form elements by their label text (just like a user would), finding links and
buttons from their text (like a user would).</li>
  <li>It also exposes a recommended way to find elements by a <code class="language-plaintext highlighter-rouge">data-testid</code> as an “escape
hatch” for elements where the text content and label do not make sense or is not
practical.</li>
</ul>

<blockquote>
  <p>💡 RTL is built on top of
<a href="https://testing-library.com/docs/dom-testing-library/intro/"><code class="language-plaintext highlighter-rouge">dom-testing-library</code></a>
which provides the underlying APIs for testing DOM nodes.</p>

  <ul>
    <li>Jest runs RTL tests in a
<a href="https://testing-library.com/docs/dom-testing-library/intro/#this-solution">headless environment</a>,
since the entire DOM API is implemented in pure Javascript by
<a href="https://github.com/jsdom/jsdom">JSDOM</a>.</li>
    <li>The DOM implementation runs in a Node.js environment on the machine in which the tests
are running in and not a real browser.</li>
    <li>This isn’t like
<a href="https://developerlife.com/2019/07/06/starter-project-TypeScript-karma-jasmine-webpack/"><code class="language-plaintext highlighter-rouge">Karma</code></a>
test runner which will spool up an actual browser to run the tests in. This makes
these tests very fast.</li>
  </ul>
</blockquote>

<ol>
  <li>You can also mock web services for your tests (Node.js instances are spawned on the
machine in which you are running the tests), using
<a href="https://github.com/mswjs/msw"><code class="language-plaintext highlighter-rouge">msw</code></a> to test out <code class="language-plaintext highlighter-rouge">fetch</code> calls.
<a href="https://testing-library.com/docs/react-testing-library/example-intro">Here is an example</a>.</li>
</ol>
      <h3 id="install-the-required-packages-for-rtl">
        
        
          Install the required packages for RTL <a href="#install-the-required-packages-for-rtl">#</a>
        
        
      </h3>
    

<p>To get started you should install the RTL and <code class="language-plaintext highlighter-rouge">jest-dom</code> packages.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">--save</span> @testing-library/react @testing-library/jest-dom
</code></pre></div></div>

<p>Next, modify your
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/setupTests.ts"><code class="language-plaintext highlighter-rouge">src/setupTests.ts</code></a>
file by adding this line.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// react-testing-library renders your components to document.body,</span>
<span class="c1">// this adds jest-dom's custom assertions</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">@testing-library/jest-dom</span><span class="dl">"</span>
</code></pre></div></div>
      <h3 id="basic-unit-tests">
        
        
          Basic unit tests <a href="#basic-unit-tests">#</a>
        
        
      </h3>
    

<p>Writing simple unit tests are no different in Jest than they are using Jasmine. Here’s an
example of a simple unit test that is self contained and doesn’t really have a system
under test. The system under test is the <code class="language-plaintext highlighter-rouge">MyMatcher</code> class which is declared in the test
itself. This class is meant to mimic a Jasmine matcher. And the tests assert that it works
as expected.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">_also</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="kd">class</span> <span class="nc">MyMatcher</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">_arg</span><span class="p">:</span> <span class="nx">boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{}</span>

  <span class="kd">set</span> <span class="nf">arg</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_arg</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="p">}</span>
  <span class="kd">get</span> <span class="nf">arg</span><span class="p">():</span> <span class="nx">boolean</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_arg</span>
  <span class="p">}</span>

  <span class="nx">isFalse</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">arg</span>

  <span class="nx">isTrue</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">arg</span>

  <span class="kd">get</span> <span class="nf">not</span><span class="p">():</span> <span class="nx">MyMatcher</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">MyMatcher</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">arg</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">MyMatcher -&gt; myMatcher(arg)</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">myMatcher</span><span class="p">:</span> <span class="nx">MyMatcher</span> <span class="o">=</span>
    <span class="cm">/* new MyMatcher(true) */</span>
    <span class="nf">_also</span><span class="p">(</span><span class="k">new</span> <span class="nc">MyMatcher</span><span class="p">(),</span> <span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">arg</span> <span class="o">=</span> <span class="kc">true</span><span class="p">))</span>
  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">myMatcher.isTrue() is true</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">expect</span><span class="p">(</span><span class="nx">myMatcher</span><span class="p">.</span><span class="nf">isTrue</span><span class="p">()).</span><span class="nf">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>
  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">myMatcher.isFalse() is false</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">expect</span><span class="p">(</span><span class="nx">myMatcher</span><span class="p">.</span><span class="nf">isFalse</span><span class="p">()).</span><span class="nf">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">myMatcher.not.isTrue() is false</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">myMatcher</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nf">isTrue</span><span class="p">()).</span><span class="nf">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
<span class="p">})</span>
</code></pre></div></div>

<blockquote>
  <p>💡 TypeScript has an awesome
<a href="https://github.com/microsoft/TypeScript/issues/19335">“escape hatch”</a> to allow private
variables to be accessed in tests. Here’s a detailed
<a href="https://stackoverflow.com/a/35991491/2085356">SO answer</a> on this topic.</p>

  <p>Here’s an example:</p>

  <ul>
    <li>Let’s say you have a class with a private variable named <code class="language-plaintext highlighter-rouge">_x</code> like so:
<code class="language-plaintext highlighter-rouge">class Clazz {private _x:number = 0}</code></li>
    <li>Then you can access it w/ type safety in a test when using the array access syntax,
eg: <code class="language-plaintext highlighter-rouge">new Clazz()[_x]</code>, which will be treated as a <code class="language-plaintext highlighter-rouge">number</code>.</li>
    <li>So you can assert <code class="language-plaintext highlighter-rouge">expect(typeof new Clazz()[_x]).toBe('number')</code>.</li>
  </ul>
</blockquote>
      <h3 id="complex-unit-tests">
        
        
          Complex unit tests <a href="#complex-unit-tests">#</a>
        
        
      </h3>
    

<p>Let’s write a test for the reducer function of
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/redux/SimpleReduxComponent.tsx"><code class="language-plaintext highlighter-rouge">SimpleReduxComponent.tsx</code></a>.
The tests will be pretty simple, w/ the only complication being the way in which the
function and types themselves are exported. The test needs to know some internals about
the component which users of this component don’t really need to know about (nor should
they, since that would break encapsulation).</p>

<p>In order to implement this, one approach is to use a namespace that simply exports only
the required symbols for testing (this is done in the <code class="language-plaintext highlighter-rouge">SimpleReduxComponent.tsx</code> file).
Here are the fewest symbols that need to be accessible by the test.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Export namespace for testing.</span>
<span class="k">export</span> <span class="k">namespace</span> <span class="nx">SimpleReduxComponentForTesting</span> <span class="p">{</span>
  <span class="k">export</span> <span class="kd">const</span> <span class="nx">_reducerFn</span><span class="p">:</span> <span class="nx">Reducer</span><span class="o">&lt;</span><span class="nx">State</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">reducerFn</span>
  <span class="k">export</span> <span class="kd">type</span> <span class="nx">_State</span> <span class="o">=</span> <span class="nx">State</span>
  <span class="k">export</span> <span class="kd">type</span> <span class="nx">_Action</span> <span class="o">=</span> <span class="nx">Action</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>💡 The symbols all have to be renamed for this namespace, otherwise, they would collide
w/ their original declarations.</p>
</blockquote>

<p>These symbols are then imported in the actual test, like this:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">SimpleReduxComponentForTesting</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../SimpleReduxComponent</span><span class="dl">"</span>
<span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="nx">SimpleReduxComponentForTesting</span><span class="p">.</span><span class="nx">_State</span> <span class="o">|</span> <span class="kc">undefined</span>
<span class="kd">type</span> <span class="nx">Action</span> <span class="o">=</span> <span class="nx">SimpleReduxComponentForTesting</span><span class="p">.</span><span class="nx">_Action</span>
<span class="kd">const</span> <span class="nx">reducerFn</span><span class="p">:</span> <span class="nx">Reducer</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">SimpleReduxComponentForTesting</span><span class="p">.</span><span class="nx">_reducerFn</span>
</code></pre></div></div>

<p>Now that the exports are complete, the test itself is pretty simple. Here’s the
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/redux/__tests__/SimpleReduxComponent.test.tsx"><code class="language-plaintext highlighter-rouge">SimpleReduxComponent.test.tsx</code></a>.
The test is pretty simple, it does the following things:</p>

<ol>
  <li>Tests to see that the initial state is generated correctly by the reducer function.</li>
  <li>Tests to see whether dispatching an add action actually adds something to the state.</li>
  <li>Tests to see whether dispatching a remove action actually removes something from the
state.</li>
</ol>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">SimpleReduxComponentForTesting</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../SimpleReduxComponent</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Reducer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@reduxjs/toolkit</span><span class="dl">"</span>

<span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">SimpleReduxComponent reducer function</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="nx">SimpleReduxComponentForTesting</span><span class="p">.</span><span class="nx">_State</span> <span class="o">|</span> <span class="kc">undefined</span>
  <span class="kd">type</span> <span class="nx">Action</span> <span class="o">=</span> <span class="nx">SimpleReduxComponentForTesting</span><span class="p">.</span><span class="nx">_Action</span>
  <span class="kd">const</span> <span class="na">reducerFn</span><span class="p">:</span> <span class="nx">Reducer</span><span class="o">&lt;</span><span class="nx">State</span><span class="p">,</span> <span class="nx">Action</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">SimpleReduxComponentForTesting</span><span class="p">.</span><span class="nx">_reducerFn</span>

  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">sets initial state</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">ignoredAction</span><span class="p">:</span> <span class="nx">Action</span> <span class="o">=</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="p">}</span>
    <span class="kd">const</span> <span class="na">state</span><span class="p">:</span> <span class="nx">State</span> <span class="o">=</span> <span class="nf">reducerFn</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">ignoredAction</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">state</span><span class="o">!!</span><span class="p">.</span><span class="nx">textArray</span><span class="p">).</span><span class="nf">toHaveLength</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">dispatch add action works</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">action</span><span class="p">:</span> <span class="nx">Action</span> <span class="o">=</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">add</span><span class="dl">"</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span> <span class="p">}</span>
    <span class="kd">const</span> <span class="na">initialState</span><span class="p">:</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">textArray</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id4</span><span class="dl">"</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fffff</span><span class="dl">"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id5</span><span class="dl">"</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gggg</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">],</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="na">newState</span><span class="p">:</span> <span class="nx">State</span> <span class="o">=</span> <span class="nf">reducerFn</span><span class="p">(</span><span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">initialState</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nf">toEqual</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">newState</span><span class="o">!!</span><span class="p">.</span><span class="nx">textArray</span><span class="p">).</span><span class="nf">toHaveLength</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">newState</span><span class="o">!!</span><span class="p">.</span><span class="nx">textArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]).</span><span class="nf">toMatchObject</span><span class="p">({</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span> <span class="p">})</span>
  <span class="p">})</span>

  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">dispatch remove action works</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">action</span><span class="p">:</span> <span class="nx">Action</span> <span class="o">=</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">remove</span><span class="dl">"</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id4</span><span class="dl">"</span> <span class="p">}</span>
    <span class="kd">const</span> <span class="na">initialState</span><span class="p">:</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">textArray</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id4</span><span class="dl">"</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fffff</span><span class="dl">"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id5</span><span class="dl">"</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gggg</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">],</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="na">newState</span><span class="p">:</span> <span class="nx">State</span> <span class="o">=</span> <span class="nf">reducerFn</span><span class="p">(</span><span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">initialState</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nf">toEqual</span><span class="p">(</span><span class="nx">newState</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">newState</span><span class="o">!!</span><span class="p">.</span><span class="nx">textArray</span><span class="p">).</span><span class="nf">toHaveLength</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">newState</span><span class="o">!!</span><span class="p">.</span><span class="nx">textArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nf">toMatchObject</span><span class="p">({</span> <span class="na">content</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gggg</span><span class="dl">"</span> <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>
      <h3 id="basic-ui-tests">
        
        
          Basic UI tests <a href="#basic-ui-tests">#</a>
        
        
      </h3>
    

<p>In order to write UI tests we will be using a combination of APIs from:</p>

<ol>
  <li><a href="https://testing-library.com/docs/react-testing-library/api">RTL</a> - APIs like
<a href="https://testing-library.com/docs/react-testing-library/api#render"><code class="language-plaintext highlighter-rouge">render()</code></a> will
render your component into a container that is appended to <code class="language-plaintext highlighter-rouge">document.body</code>. This
container is
<a href="https://testing-library.com/docs/react-testing-library/api#cleanup">automatically removed</a>
from when the test completes, so make sure to call <code class="language-plaintext highlighter-rouge">render()</code> at the start of each <code class="language-plaintext highlighter-rouge">it</code>
or <code class="language-plaintext highlighter-rouge">test</code> block.</li>
  <li><a href="https://testing-library.com/docs/queries/about">dom-testing-library</a> - APIs like
<a href="https://testing-library.com/docs/queries/byrole"><code class="language-plaintext highlighter-rouge">getByRole()</code></a> will allow you to
interrogate the JSDOM and assert things about it. Here’s a list of
<a href="https://www.w3.org/TR/html-aria/#docconformance">HTML ARIA roles</a> that are used to
match DOM elements.</li>
</ol>

<blockquote>
  <p>⚡ Here’s an example of a simple UI tests
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/redux/__tests__/SimpleReduxComponent.test.tsx"><code class="language-plaintext highlighter-rouge">SimpleReduxCompoennt.test.tsx</code></a>.</p>
</blockquote>

<p>The basic structure of the UI tests are very similar.</p>

<ol>
  <li>Render some component that you are testing (the system under test).</li>
  <li>Wait for HTML element to be added to the DOM (via call to <code class="language-plaintext highlighter-rouge">screen</code>).</li>
  <li>Assert that the DOM looks the way you expect. Or fire an event here, and then check to
see that the DOM is what you expect.</li>
</ol>

<p>Here’s the simplest test case.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays few list items at start</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">render</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">SimpleReduxComponent</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/Provider</span><span class="err">&gt;
</span>  <span class="p">)</span>
  <span class="k">await</span> <span class="nf">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">))</span>
  <span class="nf">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">).</span><span class="nx">children</span><span class="p">).</span><span class="nf">toHaveLength</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Here’s a test case where an event is fired before the DOM is checked.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">clicking item removes it</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">render</span><span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">SimpleReduxComponent</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/Provider</span><span class="err">&gt;
</span>  <span class="p">)</span>
  <span class="k">await</span> <span class="nf">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">))</span>
  <span class="nx">fireEvent</span><span class="p">.</span><span class="nf">click</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">).</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="nf">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">).</span><span class="nx">children</span><span class="p">).</span><span class="nf">toHaveLength</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>
      <h3 id="complex-ui-tests">
        
        
          Complex UI tests <a href="#complex-ui-tests">#</a>
        
        
      </h3>
    

<p>In this section we will write a test that deals with resizing a browser window (such as
what you would need to do to test media queries). Here are the key things that we will
cover in this example:</p>

<ol>
  <li>How to resize a JSDOM browser window (since an actual browser is not used).</li>
  <li>How to wrap React updates in
<a href="https://davidwcai.medium.com/react-testing-library-and-the-not-wrapped-in-act-errors-491a5629193b"><code class="language-plaintext highlighter-rouge">act()</code></a>.</li>
</ol>

<p>Here’s the system under test.</p>

<blockquote>
  <p>⚡
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/basics/ComponentWithoutState.tsx"><code class="language-plaintext highlighter-rouge">ComponentWithoutState.tsx</code></a>.</p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">MessagePropsWithChildren</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../types</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">styles</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../styles/App.module.css</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Dispatch</span><span class="p">,</span> <span class="nx">SetStateAction</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">_let</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">TestIdWindowSize</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">test-id-window-size</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">setWindowSize</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">setWidth</span><span class="p">:</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;&gt;</span><span class="p">,</span>
  <span class="nx">setHeight</span><span class="p">:</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;&gt;</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">setWidth</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">)</span>
  <span class="nf">setHeight</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">SizeStateHookType</span> <span class="o">=</span> <span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;&gt;</span><span class="p">]</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">ComponentWithoutState</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">:</span> <span class="nx">MessagePropsWithChildren</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">width</span><span class="p">,</span> <span class="nx">setWidth</span><span class="p">]:</span> <span class="nx">SizeStateHookType</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">height</span><span class="p">,</span> <span class="nx">setHeight</span><span class="p">]:</span> <span class="nx">SizeStateHookType</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="nf">useEffect</span><span class="p">(</span>
    <span class="p">()</span> <span class="o">=&gt;</span>
      <span class="nf">_let</span><span class="p">(</span>
        <span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">UIEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">setWindowSize</span><span class="p">(</span><span class="nx">setWidth</span><span class="p">,</span> <span class="nx">setHeight</span><span class="p">),</span>
        <span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nb">window</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">resize</span><span class="dl">"</span><span class="p">,</span> <span class="nx">it</span><span class="p">)</span>
          <span class="k">return </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nf">removeEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">resize</span><span class="dl">"</span><span class="p">,</span> <span class="nx">it</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">),</span>
    <span class="p">[]</span> <span class="cm">/* Run once, like componentDidMount. */</span>
  <span class="p">)</span>

  <span class="nf">useEffect</span><span class="p">(</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">setWindowSize</span><span class="p">(</span><span class="nx">setWidth</span><span class="p">,</span> <span class="nx">setHeight</span><span class="p">),</span>
    <span class="p">[]</span> <span class="cm">/* Run once, like componentDidMount. */</span>
  <span class="p">)</span>

  <span class="kd">const</span> <span class="nx">render</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">section</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">Container</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/code</span><span class="err">&gt;
</span>      <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">data</span><span class="o">-</span><span class="nx">testid</span><span class="o">=</span><span class="p">{</span><span class="nx">TestIdWindowSize</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="s2">`</span><span class="p">${</span><span class="nx">width</span><span class="p">}</span><span class="s2"> x </span><span class="p">${</span><span class="nx">height</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/section</span><span class="err">&gt;
</span>  <span class="p">)</span>

  <span class="k">return</span> <span class="nf">render</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And here’s the test file itself. In this test, the window is resized after rendering the
component. Then the component is checked to see whether it got this change in width and
height. If you were using a media query then you would check the DOM to see whether the
structure that you were expecting is actually present.</p>

<blockquote>
  <p>⚡
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/__tests__/MediaQueryTest.test.tsx"><code class="language-plaintext highlighter-rouge">MediaQueryTest.test.tsx</code></a></p>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">render</span><span class="p">,</span> <span class="nx">screen</span><span class="p">,</span> <span class="nx">waitFor</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@testing-library/react</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">act</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-dom/test-utils</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">ComponentWithoutState</span><span class="p">,</span>
  <span class="nx">TestIdWindowSize</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../components/basics/ComponentWithoutState</span><span class="dl">"</span>

<span class="cm">/** Get around `window.innerWidth` and `window.innerHeight` are readonly. */</span>
<span class="kd">const</span> <span class="nx">resizeWindow</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">y</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nb">window</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="p">{</span> <span class="na">innerWidth</span><span class="p">:</span> <span class="nx">x</span> <span class="p">})</span>
  <span class="nb">window</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="p">{</span> <span class="na">innerHeight</span><span class="p">:</span> <span class="nx">y</span> <span class="p">})</span>
  <span class="nb">window</span><span class="p">.</span><span class="nf">dispatchEvent</span><span class="p">(</span><span class="k">new</span> <span class="nc">Event</span><span class="p">(</span><span class="dl">"</span><span class="s2">resize</span><span class="dl">"</span><span class="p">))</span>
<span class="p">}</span>

<span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">media query test</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">should be large window size</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">render</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">ComponentWithoutState</span> <span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">)</span>

    <span class="c1">// Wrap any calls to React state changes in act().</span>
    <span class="c1">// More info: https://davidwcai.medium.com/react-testing-library-and-the-not-wrapped-in-act-errors-491a5629193b</span>
    <span class="nf">act</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nf">resizeWindow</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="k">await</span> <span class="nf">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">screen</span><span class="p">.</span><span class="nf">getByTestId</span><span class="p">(</span><span class="nx">TestIdWindowSize</span><span class="p">))</span>

    <span class="kd">const</span> <span class="nx">checkContent</span> <span class="o">=</span> <span class="nx">screen</span><span class="p">.</span><span class="nf">getByTestId</span><span class="p">(</span><span class="nx">TestIdWindowSize</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">checkContent</span><span class="p">).</span><span class="nf">toHaveTextContent</span><span class="p">(</span><span class="dl">"</span><span class="s2">2000 x 1000</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<blockquote>
  <p>💡 Note the use of <a href="https://reactjs.org/docs/testing-recipes.html#act"><code class="language-plaintext highlighter-rouge">act()</code></a> to wrap
the call to <code class="language-plaintext highlighter-rouge">resizeWindow()</code>. This is necessary when you write code that mutates a
component’s state using one of your functions. This ensures that all the required work
has been done before you make your DOM assertions.</p>
</blockquote>
      <h3 id="writing-integration-tests">
        
        
          Writing integration tests <a href="#writing-integration-tests">#</a>
        
        
      </h3>
    
      <h4 id="install-msw-package">
        
        
          Install msw package <a href="#install-msw-package">#</a>
        
        
      </h4>
    

<p>In order to mock web services, you will need to install the
<a href="https://github.com/mswjs/msw"><code class="language-plaintext highlighter-rouge">msw</code> module</a> as a dev dependency.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i <span class="nt">-D</span> msw
</code></pre></div></div>

<blockquote>
  <p>⚡ Learn more about mocking REST APIs (using <code class="language-plaintext highlighter-rouge">msw</code>)
<a href="https://mswjs.io/docs/getting-started/mocks/rest-api">here</a>.</p>
</blockquote>

<blockquote>
  <p>⚡ This is a great
<a href="https://dev.to/kettanaito/type-safe-api-mocking-with-mock-service-worker-and-TypeScript-21bf">tutorial</a>
on using <code class="language-plaintext highlighter-rouge">msw</code> and TypeScript.</p>
</blockquote>
      <h4 id="mocking-the-server-rest-api-endpoints">
        
        
          Mocking the server (REST API endpoints) <a href="#mocking-the-server-rest-api-endpoints">#</a>
        
        
      </h4>
    

<p>Before we get started writing the test, here are some functions that need to be created in
order to mock the search endpoint of the <code class="language-plaintext highlighter-rouge">TheCatApi.com</code>.</p>

<blockquote>
  <p>⚡ Here’s the full source file
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/__tests__/TestUtils.ts"><code class="language-plaintext highlighter-rouge">TestUtils.ts</code></a>.</p>
</blockquote>

<ol>
  <li>
    <p><strong>Setup and teardown</strong> - Create the server and tie its start and stop w/ the lifecycle
of the tests.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">function</span> <span class="nf">setupAndTeardown</span><span class="p">():</span> <span class="nx">SetupServerApi</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">SetupServerApi</span> <span class="o">=</span> <span class="nf">setupServer</span><span class="p">()</span>
  <span class="nf">beforeAll</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">server</span><span class="p">.</span><span class="nf">listen</span><span class="p">())</span>
  <span class="nf">afterEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">server</span><span class="p">.</span><span class="nf">resetHandlers</span><span class="p">())</span>
  <span class="nf">afterAll</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">server</span><span class="p">.</span><span class="nf">close</span><span class="p">())</span>
  <span class="k">return</span> <span class="nx">server</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <blockquote>
      <p>⚠ Make sure to call <code class="language-plaintext highlighter-rouge">setupAndTeardown()</code> at the start of your actual UI test.</p>
    </blockquote>
  </li>
  <li>
    <p><strong><a href="https://stackoverflow.com/questions/1410563/what-is-the-difference-between-a-definition-and-a-declaration">Define</a>
the data returned by the mock API</strong> - Here are some supporting constants that are
needed in the next steps.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">cannedResponseOk</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">breeds</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">categories</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">jK5X2xGJ7</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://cdn2.thecatapi.com/images/jK5X2xGJ7.jpg</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">breeds</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">categories</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">9c6</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://cdn2.thecatapi.com/images/9c6.jpg</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">breeds</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">categories</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ab8</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://cdn2.thecatapi.com/images/ab8.jpg</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">]</span>
<span class="kd">const</span> <span class="nx">TheCatApi</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_CAT_API_KEY</span><span class="p">,</span>
  <span class="na">search</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://api.thecatapi.com</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">endpoint</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/v1/images/search</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">config</span><span class="p">:</span> <span class="p">{</span> <span class="na">params</span><span class="p">:</span> <span class="p">{</span> <span class="na">limit</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">size</span><span class="p">:</span> <span class="dl">"</span><span class="s2">full</span><span class="dl">"</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Mock the REST API w/ handlers for the happy path</strong> - Create the function that handles
HTTP GET requests that are made to <code class="language-plaintext highlighter-rouge">https://api.thecatapi.com/v1/images/search</code>.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// More info: https://mswjs.io/docs/getting-started/mocks/rest-api</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">restHandlerSearchOk</span><span class="p">:</span> <span class="nx">RestHandler</span> <span class="o">=</span> <span class="nx">rest</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
  <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span>
  <span class="p">(</span>
    <span class="nx">req</span><span class="p">:</span> <span class="nx">RestRequest</span><span class="o">&lt;</span><span class="nx">DefaultRequestBody</span><span class="p">,</span> <span class="nx">RequestParams</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">res</span><span class="p">:</span> <span class="nx">ResponseComposition</span><span class="p">,</span>
    <span class="nx">ctx</span><span class="p">:</span> <span class="nx">RestContext</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">restHandlerSearchOk.req</span><span class="dl">"</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
    <span class="c1">// console.log("req.url.searchParams", req.url.searchParams)</span>
    <span class="c1">// console.log("req.params", req.params)</span>
    <span class="k">return</span> <span class="nf">res</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">json</span><span class="p">(</span><span class="nx">cannedResponseOk</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Mock the REST API w/ handlers for the unhappy path</strong> - Create a function that handles
returning a
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500"><code class="language-plaintext highlighter-rouge">500</code> HTTP error code</a>
for HTTP GET requests that are made to <code class="language-plaintext highlighter-rouge">https://api.thecatapi.com/v1/images/search</code>.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">restHandlerSearchError</span><span class="p">:</span> <span class="nx">RestHandler</span> <span class="o">=</span> <span class="nx">rest</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
  <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span>
  <span class="p">(</span>
    <span class="nx">req</span><span class="p">:</span> <span class="nx">RestRequest</span><span class="o">&lt;</span><span class="nx">DefaultRequestBody</span><span class="p">,</span> <span class="nx">RequestParams</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">res</span><span class="p">:</span> <span class="nx">ResponseComposition</span><span class="p">,</span>
    <span class="nx">ctx</span><span class="p">:</span> <span class="nx">RestContext</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">restHandlerSearchError.req</span><span class="dl">"</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
    <span class="c1">// console.log("req.url.searchParams", req.url.searchParams)</span>
    <span class="c1">// console.log("req.params", req.params)</span>
    <span class="k">return</span> <span class="nf">res</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>
      <h4 id="testing-the-mocked-server-rest-api-endpoints-itself">
        
        
          Testing the mocked server (REST API endpoints) itself <a href="#testing-the-mocked-server-rest-api-endpoints-itself">#</a>
        
        
      </h4>
    

<p>Now w/ the setup and supporting functions out of the way, we can actually write the tests.
The tests shown here actually don’t have a React component under test, they’re just tests
that make <code class="language-plaintext highlighter-rouge">axios</code> calls to the mocked API endpoints.</p>

<blockquote>
  <p>⚡ Here’s the full source file
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/__tests__/TheCatApiEndpointMock.test.tsx"><code class="language-plaintext highlighter-rouge">TheCatApiEndpointMock.test.tsx</code></a>.</p>
</blockquote>

<ol>
  <li>
    <p><strong>Setup the server</strong> - The first step is calling <code class="language-plaintext highlighter-rouge">setupAndTeardown()</code> at the start of
your test.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">server</span><span class="p">:</span> <span class="nx">SetupServerApi</span> <span class="o">=</span> <span class="nf">setupAndTeardown</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Test the happy path mocked endpoint</strong> - The test does quite a few things.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">TheCatApi search endpoint works</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">server</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nx">restHandlerSearchOk</span><span class="p">)</span>
  <span class="nx">axios</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">common</span><span class="p">[</span><span class="dl">"</span><span class="s2">x-api-key</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">apiKey</span>
  <span class="nf">_also</span><span class="p">(</span><span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">it</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">it</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">payload</span><span class="p">).</span><span class="nf">toHaveLength</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>First, it sets up the server to handle the search endpoint of the REST API.</p>

    <ul>
      <li>It binds the <code class="language-plaintext highlighter-rouge">restHandlerSearchOk</code> to the server via <code class="language-plaintext highlighter-rouge">server.use()</code>.</li>
      <li>All <code class="language-plaintext highlighter-rouge">RestHandlers</code> registered via <code class="language-plaintext highlighter-rouge">use()</code> will be torn down after each test in the
<code class="language-plaintext highlighter-rouge">afterEach()</code> call (declared in in the first step).</li>
    </ul>
  </li>
  <li>
    <p>Then, it connects to the <code class="language-plaintext highlighter-rouge">msw</code> mock server and makes the GET request, gets the
response, and makes the assertion that 3 items are in the <code class="language-plaintext highlighter-rouge">payload</code>.</p>

    <blockquote>
      <p>⚠ One thing to note is that the URL query params that are sent via HTTP GET (from the
<code class="language-plaintext highlighter-rouge">axios</code> call in the following step) don’t actually show up on the mocked server.
However, the headers do show up.</p>
    </blockquote>
  </li>
  <li>
    <p><strong>Test the unhappy path mocked endpoint</strong> - This test is very similar to the previous
one, except that the REST API is mocked to throw a
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500"><code class="language-plaintext highlighter-rouge">500</code> HTTP error code</a>.
It also demonstrates how to detect errors for async functions.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// More info: https://stackoverflow.com/a/47887098/2085356</span>
<span class="kd">const</span> <span class="nx">makeGetRequest</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span>
  <span class="nf">_let</span><span class="p">(</span><span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">axios</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">common</span><span class="p">[</span><span class="dl">"</span><span class="s2">x-api-key</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">apiKey</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">it</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">it</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">payload</span>
  <span class="p">})</span>

<span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">TheCatApi endpoint fails as expected</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">server</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nx">restHandlerSearchError</span><span class="p">)</span>
  <span class="k">await</span> <span class="nf">expect</span><span class="p">(</span><span class="nf">makeGetRequest</span><span class="p">()).</span><span class="nx">rejects</span><span class="p">.</span><span class="nf">toThrow</span><span class="p">(</span><span class="nb">Error</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>    </div>
  </li>
</ol>
      <h4 id="using-the-mocked-server-in-a-ui-test">
        
        
          Using the mocked server in a UI test <a href="#using-the-mocked-server-in-a-ui-test">#</a>
        
        
      </h4>
    

<p>Now that we have the endpoints mocked and tested, we can write tests that renders a React
component which uses these endpoints.</p>

<blockquote>
  <p>⚡ Here’s the full source file
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/__tests__/TheCatApiEndpointMock.test.tsx"><code class="language-plaintext highlighter-rouge">TheCatApiEndpointMock.test.tsx</code></a>.</p>
</blockquote>

<p>We are going to write two tests. One that makes sure that the <code class="language-plaintext highlighter-rouge">CatApiComponent</code> renders a
list of images when the search endpoint returns a valid result. Another that renders an
error message when the search endpoint returns an error. Here’s the <code class="language-plaintext highlighter-rouge">describe</code> block
containing these which is simply added to our previous test.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">CatApiComponent</span><span class="p">,</span> <span class="nx">TheCatApi</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../CatApiComponent</span><span class="dl">"</span>

<span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">CatApiComponent works as expected ⤵</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">Component renders results with API happy path</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">server</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nx">restHandlerSearchOk</span><span class="p">)</span>
    <span class="nf">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">CatApiComponent</span><span class="p">.</span><span class="nx">FC</span> <span class="o">/&gt;</span><span class="p">)</span>
    <span class="k">await</span> <span class="nf">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">))</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nf">prettyDOM</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">)))</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nf">getAllByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">listitem</span><span class="dl">"</span><span class="p">).</span><span class="nx">length</span><span class="p">).</span><span class="nf">toBe</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nf">test</span><span class="p">(</span><span class="dl">"</span><span class="s2">Component renders error state with API unhappy path</span><span class="dl">"</span><span class="p">,</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">server</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nx">restHandlerSearchError</span><span class="p">)</span>
    <span class="nf">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">CatApiComponent</span><span class="p">.</span><span class="nx">FC</span> <span class="o">/&gt;</span><span class="p">)</span>
    <span class="k">await</span> <span class="nf">waitFor</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">screen</span><span class="p">.</span><span class="nf">getByTestId</span><span class="p">(</span><span class="nx">CatApiComponent</span><span class="p">.</span><span class="nx">TestIds</span><span class="p">.</span><span class="nx">fetchError</span><span class="p">))</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nf">prettyDOM</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nf">getByTestId</span><span class="p">(</span><span class="nx">CatApiComponent</span><span class="p">.</span><span class="nx">TestIds</span><span class="p">.</span><span class="nx">fetchError</span><span class="p">)))</span>
    <span class="nf">expect</span><span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nf">getByRole</span><span class="p">(</span><span class="dl">"</span><span class="s2">heading</span><span class="dl">"</span><span class="p">)).</span><span class="nf">toHaveTextContent</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">Error: Request failed with status code 500</span><span class="dl">"</span>
    <span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p>There are a couple of things to note in this test.</p>

<ol>
  <li>You can use ARIA to search for components using <code class="language-plaintext highlighter-rouge">screen.getByRole()</code> or you can use the
<code class="language-plaintext highlighter-rouge">data-testid</code> / <code class="language-plaintext highlighter-rouge">screen.getByTestId()</code> mechanism. You can see the use of each one in
the test above.</li>
  <li>
    <p>Since we are using test ids, we are wrapping the ids and the React component in the
<code class="language-plaintext highlighter-rouge">CatApiComponent</code> namespace. This allows us to have clean import statements that don’t
result in collisions of this component’s test ids w/ any other variables or imports.</p>
  </li>
  <li>We can access the test ids via <code class="language-plaintext highlighter-rouge">CatApiComponent.TestIds</code>.</li>
  <li>
    <p>We can access the React component via <code class="language-plaintext highlighter-rouge">CatApiComponent.FC</code>.</p>
  </li>
  <li>The
<a href="https://testing-library.com/docs/dom-testing-library/api-debugging/#prettydom"><code class="language-plaintext highlighter-rouge">prettyDOM()</code></a>
function is really useful when trying to get a handle on the structure of the DOM for
your assertions.</li>
  <li>Since we are making async <code class="language-plaintext highlighter-rouge">axios</code> calls, we need to use <code class="language-plaintext highlighter-rouge">await waitFor(()=&gt;screen.???)</code>
so that the DOM is actually populated before we make our assertions.</li>
</ol>
      <h3 id="writing-snapshot-tests">
        
        
          Writing snapshot tests <a href="#writing-snapshot-tests">#</a>
        
        
      </h3>
    

<p>Snapshot testing was introduced in Jest around 2016, and it’s meant to be a lightweight
way to perform UI tests and it is meant to be a complement (not replacement) for unit and
integration testing.</p>

<blockquote>
  <p>💡 Here are some good reference guides on snapshot testing:</p>

  <ul>
    <li><a href="https://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/">Why use snapshot testing</a>.</li>
    <li><a href="https://jestjs.io/blog/2016/07/27/jest-14#why-snapshot-testing">Snapshot testing philosophy</a>.</li>
    <li><a href="https://jestjs.io/docs/snapshot-testing">Snapshot testing official guide</a>.</li>
  </ul>
</blockquote>

<p>The idea behind snapshot testing is that it should be easy to take a snapshot of what a
component should look like, and then compare any future changes to a component to this
snapshot. This is meant to be an easy way to do UI testing. There is no need to write any
assertions for what is expected in the DOM. Simply save the “last known good” snapshot of
a component, and when any changes are made to this component they will automatically be
compared to the saved snapshot (when the tests are run).</p>

<blockquote>
  <p>⚡ Install the required packages for react-test-renderer</p>

  <p>In order to write these tests we must use <code class="language-plaintext highlighter-rouge">react-test-renderer</code> and not the RTL or
<code class="language-plaintext highlighter-rouge">dom-testing-library</code>. Here are the things you must install to get started.</p>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install the package.</span>
npm <span class="nb">install </span>react-test-renderer
<span class="c"># Get the TypeScript bindings for your IDE.</span>
npm i <span class="nt">--save-dev</span> @types/react-test-renderer
</code></pre></div>  </div>
</blockquote>

<p>Here’s a simple snapshot test for the
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/basics/ComponentWithoutState.tsx"><code class="language-plaintext highlighter-rouge">ComponentWithoutState.tsx</code></a>.</p>

<blockquote>
  <p>💡 Note that the first time you run this you will have to
<a href="https://jestjs.io/docs/snapshot-testing#updating-snapshots">update the snapshot</a>. You
can do that by doing any of the following:</p>

  <ol>
    <li>Running the test in IDEA Ultimate or Webstorm.</li>
    <li>In a terminal by using <code class="language-plaintext highlighter-rouge">npm test -u</code>. You can also interactively update the snapshots
if you run <code class="language-plaintext highlighter-rouge">npm test</code> in your terminal.</li>
  </ol>
</blockquote>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">renderer</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react-test-renderer</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ComponentWithoutState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../ComponentWithoutState</span><span class="dl">"</span>

<span class="nf">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">ComponentWithoutState renders correctly</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">tree</span> <span class="o">=</span> <span class="nx">renderer</span>
    <span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">ComponentWithoutState</span> <span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="dl">"</span><span class="s2">snapshot test</span><span class="dl">"</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">)
</span>    <span class="p">.</span><span class="nf">toJSON</span><span class="p">()</span>
  <span class="nf">expect</span><span class="p">(</span><span class="nx">tree</span><span class="p">).</span><span class="nf">toMatchSnapshot</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div>

<blockquote>
  <p>⚡
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/basics/__tests__/ComponentWithoutState.snapshot.test.tsx">ComponentWithoutState.snapshot.test.tsx</a>.</p>
</blockquote>

<p>When a snapshot is updated it will create a file that you should check into your version
control. Here’s an example of a snapshot file generated by the test above
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/basics/__tests__/__snapshots__/ComponentWithoutState.snapshot.test.tsx.snap"><code class="language-plaintext highlighter-rouge">/__tests__/__snapshots__/ComponentWithoutState.snapshot.test.tsx.snap</code></a>.</p>
      <h2 id="data-apis-for-development">
        
        
          Data APIs for development <a href="#data-apis-for-development">#</a>
        
        
      </h2>
    

<p>Here are some data APIs that might be useful when building prototype apps.</p>

<ul>
  <li><a href="https://docs.thecatapi.com/api-reference/">TheCatApi</a></li>
  <li><a href="https://dog.ceo/dog-api/documentation/">doc.ceo/dog-api</a></li>
  <li><a href="https://hn.algolia.com/api">Hacker News API</a></li>
</ul>
      <h2 id="debugging-in-webstorm-or-idea-ultimate">
        
        
          Debugging in Webstorm or IDEA Ultimate <a href="#debugging-in-webstorm-or-idea-ultimate">#</a>
        
        
      </h2>
    

<p>Use this <a href="https://blog.jetbrains.com/webstorm/2017/01/debugging-react-apps/">guide</a> for
<code class="language-plaintext highlighter-rouge">create-react-app</code>.</p>

<ol>
  <li>Simply <code class="language-plaintext highlighter-rouge">package.json</code> and click on the green arrow beside the “run” script.</li>
  <li>In the tool window, press “Ctrl+Shift” and click on the <code class="language-plaintext highlighter-rouge">localhost:3000</code> hyperlink and
that will spawn a debugging session w/ a Chrome browser that is spawned just for this
session!</li>
  <li>Save the run configurations produced by the steps above in the project file.</li>
  <li>Also now that the JavaScript debugging session run configuration is created, you can
just use <code class="language-plaintext highlighter-rouge">npm run start</code> to start the server in a terminal and still be able to debug
it!</li>
</ol>
      <h2 id="upgrade-cra-itself-to-the-latest-version">
        
        
          Upgrade CRA itself to the latest version <a href="#upgrade-cra-itself-to-the-latest-version">#</a>
        
        
      </h2>
    

<p>Follow instructions in the
<a href="https://github.com/facebook/create-react-app/blob/main/CHANGELOG.md">CRA changelog</a>. For
example, you can run something like the following w/out ejecting CRA itself.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">--save</span> <span class="nt">--save-exact</span> react-scripts@4.0.3
</code></pre></div></div>

<blockquote>
  <p>⚡ You can find the list of releases
<a href="https://github.com/facebook/create-react-app/releases">here</a>.</p>
</blockquote>

<p>You can upgrade any npm packages that you’re using with the following.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm update
</code></pre></div></div>
      <h2 id="using-cra-and-environment-variables">
        
        
          Using CRA and environment variables <a href="#using-cra-and-environment-variables">#</a>
        
        
      </h2>
    

<p>Read all about how to do this in this
<a href="https://create-react-app.dev/docs/adding-custom-environment-variables/">guide</a>.</p>

<p>For example, to use the <a href="https://docs.thecatapi.com/">Cat API</a>, you have to do the
following steps:</p>

<ol>
  <li>Get an API key from <a href="https://thecatapi.com/">https://thecatapi.com/</a>.</li>
  <li>Save this API key as <code class="language-plaintext highlighter-rouge">REACT_APP_CAT_API_KEY</code> in <code class="language-plaintext highlighter-rouge">$HOME/.profile</code> (for Ubuntu &amp; GNOME).</li>
</ol>

<ul>
  <li>You have to logout and log back in, in order for this to take effect on GUI apps
launched via GNOME.</li>
  <li>CRA will grab all the environment variables that are prefixed w/ <code class="language-plaintext highlighter-rouge">REACT_APP</code> and compile
them into the minified Javascript code that it generates.</li>
</ul>

<ol>
  <li>In your TypeScript code, you can use the following variable
<code class="language-plaintext highlighter-rouge">process.env.REACT_APP_CAT_API_KEY</code> in order to access the value of this environment
variable.</li>
</ol>
      <h2 id="css-reset">
        
        
          CSS Reset <a href="#css-reset">#</a>
        
        
      </h2>
    

<p>In order to use CSS Reset, do the following:</p>

<ol>
  <li>Copy the contents of this
<a href="https://meyerweb.com/eric/tools/css/reset/reset.css">CSS file</a> into
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/styles/reset.css"><code class="language-plaintext highlighter-rouge">reset.css</code></a>.
Feel free to modify this file to suit your needs.</li>
  <li>Then add <code class="language-plaintext highlighter-rouge">@import "reset.css";</code> to
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/styles/App.module.css"><code class="language-plaintext highlighter-rouge">App.module.css</code></a>,
which is used by
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/App.tsx"><code class="language-plaintext highlighter-rouge">App.tsx</code></a>.</li>
  <li>I also add entries for elements like <code class="language-plaintext highlighter-rouge">button</code> and <code class="language-plaintext highlighter-rouge">input</code> which are not explicitly set
by the default Reset CSS stylesheet (and thus end up using user agent stylesheet, which
isn’t what I want and why I’m using Reset CSS in the first place).</li>
</ol>

<blockquote>
  <p>⚠ <code class="language-plaintext highlighter-rouge">normalize.css</code> <strong>did not work</strong> for my needs (it’s supported by CRA). Even after
using the following instructions, the <code class="language-plaintext highlighter-rouge">browser user agent stylesheet</code> was just messing
up all the spacing.</p>

  <ul>
    <li>Using <code class="language-plaintext highlighter-rouge">normalize.css</code> is pretty straight forwards following this
<a href="https://www.albertgao.xyz/2018/11/11/8-features-you-can-add-after-using-create-react-app-without-ejecting/">guide</a>.
      <ol>
        <li>Simply run <code class="language-plaintext highlighter-rouge">npm install normalize.css</code></li>
        <li>Then add <code class="language-plaintext highlighter-rouge">import 'normalize.css'</code> line to the top of
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/index.tsx"><code class="language-plaintext highlighter-rouge">index.tsx</code></a></li>
      </ol>
    </li>
    <li>CRA comes w/ <a href="https://create-react-app.dev/docs/adding-css-reset/"><code class="language-plaintext highlighter-rouge">normalize.css</code></a>.</li>
  </ul>
</blockquote>
      <h2 id="using-css-class-pseudo-selectors-to-style-child-elements-of-a-parent">
        
        
          Using CSS class pseudo selectors to style child elements of a parent <a href="#using-css-class-pseudo-selectors-to-style-child-elements-of-a-parent">#</a>
        
        
      </h2>
    

<p>Using CSS class pseudo selectors in order to style child elements of a parent (which has
this style applied) w/out having to manually assign classes to each of these children.
Let’s say that the parent has this class
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/styles/App.module.css"><code class="language-plaintext highlighter-rouge">DottedBox</code></a>,
which will do this, here’s the CSS. Here’s a <a href="https://youtu.be/9e-lWQdO-DA">video</a> by
Kevin Powell where he uses this pattern for flexbox.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">.DottedBox { padding: 8pt; border: 4pt dotted cornflowerblue; }</code></li>
  <li><code class="language-plaintext highlighter-rouge">.DottedBox &gt; * { /* this gets applied to all the children */ }</code></li>
</ol>
      <h2 id="composition-over-inheritance">
        
        
          Composition over inheritance <a href="#composition-over-inheritance">#</a>
        
        
      </h2>
    

<p>Use
<a href="https://reactjs.org/docs/composition-vs-inheritance.html">composition over inheritance</a>
to make components reusable.</p>

<ol>
  <li>This happens when you think about a component as a “generic box” and simply pass other
JSX elements inside of them as <code class="language-plaintext highlighter-rouge">props.children</code>.</li>
  <li>You can see this in
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/basics/ComponentWithoutState.tsx"><code class="language-plaintext highlighter-rouge">ComponentWithoutState</code></a>.</li>
  <li>In order to get this to work with TypeScript you have to make sure to add this to the
props type <code class="language-plaintext highlighter-rouge">childComp?: React.ReactNode</code>. For example, take a look at
<code class="language-plaintext highlighter-rouge">MessagePropsWithChildren</code> in
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/types.tsx"><code class="language-plaintext highlighter-rouge">types.tsx</code></a></li>
</ol>
      <h2 id="callable">
        
        
          Callable <a href="#callable">#</a>
        
        
      </h2>
    

<p><code class="language-plaintext highlighter-rouge">Callable</code> interfaces are great, and I’ve done an implementation of this in
<a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/main/src/color-console-utils.ts"><code class="language-plaintext highlighter-rouge">ColorConsole</code></a>
included in <a href="https://www.npmjs.com/package/r3bl-ts-utils"><code class="language-plaintext highlighter-rouge">r3bl-ts-utils</code></a>.</p>

<ul>
  <li>I took a slightly different approach this time, using the great information in this
<a href="https://stackoverflow.com/questions/12769636/how-to-make-a-class-implement-a-call-signature-in-TypeScript">SO Answer</a>
which I also used in the <code class="language-plaintext highlighter-rouge">ColorConsole</code> implementation.</li>
  <li>Here are the key takeaways in the
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/animate/ReactReplayClassComponent.tsx"><code class="language-plaintext highlighter-rouge">ReactReplayClassComponent</code></a>
implementation:
    <ol>
      <li>A class can’t implement the <code class="language-plaintext highlighter-rouge">Callable</code> interface.</li>
      <li>However, any member of the class can, and that member can be exposed as <code class="language-plaintext highlighter-rouge">Callable</code>.</li>
      <li>This member is exposed as a getter.</li>
      <li>This member can then be the only export in the module.</li>
    </ol>
  </li>
  <li>In this case, the getter simply returns the reference to the ‘generatorImpl’ method. So
we can write things like <code class="language-plaintext highlighter-rouge">GenerateReactElement.generator(...)</code> instead of just
<code class="language-plaintext highlighter-rouge">GenerateReactElement.generator</code> (which is the normal use of a getter).</li>
</ul>
      <h2 id="typescript-namespaces">
        
        
          TypeScript namespaces <a href="#typescript-namespaces">#</a>
        
        
      </h2>
    

<blockquote>
  <p>⚡ Read the official TypeScript docs on
<a href="https://www.TypeScriptlang.org/docs/handbook/namespaces.html">namespaces</a>.</p>
</blockquote>

<p>They allow encapsulation of variables, types, and other symbols in a neat package. This
can be exported to other modules that need them or just be used inside a single file to
organize and hide details.</p>

<p>Here’s an example of using this in
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/CatApiComponent.tsx"><code class="language-plaintext highlighter-rouge">CatApiComponent.tsx</code></a>.
Here are some excerpts from this file.</p>

<p>Here is a snippet that shows the use of <code class="language-plaintext highlighter-rouge">namespace</code> to encapsulate the details of
accessing this web API.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">namespace</span> <span class="nx">TheCatApi</span> <span class="p">{</span>
  <span class="k">export</span> <span class="kd">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_CAT_API_KEY</span> <span class="k">as</span> <span class="kr">string</span>
  <span class="k">export</span> <span class="kd">const</span> <span class="nx">search</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://api.thecatapi.com</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">endpoint</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/v1/images/search</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">config</span><span class="p">:</span> <span class="p">{</span> <span class="na">params</span><span class="p">:</span> <span class="p">{</span> <span class="na">limit</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">size</span><span class="p">:</span> <span class="dl">"</span><span class="s2">full</span><span class="dl">"</span> <span class="p">}</span> <span class="p">},</span>
  <span class="p">}</span> <span class="k">as</span> <span class="kd">const</span>
  <span class="k">export</span> <span class="kd">type</span> <span class="nx">SearchResults</span> <span class="o">=</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">url</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It is possible to import a symbol from one namespace, into another namespace, even in the
same file. Here’s an excerpt from the
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/CatApiComponent.tsx"><code class="language-plaintext highlighter-rouge">CatApiComponent.tsx</code></a>
file used above.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nx">MyActions</span> <span class="p">{</span>
  <span class="kr">interface</span> <span class="nx">ActionFetchStart</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fetchStart</span><span class="dl">"</span>
  <span class="p">}</span>

  <span class="kr">interface</span> <span class="nx">ActionFetchOk</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fetchOk</span><span class="dl">"</span>
    <span class="nx">payload</span><span class="p">:</span> <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">SearchResults</span><span class="p">[]</span>
  <span class="p">}</span>

  <span class="kr">interface</span> <span class="nx">ActionFetchError</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fetchError</span><span class="dl">"</span>
    <span class="nx">error</span><span class="p">:</span> <span class="kr">any</span>
  <span class="p">}</span>

  <span class="k">export</span> <span class="kd">type</span> <span class="nx">Action</span> <span class="o">=</span> <span class="nx">ActionFetchStart</span> <span class="o">|</span> <span class="nx">ActionFetchOk</span> <span class="o">|</span> <span class="nx">ActionFetchError</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The encapsulated <code class="language-plaintext highlighter-rouge">namespace</code> for this web API can then be used in other files (eg:
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/__tests__/TestUtils.ts"><code class="language-plaintext highlighter-rouge">TestUtils.ts</code></a>)
and
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/cat_api/__tests__/TheCatApiEndpointMock.test.tsx"><code class="language-plaintext highlighter-rouge">TheCatApiEndpointMock.test.tsx</code></a>.
Here are some excerpts from these files.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">TheCatApi</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../CatApiComponent</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">restHandlerSearchOk</span><span class="p">:</span> <span class="nx">RestHandler</span> <span class="o">=</span> <span class="nx">rest</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
  <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span>
  <span class="p">(</span>
    <span class="nx">req</span><span class="p">:</span> <span class="nx">RestRequest</span><span class="o">&lt;</span><span class="nx">DefaultRequestBody</span><span class="p">,</span> <span class="nx">RequestParams</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">res</span><span class="p">:</span> <span class="nx">ResponseComposition</span><span class="p">,</span>
    <span class="nx">ctx</span><span class="p">:</span> <span class="nx">RestContext</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">res</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">json</span><span class="p">(</span><span class="nx">cannedResponseOk</span><span class="p">))</span>
<span class="p">)</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">makeGetRequest</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span>
  <span class="nf">_let</span><span class="p">(</span><span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">search</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">axios</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">common</span><span class="p">[</span><span class="dl">"</span><span class="s2">x-api-key</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">TheCatApi</span><span class="p">.</span><span class="nx">apiKey</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">it</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">it</span><span class="p">.</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">it</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">payload</span>
  <span class="p">})</span>
</code></pre></div></div>

<p>The following sections show different ways to use <code class="language-plaintext highlighter-rouge">namespace</code>.</p>

<ul>
  <li><a href="#using-the-mocked-server-in-a-ui-test">One way of using namespaces to encapsulate React components for testing</a>.</li>
  <li><a href="#complex-unit-tests">Another way of using namespaces to only export testing related symbols for testing</a></li>
</ul>
      <h2 id="typescript-readonly-vs-readonlyarray">
        
        
          TypeScript readonly vs ReadonlyArray <a href="#typescript-readonly-vs-readonlyarray">#</a>
        
        
      </h2>
    

<p>More info on <code class="language-plaintext highlighter-rouge">readonly</code> vs <code class="language-plaintext highlighter-rouge">ReadonlyArray</code>:</p>

<ul>
  <li><a href="https://mariusschulz.com/blog/read-only-array-and-tuple-types-in-TypeScript">Read-Only Array and Tuple Types in TypeScript</a></li>
  <li><a href="https://basarat.gitbook.io/TypeScript/type-system/readonly">Readonly vs ReadonlyArray</a></li>
</ul>

<blockquote>
  <p>💡 Here’s more info on TypeScript type narrowing, truthy/falsy, user defined type
predicates, and discriminated unions from the
<a href="https://www.TypeScriptlang.org/docs/handbook/2/narrowing.html">official docs</a>.</p>
</blockquote>

<p>If you mark an variable holding an array as <code class="language-plaintext highlighter-rouge">readonly</code>, you can’t reassign it. However,
you can <code class="language-plaintext highlighter-rouge">push()</code>, <code class="language-plaintext highlighter-rouge">pop()</code>, and mutate it! In the example below, <code class="language-plaintext highlighter-rouge">values</code> supports
mutation!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ContainsArray</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="k">readonly</span> <span class="nx">values</span><span class="p">:</span> <span class="kr">string</span><span class="p">[])</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContainsArray</span><span class="p">([</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">])</span>
<span class="nx">object</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">d</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// This is ok! 👎</span>
</code></pre></div></div>

<p>So, in order to lock down that array, you can do the following. Note the subtle difference
in the keyword <code class="language-plaintext highlighter-rouge">readonly</code> showing up twice!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ContainsArray</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="k">readonly</span> <span class="nx">values</span><span class="p">:</span> <span class="k">readonly</span> <span class="kr">string</span><span class="p">[])</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContainsArray</span><span class="p">([</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">])</span>
<span class="nx">object</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">d</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// This is NOT ok! 👍</span>
</code></pre></div></div>

<p>Another way to write the same thing is as follows.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ContainsArray</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="k">readonly</span> <span class="nx">values</span><span class="p">:</span> <span class="nx">ReadonlyArray</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContainsArray</span><span class="p">([</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">])</span>
<span class="nx">object</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="dl">"</span><span class="s2">d</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// This is ok!</span>
</code></pre></div></div>

<p>In the code for
<a href="https://github.com/nazmulidris/ts-scratch/tree/main/react-app-hooks-intro/src/components/animate/ReactReplayClassComponent.tsx"><code class="language-plaintext highlighter-rouge">ReactReplayClassComponent</code></a>,
the following lines do the same thing (preventing any mutations on <code class="language-plaintext highlighter-rouge">elementArray</code>):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">readonly elementArray: readonly JSX.Element[]</code></li>
  <li><code class="language-plaintext highlighter-rouge">readonly elementArray: ReadonlyArray&lt;JSX.Element&gt;</code></li>
</ul>
      <h2 id="typescript-prop-and-state-types">
        
        
          TypeScript prop and state types <a href="#typescript-prop-and-state-types">#</a>
        
        
      </h2>
    

<p>In strict mode, the prop and state types (if any) need to be declared explicitly. The
React codebase supports generics which is how these types are declared.</p>

<blockquote>
  <p>💡 You can also pass <code class="language-plaintext highlighter-rouge">{}</code> to specify that there are no props or state.</p>
</blockquote>

<p>Here is a <a href="https://fettblog.eu/TypeScript-react/components/#class-components">tutorial</a>
that shows how to specify prop and state types for function and class components.</p>

<p>Here’s an example for a class component which takes props but contains no state. Note that
no children can be passed.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">AnimationFramesProps</span> <span class="p">{</span>
  <span class="nl">animationFrames</span><span class="p">:</span> <span class="nb">Readonly</span><span class="o">&lt;</span><span class="nx">ReactElement</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">ReactReplayClassComponent</span> <span class="kd">extends</span> <span class="nc">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span><span class="nx">AnimationFramesProps</span><span class="p">,</span> <span class="p">{}</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you wanted children to be passed, you could do something like this.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">AnimationFramesPropsWithKids</span> <span class="kd">extends</span> <span class="nx">AnimationFramesProps</span> <span class="p">{</span>
  <span class="cm">/** More info: https://linguinecode.com/post/pass-react-component-as-prop-with-TypeScript */</span>
  <span class="nl">children</span><span class="p">?:</span> <span class="nb">Readonly</span><span class="o">&lt;</span><span class="nx">ReactElement</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">ReactReplayClassComponent</span> <span class="kd">extends</span> <span class="nc">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span>
  <span class="nx">AnimationFramesPropsWithKids</span><span class="p">,</span>
  <span class="p">{}</span>
<span class="o">&gt;</span> <span class="p">{</span>
  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can also wrap your prop type, eg: <code class="language-plaintext highlighter-rouge">MyPropType</code>, w/ <code class="language-plaintext highlighter-rouge">PropsWithChildren&lt;MyPropType&gt;</code>
when declaring your function component to declare that your component can accept
<code class="language-plaintext highlighter-rouge">children</code>. And then you can use the destructuring syntax to get the required props out.</p>

<blockquote>
  <p>💡 TypeScript supports built-in and user defined
<a href="https://www.TypeScriptlang.org/docs/handbook/utility-types.html">utility types</a> and
<a href="https://www.TypeScriptlang.org/docs/handbook/advanced-types.html#type-guards-and-differentiating-types">advanced types</a>
which are in leverage in <code class="language-plaintext highlighter-rouge">PropsWithChildren</code> type. It takes your prop type as an
argument and returns a new type which includes everything in your type and
<code class="language-plaintext highlighter-rouge">children?: ReactNode | undefined</code>.</p>
</blockquote>

<p>Here’s an example.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">type</span> <span class="nx">TooltipOverlayProps</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">text</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">TooltipOverlay</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">PropsWithChildren</span><span class="o">&lt;</span><span class="nx">TooltipOverlayProps</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">children</span><span class="p">,</span>
  <span class="nx">text</span><span class="p">,</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Note the use of the destructuring syntax to get the specific properties (<code class="language-plaintext highlighter-rouge">children</code>,
<code class="language-plaintext highlighter-rouge">text</code>) out of the passed <code class="language-plaintext highlighter-rouge">props</code> object. The types are defined in <code class="language-plaintext highlighter-rouge">TooltipOverlayProps</code>
(<code class="language-plaintext highlighter-rouge">text</code> comes from this) and <code class="language-plaintext highlighter-rouge">PropsWithChildren</code> (<code class="language-plaintext highlighter-rouge">children</code> comes from this).</p>
</blockquote>

<p>Here’s an example for a function component. Note the use of <code class="language-plaintext highlighter-rouge">FC</code> to specify that this is a
function component that takes a prop. Being a function component, you can’t declare any
state types.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">ReactReplayFunctionComponent</span><span class="p">:</span> <span class="nx">FC</span><span class="o">&lt;</span><span class="nx">AnimationFramesProps</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">props</span>
<span class="p">):</span> <span class="nx">ReactElement</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/* snip */</span>
<span class="p">}</span>
</code></pre></div></div>
      <h2 id="typescript-and-reactnode-reactelement-jsxelement">
        
        
          TypeScript and ReactNode, ReactElement, JSX.Element <a href="#typescript-and-reactnode-reactelement-jsxelement">#</a>
        
        
      </h2>
    

<p>This <a href="https://stackoverflow.com/a/58123882/2085356">SO thread</a> has the answers. Basically,</p>

<ol>
  <li>Use <code class="language-plaintext highlighter-rouge">ReactElement</code> where possible.</li>
  <li>When TypeScript complains at times, use <code class="language-plaintext highlighter-rouge">ReactElement | null</code>.</li>
  <li>Class components (return <code class="language-plaintext highlighter-rouge">ReactElement | null</code>) and function components (return
<code class="language-plaintext highlighter-rouge">ReactElement</code>) actually return different things.</li>
</ol>
      <h2 id="typescript-types-in-array-and-object-destructuring">
        
        
          TypeScript types in array and object destructuring <a href="#typescript-types-in-array-and-object-destructuring">#</a>
        
        
      </h2>
    

<p>More info:</p>

<ul>
  <li><a href="https://basarat.gitbook.io/TypeScript/future-javascript/destructuring#array-destructuring">Array and object destructuring in ES6</a></li>
  <li><a href="https://mariusschulz.com/blog/typing-destructured-object-parameters-in-TypeScript#typing-immediately-destructured-parameters">Typing destructured objects in TypeScript</a></li>
  <li><a href="https://www.carlrippon.com/strongly-typed-destructuring-and-rest-parameters/">Typing destructed arrays in TypeScript</a></li>
</ul>

<p>Example of object destructuring.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">AnimationFrames</span> <span class="o">=</span> <span class="nb">Readonly</span><span class="o">&lt;</span><span class="nb">Array</span><span class="o">&lt;</span><span class="nx">ReactElement</span><span class="o">&gt;&gt;</span>
<span class="kd">type</span> <span class="nx">MyProps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">animationFrames</span><span class="p">:</span> <span class="nx">AnimationFrames</span> <span class="p">}</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">animationFrames</span> <span class="p">}:</span> <span class="nx">MyProps</span> <span class="o">=</span> <span class="nx">props</span>
</code></pre></div></div>

<p>Example of array destructuring.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">FrameIndexStateType</span> <span class="o">=</span> <span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;&gt;</span><span class="p">]</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">frameIndex</span><span class="p">,</span> <span class="nx">setFrameIndex</span><span class="p">]:</span> <span class="nx">FrameIndexStateType</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

        <!--
    Display all the categories for this page
    More info:
    - Tutorial - http://tinyurl.com/yc6fq6zx
    - Liquid language reference - http://tinyurl.com/y8s4qpwo
-->
<div class="categories-block">
    
    
    <span class="category">
            <a href="/category/React">
                #react</a>
        </span>
    
    <span class="category">
            <a href="/category/TypeScript">
                #typescript</a>
        </span>
    
    <span class="category">
            <a href="/category/Web">
                #web</a>
        </span>
    
</div>

        
<blockquote>

📦 Install our useful Rust command line apps using <code>cargo install r3bl-cmdr</code>
(they are from the <a href="https://github.com/r3bl-org/r3bl-open-core">r3bl-open-core</a>
project):
<ul>
  <li>🐱<code>giti</code>: run interactive git commands with confidence in your terminal</li>
  <li>🦜<code>edi</code>: edit Markdown with style in your terminal</li>
</ul>

<p>
<kbd>giti in action</kbd>
<video width="100%" controls>
  <source src="https://github.com/nazmulidris/developerlife.com/assets/2966499/262f59d1-a95c-4af3-accf-c3d6cac6e586" type="video/mp4"/>
</video>
</p>

<p>
<kbd>edi in action</kbd>
<video width="100%" controls>
  <source src="https://github.com/nazmulidris/developerlife.com/assets/2966499/f2c4b07d-b5a2-4f41-af7a-06d1b6660c41" type="video/mp4"/>
</video>
</p>

</blockquote>

        <!--
    Display related posts (by category)
    More info:
    - Tutorial - http://tinyurl.com/j5tevq7
    - Liquid language reference - http://tinyurl.com/y9ru5msq
-->
<div class="related-post-block">

    <h3>Related Posts</h3>

    <!-- Get all the related posts into the string `postsString`-->
    
    
    

    <!--
        At this point `postsString` string might look like:
        Post 3|Post 1|Post 3|Post 2|Post 1|Post 3|Post 2|
    -->

    <!-- Remove all the dupes from the `postsString` string, and split it into an array -->
    

    <ul>
        
            
                
                <li>
                    <a class="post-list" href="/2023/08/11/chrome-extension-shortlink/">
                        Build a Chrome Extension using Manifest V3
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/11/25/ink-v3-advanced-ui-components/">
                        Reference handbook for using Ink v3.2.0 components (w/ React, Node.js and TypeScript)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/11/05/ink-v3-advanced/">
                        Advanced guide to Ink v3.2.0 (w/ React, Node.js and TypeScript)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/11/04/introduction-to-ink-v3/">
                        Introduction to Ink v3.2.0 (w/ React, Node.js and TypeScript)
                    </a>
                </li>
            
        
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/10/19/css-responsive-design-handbook/">
                        CSS responsive design using Grid, Flexbox, and media queries handbook
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/11/14/flexbox-building-a-navigation-bar-part-2-2/">
                        Flexbox: Building a navigation bar (Part 2/2)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2016/10/06/getting-started-with-react-redux-and-firebase/">
                        Building a real world app using React, Redux, Firebase, and Typescript
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2016/10/02/getting-started-with-react-and-firebase/">
                        Building a real world app using React, Firebase, and Typescript
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/07/02/nodejs-typescript-handbook/">
                        Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2019/08/25/guide-to-building-responsive-web-apps/">
                        A pragmatic guide to designing and building responsive web applications
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2019/07/06/starter-project-typescript-karma-jasmine-webpack/">
                        TypeScript starter project w/ Webpack 4, Karma, Jasmine
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2018/08/22/vue-vueitfy-webpack/">
                        Vue.js, Webpack, Vueitify, Electron, and vue-cli
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2018/08/15/introduction-to-vue/">
                        Getting started with Vue.js
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/11/15/flexbox-getting-started-part-1-2/">
                        Flexbox: Getting started (Part 1/2)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/07/19/loading-csv-files-in-javascript-and-node/">
                        Loading CSV files in Node
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/04/26/flexbox-layouts-and-lists-with-react-native/">
                        Flexbox layouts and lists with React Native
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2016/10/12/firebase-presence/">
                        Using Firebase for user presence tracking
                    </a>
                </li>
            
        
    </ul>

</div>

        <a class="u-url" href="/2021/10/19/react-hooks-redux-typescript-handbook/" hidden></a>
    </div></article>
</div>
      </main><div>
  <section class="sidebar">
    <h2 class="star-us-github-heading">
      Subscribe to our Rust live coding <a
      href="https://www.youtube.com/@developerlifecom">YouTube Channel</a><span
      class="heading-emoji"> 🦀</span>
    </h2>

    <iframe width="330" height="185"
      src="https://www.youtube.com/embed/videoseries?si=i37Ei9nCfvslOoaI&amp;list=PLofhE49PEwmwelPkhfiqdFQ9IXnmGdnSE"
      title="YouTube video player" frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
    </iframe>

    <br/>
    <br/>

    <h2 class="star-us-github-heading">
      Use our extensions, apps, binary and library crates<span class="heading-emoji"> 📦</span>
    </h2>

    <ul class="sidebar-ul">
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/cmdr" target="_blank">
          <img class="star-icon-img" src="/assets/r3bl-apps.svg" />
          <div class="sidebar-list-item">
            <p class="p-tag">INSTALL & USE OUR APPS (giti, edi)</p>
            <h3 class="sidebar-h3"><code>r3bl-cmdr</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/shortlink" target="_blank">
          <img class="star-icon-img" src="/assets/r3bl-shortlink.svg" />
          <div class="sidebar-list-item">
            <p class="p-tag">SHORTLINK browser extension</p>
            <h3 class="sidebar-h3"><code>shortlink</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tui" target="_blank">
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TUI LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_tui</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tuify" target="_blank">
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TUIFY LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_tuify</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/terminal_async" target="_blank">
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TERMINAL ASYNC LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_terminal_async</code></h3>
          </div>
        </a>
      </li>
    </ul>
  </section>
</div>


</div><footer class="site-footer h-card">

    <div class="wrapper">

        <div class="footer-col-wrapper">

            <div class="footer-col"><!-- <p>
    developerlife.com site was started in Nov 1998 with coverage for
    topics related to Java, XML, and web and desktop technologies.
    Today it covers Kotlin, TypeScript, Node.js, React, Android, JDK,
    Web, Cloud technologies, User Experience Engineering (UXE)
    and design topics. © Nazmul Idris 2022. All rights reserved.
</p> -->
<div>
  <p class="footer-p">
    developerlife.com site was started in Nov 1998 by <a href="https://developerlife.com/about-me/">Nazmul Idris</a>, with coverage for topics related to Java, XML,
    and web and desktop technologies. Today it covers Rust, TUI, CLI, Kotlin, TypeScript, Node.js, React, Android,
    JDK, Web, Cloud technologies, User Experience Engineering (UXE) and design topics. © Nazmul
    Idris 2022. All rights reserved.
  </p>
  <div class="footer-container">
    <!-- element 1 -->
    <kbd>
      <a class="footer-elem-1" href="/subscribe.html" target="_blank"
        >Subscribe for updates</a
      >
    </kbd>

    <!-- element 2 -->
    <kbd>
      <a class="footer-elem-2" href="https://r3bl.com" target="_blank">Sponsored by R3BL</a>
    </kbd>
  </div>
</div>
</div>

        </div>

    </div>

</footer>
<script>
//open external links in a new window
function external_new_window() {
    for(var c = document.getElementsByTagName("a"), a = 0;a < c.length;a++) {
    var b = c[a];
    b.getAttribute("href") && b.hostname !== location.hostname && (b.target = "_blank")
    }
}
//open PDF links in a new window
function pdf_new_window ()
{
    if (!document.getElementsByTagName) return false;
    var links = document.getElementsByTagName("a");
    for (var eleLink=0; eleLink < links.length; eleLink ++) {
    if ((links[eleLink].href.indexOf('.pdf') !== -1)||(links[eleLink].href.indexOf('.doc') !== -1)||(links[eleLink].href.indexOf('.docx') !== -1)) {
        links[eleLink].onclick =
        function() {
            window.open(this.href);
            return false;
        }
    }
    }
} 
pdf_new_window()
external_new_window();
</script></body>
</html>
