<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Node.js (v16.3.0) Handbook using TypeScript (v4.3.4) | developerlife.com</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)" />
<meta name="author" content="Nazmul Idris" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This handbook will use TypeScript to take you thru using Node.js. IDEA Ultimate / Webstorm project files are provided. This handbook is written as a reference. You can easily jump to the section that is relevant to you or read them in any order that you like." />
<meta property="og:description" content="This handbook will use TypeScript to take you thru using Node.js. IDEA Ultimate / Webstorm project files are provided. This handbook is written as a reference. You can easily jump to the section that is relevant to you or read them in any order that you like." />
<link rel="canonical" href="http://developerlife.com/2021/07/02/nodejs-typescript-handbook/" />
<meta property="og:url" content="http://developerlife.com/2021/07/02/nodejs-typescript-handbook/" />
<meta property="og:site_name" content="developerlife.com" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-02T09:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Nazmul Idris"},"dateModified":"2021-07-02T09:00:00-05:00","datePublished":"2021-07-02T09:00:00-05:00","description":"This handbook will use TypeScript to take you thru using Node.js. IDEA Ultimate / Webstorm project files are provided. This handbook is written as a reference. You can easily jump to the section that is relevant to you or read them in any order that you like.","headline":"Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)","mainEntityOfPage":{"@type":"WebPage","@id":"http://developerlife.com/2021/07/02/nodejs-typescript-handbook/"},"url":"http://developerlife.com/2021/07/02/nodejs-typescript-handbook/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css" />

  <!-- Add favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <!-- Add font awesome -->
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"
    integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
    crossorigin="anonymous"
  />

  <!-- Add Google fonts-->
  <link
    href="https://fonts.googleapis.com/css?family=Spline+Sans|Work+Sans|Fira+Mono|Fira+Sans|Google+Sans|Lexend+Deca&display=swap"
    rel="stylesheet"
  /><link type="application/atom+xml" rel="alternate" href="http://developerlife.com/feed.xml" title="developerlife.com" /><!-- https://developers.google.com/analytics/devguides/collection/gtagjs -->
<script async
        src="https://www.googletagmanager.com/gtag/js?id=G-NQY9ECC58H"></script>
<script>
  window.dataLayer = window.dataLayer || []

  function gtag() {
    window.dataLayer.push(arguments)
  }

  gtag("js", new Date())
  gtag("config", "G-NQY9ECC58H")
</script>
<!-- https://us14.admin.mailchimp.com/account/connected-sites/site-detail/ -->

<script id="mcjs">
  !(function (c, h, i, m, p) {
    ;(m = c.createElement(h)),
      (p = c.getElementsByTagName(h)[0]),
      (m.async = 1),
      (m.src = i),
      p.parentNode.insertBefore(m, p)
  })(
    document,
    "script",
    "https://chimpstatic.com/mcjs-connected/js/users/c2470ddfa863eb8ace707651b/2bb3bcad193ef862398700457.js"
  )
</script>
</head>
<body><!-- https://github.com/mermaid-js/mermaid/blob/develop/docs/n00b-gettingStarted.md -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<script>
  // https://mermaid-js.github.io/mermaid/#/theming
  mermaid.initialize({
    startOnLoad: true,
    theme: "dark",
    themeVariables: {
      fontFamily: "Fira Code",
      fontSize: "0.95rem",
      darkMode: true,
      primaryColor: "#2f9ece",
      mainBkg: "#303439",
    },
  })
</script>
<header class="site-header" role="banner">

    <div class="wrapper header-wrapper"><div class="logo-container">
        <div class="logo-image">
          <a class="site-title"
             rel="author"
             href="/">
              <!-- This is the logo image placeholder. -->
                <picture>
                  <source srcset="/assets/dl-logo-icon-dark.svg" media="(max-width: 600px)"/>
                  <img  src="/assets/dl-logo-icon-and-text-dark.svg" />
                </picture>
          </a>
        </div>
      </div><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger"/>
            <label for="nav-trigger">
          <span class="menu-icon">
              <svg class="svg-icon">
              <use xlink:href="/assets/minima-social-icons.svg#menu">
              </use>
            </svg>
          </span>
            </label>

            <div class="trigger"><!--
    Iterate over all the pages in the site, where page_cursor holds the current
    page for each pass of the for loop.
    Note that page is the currently loaded page itself.
--><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Android/"> Android </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CC/"> Concurrency </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CLI/"> CLI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/CS/"> CS </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/DB/"> Database </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/DI/"> DI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/FE/"> Frontend </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Hardware/"> Hardware </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/IJ/"> IntelliJ </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/KT/"> Kotlin </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Linux/"> Linux </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/MP/"> MP </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Misc/"> Misc </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Node/"> Node </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Productivity/"> Productivity </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/RN/"> React-Native </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/React/"> React </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Rust/"> Rust </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Server/"> Server </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/State/"> State-Management </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Stories/"> Stories </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TDD/"> Testing </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TS/"> TypeScript </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/TUI/"> TUI </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/category/Web/"> Web </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/about-me/"> Nazmul Idris </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/about-site/"> About Us </a><!-- This item is not selected -->
        <!-- Don't list excluded pages --><a class="page-link" href="/authors/"> Authors </a></div>
        </nav></div>
</header>

<!-- Debug to show the value of page.title and page.category variables -->
<!--<pre>page_cursor.exclude = nil</pre>-->
<!--<pre>page.exclude = nil</pre>-->
<!--<pre>page.title = &quot;Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)&quot;</pre>-->
<!--<pre>page.category = nil</pre>-->
<!--<pre>page.title (json) = Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)</pre>-->
<!--<pre>page.category (json) = </pre>-->
<div class="page-and-sidebar-wrapper">
      <main class="page-content" aria-label="Content">
        <div class="wrapper"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)</h1>

    <!-- Create all the variables needed for this page (and all the includes) -->
    

    <div class="post-meta">
        <p>
            <!-- Date -->Jul 2, 2021

            <!--Author-->
            ∙ <a href="/about-me">Nazmul Idris</a>

            <!-- One line social blurb --><ul class="contact-list">
    <li class="p-name">Hi, I'm
            <a href="/about-me">Nazmul</a>,
            an ex-Googler, <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tui" target="_blank">r3bl_tui maintainer</a>, SWE, entrepreneur, designer, leader,
            TaiChi-er, racer, storyteller.
            <!-- This is font awesome icon -->
            I <i class="fas fa-heart"></i>
            leadership, authenticity, empowerment, lifelong learning,
            <i class="fas fa-code"></i>,
            <i class="fas fa-terminal"></i>, &
            <i class="fas fa-coffee"></i>,
            😃.</li>
</ul>
</p>
    </div><div class="social-media-container">
  <!-- <iframe
    src="https://github.com/sponsors/nazmulidris/button"
    title="Sponsor nazmulidris"
    height="35"
    width="116"
    style="border: 0; padding-right: 6px"
  ></iframe> -->

  <a href="/subscribe.html" target="_blank"
    ><kbd>Subscribe for updates</kbd></a
  ><p class="social-media-item">
    <a
      href="https://www.linkedin.com/in/nazmulidris"
      target="_blank"
    >
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a href="https://www.youtube.com/channel/UCMcsxfCwzwDevc3NRqFgfEg" target="_blank">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a href="https://www.github.com/nazmulidris" target="_blank">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#github"></use>
      </svg>
    </a>
  </p><p class="social-media-item">
    <a href="/feed.xml" target="_blank">
      <svg class="svg-icon">
        <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
      </svg>
    </a>
  </p></div>
</header>
<div class="post-content e-content" itemprop="articleBody">
        <blockquote>
  👀 Watch Rust 🦀 live coding videos on our
  <a href="https://www.youtube.com/@developerlifecom">YouTube Channel</a>.

  <br />

  <!-- video on rust polymorphism (no playlist) -->
  <iframe
      src="https://www.youtube.com/embed/kYTgGtJjSro?si=XmW-_CAvCfB5e269"
      title="YouTube video player" frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
      >
  </iframe>

  <!-- video on intro to testing (with playlist) -->
  <!-- <iframe
    src="https://www.youtube.com/embed/videoseries?si=7gmhXY5DVYJG7OdU&amp;list=PLofhE49PEwmwLR_4Noa0dFOSPmSpIg_l8"
    title="YouTube video player"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen
  >
  </iframe> -->

</blockquote>

        <!-- If a page has a hero-image defined in it, then show it here -->


        <p><img class="post-hero-image" src="/assets/nodejs-ts-handbook.svg" /></p>

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

<ul>
  <li><a href="#nodejs-v1630-handbook-using-typescript-v434">Node.js (v16.3.0) Handbook using TypeScript (v4.3.4)</a></li>
  <li><a href="#nodejs-installation-on-linux-using-brew">Node.js installation on Linux (using brew)</a></li>
  <li><a href="#nodejs-project-setup-using-idea">Node.js project setup using IDEA</a></li>
  <li><a href="#nodejs-threading-model">Node.js threading model</a>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#event-loop">Event loop</a></li>
      <li><a href="#worker-threads-api-for-js-code">Worker threads API for JS code</a></li>
      <li><a href="#streaming-and-high-performance-json-apis">Streaming and high performance JSON APIs</a></li>
      <li><a href="#libuv-and-worker-threads">libuv and worker threads</a></li>
      <li><a href="#n-api-for-native-addons">N-API for native addons</a></li>
      <li><a href="#kotlin-native-and-c-interop">Kotlin Native and C interop</a></li>
    </ul>
  </li>
  <li><a href="#message-queue-and-es6-job-queue">Message Queue and ES6 Job Queue</a>
    <ul>
      <li><a href="#message-queue-and-settimeout-setimmediate---execute-at-next-tick">Message Queue and setTimeout(), setImmediate() - execute at next tick</a></li>
      <li><a href="#processnexttick---execute-at-the-end-of-this-tick">process.nextTick() - execute at the end of this tick</a></li>
      <li><a href="#es6-job-queue-for-promises">ES6 Job Queue (for Promises)</a></li>
    </ul>
  </li>
  <li><a href="#typescript-and-javascript-language">TypeScript and JavaScript language</a>
    <ul>
      <li><a href="#promises-async-await">Promises, async, await</a></li>
      <li><a href="#use-stricttrue-in-tsconfigjson-options">Use strict=true in tsconfig.json options</a></li>
      <li><a href="#use-unknown-over-any">Use unknown over any</a></li>
      <li><a href="#user-defined-type-guards">User defined type guards</a></li>
      <li><a href="#never-bottom-type">never “bottom” type</a></li>
      <li><a href="#typescript-jsdocs">TypeScript JSDocs</a></li>
      <li><a href="#this-keyword-and-kotlin-scoping-functions">this keyword and Kotlin scoping functions</a></li>
      <li><a href="#callable-interfaces-and-implementations-in-typescript">Callable interfaces and implementations in TypeScript</a></li>
    </ul>
  </li>
  <li><a href="#testing-with-jest">Testing with Jest</a>
    <ul>
      <li><a href="#setting-up-jest-and-typescript">Setting up Jest and TypeScript</a>
        <ul>
          <li><a href="#step-1---install-jest-and-types">Step 1 - Install Jest and types</a></li>
          <li><a href="#step-2---create-a-new-jestconfigts-file">Step 2 - Create a new jest.config.ts file</a></li>
          <li><a href="#step-3---create-test-files">Step 3 - Create test files</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#user-input-and-output-via-stdin-stdout">User input and output via stdin, stdout</a>
    <ul>
      <li><a href="#global-console-object">Global console object</a></li>
      <li><a href="#console-class-and-simple-logging">Console class (and simple logging)</a></li>
      <li><a href="#readline-from-global-console">readline from (global) console</a>
        <ul>
          <li><a href="#fp-example-using-question-wout-using-line-event">FP example using question (w/out using “line” event)</a></li>
          <li><a href="#oop-example-using-line-event-wout-using-question">OOP example using “line” event (w/out using question)</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#buffer">Buffer</a></li>
  <li><a href="#events">Events</a></li>
  <li><a href="#files">Files</a></li>
  <li><a href="#modules">Modules</a></li>
  <li><a href="#os-streams-process-network-etc">OS, streams, process, network, etc.</a>
    <ul>
      <li><a href="#os">OS</a></li>
      <li><a href="#process">Process</a></li>
      <li><a href="#streams-backpressure-pipes-files">Streams, backpressure, pipes, files</a>
        <ul>
          <li><a href="#pipe">pipe</a></li>
          <li><a href="#pipeline-transform-stream-and-errors">pipeline, transform stream, and errors</a></li>
        </ul>
      </li>
      <li><a href="#child-process">Child process</a>
        <ul>
          <li><a href="#deep-dive-into-spawn">Deep dive into spawn()</a>
            <ul>
              <li><a href="#example-1---spawn-a-child-process-to-execute-a-command">Example 1 - spawn a child process to execute a command</a></li>
              <li><a href="#stdio-streams-for-getting-input-to-and-output-from-child-process-commands">“stdio” streams for getting input to and output from child process commands</a></li>
              <li><a href="#example-2---pipe-processstdin-into-child-process-command">Example 2 - pipe process.stdin into child process command</a></li>
              <li><a href="#example-3---pipe-the-output-of-one-child-process-command-into-another-one">Example 3 - pipe the output of one child process command into another one</a></li>
              <li><a href="#example-4---ugly-code-to-redirect-the-output-of-one-child-process-command-to-another-one">Example 4 - ugly code to redirect the output of one child process command to another one</a></li>
            </ul>
          </li>
          <li><a href="#killing-or-aborting-a-child-process">Killing or aborting a child process</a></li>
          <li><a href="#brief-exploration-of-exec">Brief exploration of exec()</a></li>
          <li><a href="#brief-exploration-of-fork">Brief exploration of fork()</a></li>
          <li><a href="#example-of-replacing-a-fish-script-using-spawn">Example of replacing a fish script using spawn</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#publishing-npm-packages">Publishing npm packages</a></li>
</ul>

<!-- END doctoc generated TOC please keep comment here to allow auto update -->
      <h2 id="nodejs-v1630-handbook-using-typescript-v434">
        
        
          Node.js (v16.3.0) Handbook using TypeScript (v4.3.4) <a href="#nodejs-v1630-handbook-using-typescript-v434">#</a>
        
        
      </h2>
    

<p>This handbook will use TypeScript to take you thru using Node.js. The table of contents has a list
of topics that are covered in this handbook. You can easily jump to the section that is relevant to
you or read them in any order that you like.</p>

<p>Additionally, here are some great resources to use a reference for your journey into Node.js.</p>

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/xV5YWR3DGq3">Node.js: The complete course for beginners</a></li>
  <li><a href="https://jscomplete.com/learn/node-beyond-basics/child-processes">Tutorials</a></li>
  <li><a href="https://nodejs.org/api">Official docs</a></li>
</ul>
      <h2 id="nodejs-installation-on-linux-using-brew">
        
        
          Node.js installation on Linux (using brew) <a href="#nodejs-installation-on-linux-using-brew">#</a>
        
        
      </h2>
    

<p>You can get the latest version of Node.js using <a href="https://brew.sh/"><code class="language-plaintext highlighter-rouge">brew</code></a>, which is available on
Linux and MacOS. Once you have <code class="language-plaintext highlighter-rouge">brew</code> installed, simply run <code class="language-plaintext highlighter-rouge">brew install node</code>.</p>

<blockquote>
  <p>Note that on Linux, when using <code class="language-plaintext highlighter-rouge">apt</code> instead of <code class="language-plaintext highlighter-rouge">brew</code>, the package is called <code class="language-plaintext highlighter-rouge">nodejs</code> and not
<code class="language-plaintext highlighter-rouge">node</code>! So the <code class="language-plaintext highlighter-rouge">brew</code> package name is actually the “right” one.</p>
</blockquote>

<p>Here are some differences when using <code class="language-plaintext highlighter-rouge">brew</code> vs <code class="language-plaintext highlighter-rouge">apt</code>.</p>

<ol>
  <li>Unlike <code class="language-plaintext highlighter-rouge">apt</code>, the binaries for any global npm packages that you install will end up in
<code class="language-plaintext highlighter-rouge">/home/linuxbrew/.linuxbrew/bin/</code>.</li>
  <li>Also you won’t need to use <code class="language-plaintext highlighter-rouge">sudo</code> anymore to install npm packages globally!</li>
</ol>

<p>In IDEA / Webstorm if you use Prettier plugin or just to enable Node.js support, you might have to
provide the location of some of the things that you have installed above. The instructions below are
handy when configuring this.</p>

<p>I usually install the following packages globally after installing node using
<code class="language-plaintext highlighter-rouge">npm i -g prettier doctoc typescript ts-node ts-node-dev</code>, so to follow along, I recommend doing the
same.</p>

<p>I also create a symlink for these binaries in <code class="language-plaintext highlighter-rouge">/usr/local/bin/</code> for convenience. For a globally
installed npm package <code class="language-plaintext highlighter-rouge">&lt;some-npm-package&gt;</code>, here’s the pattern:</p>

<ul>
  <li>Symlinked binary is at <code class="language-plaintext highlighter-rouge">cd /usr/local/bin ; sudo ln -s (which &lt;some-npm-package&gt;)</code></li>
  <li>Actual binary is at <code class="language-plaintext highlighter-rouge">/home/linuxbrew/.linuxbrew/bin/&lt;some-npm-package&gt;</code></li>
</ul>

<p>As an example, let’s use <code class="language-plaintext highlighter-rouge">prettier</code> package.</p>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">prettier</code> binary (symlink) is available at <code class="language-plaintext highlighter-rouge">/usr/local/bin/prettier</code>.</li>
  <li>The actual binary is located at <code class="language-plaintext highlighter-rouge">/home/linuxbrew/.linuxbrew/bin/prettier</code>.</li>
</ol>

<p>If you run into issue w/ IDEA not picking up your <code class="language-plaintext highlighter-rouge">$PATH</code> variable contents (for <code class="language-plaintext highlighter-rouge">linuxbrew</code>) in
your File Watchers, you might need to add the following lines to your <code class="language-plaintext highlighter-rouge">~/.profile</code> file, so that
GNOME session can pick it up when your desktop session starts (vs when this is set in your
terminal/shell initialization script).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Set PATH so it includes linuxbrew for all child processes spawned by the Gnome shell.</span>
<span class="c"># - https://superuser.com/a/398881/1102870</span>
<span class="c"># - https://askubuntu.com/a/356973/872482</span>
<span class="c"># - https://help.ubuntu.com/community/EnvironmentVariables</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"/home/linuxbrew/.linuxbrew"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then
    </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/home/linuxbrew/.linuxbrew/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="k">fi</span>
</code></pre></div></div>
      <h2 id="nodejs-project-setup-using-idea">
        
        
          Node.js project setup using IDEA <a href="#nodejs-project-setup-using-idea">#</a>
        
        
      </h2>
    

<p>IDEA Ultimate / Webstorm project files are provided in <a href="https://github.com/nazmulidris/ts-scratch/tree/main/nodejs-beginner-course">this github repo</a>. You can clone
the repo and tell IDEA / Webstorm to open the sub-folder <code class="language-plaintext highlighter-rouge">nodejs-beginner-course</code> and not the top
level folder <code class="language-plaintext highlighter-rouge">ts-scratch</code>. You can open the project to try out the code that is shown in this
handbook.</p>

<p>These are the steps that I followed to create this project.</p>

<ol>
  <li>Use IDEA (Ultimate or Webstorm) create a new Node.js project.</li>
  <li>Use the <code class="language-plaintext highlighter-rouge">ts-node-dev</code> Node.js interpreter (not the default), which is located in
<code class="language-plaintext highlighter-rouge">/usr/local/bin/ts-node/dev</code> (via the symlink created in the previous section).</li>
  <li>In the <code class="language-plaintext highlighter-rouge">package.json</code> add the following dev dep (<code class="language-plaintext highlighter-rouge">npm i --save-dev @types/node@latest</code>). Other
dev deps will be added when you start importing various modules in your code.</li>
  <li>When creating a <code class="language-plaintext highlighter-rouge">.ts</code> file, in order to make it executable, you can do the following:</li>
  <li>Add <code class="language-plaintext highlighter-rouge">#!/usr/bin/env ts-node</code> to the top of the <code class="language-plaintext highlighter-rouge">.ts</code> file.</li>
  <li>Mark the file executable using <code class="language-plaintext highlighter-rouge">chmod +x *.ts</code>.</li>
  <li>Add a
<a href="https://github.com/nazmulidris/ts-scratch/blob/main/nodejs-beginner-course/tsconfig.json"><code class="language-plaintext highlighter-rouge">tsconfig.json</code></a>
file which enables strict mode, and dumps compiled output to a <code class="language-plaintext highlighter-rouge">build</code> folder. Also compile
TypeScript files located in the <code class="language-plaintext highlighter-rouge">src</code> folder and its sub-folders only.
    <pre><code class="language-json5">{
  exclude: ["node_modules"],
  include: ["./src/**/*"],
  compilerOptions: {
    strict: true,
    module: "CommonJS",
    target: "ES6",
    sourceMap: true,
    outDir: "build", // More info https://stackoverflow.com/a/49687441/2085356
  },
}
</code></pre>
  </li>
</ol>
      <h2 id="nodejs-threading-model">
        
        
          Node.js threading model <a href="#nodejs-threading-model">#</a>
        
        
      </h2>
    
      <h3 id="overview">
        
        
          Overview <a href="#overview">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/RMoNJwAKR2q">Course link</a>.</li>
  <li>This article describes how the
<a href="https://nodejs.org/en/docs/guides/dont-block-the-event-loop/">main thread and thread pool (worker pool) of <code class="language-plaintext highlighter-rouge">k</code> Worker threads</a>
works in Node.js.</li>
</ul>

<p>Node.js has two types of threads: one Event Loop and <code class="language-plaintext highlighter-rouge">k</code> Workers.</p>

<ol>
  <li>The Event Loop is responsible for JavaScript callbacks and non-blocking I/O, and</li>
  <li>a Worker (out of the pool of <code class="language-plaintext highlighter-rouge">k</code>) executes tasks corresponding to C++ code that completes an
asynchronous request, including blocking I/O and CPU-intensive work.</li>
</ol>

<p>Both types of threads work on no more than one activity at a time. If any callback or task takes a
long time, the thread running it becomes blocked. If your application makes blocking callbacks or
tasks, this can lead to degraded throughput (clients/second) at best, and complete denial of service
at worst.</p>

<p>To write a high-throughput, more DoS-proof web server, you must ensure that on benign and on
malicious input, neither your Event Loop nor your Workers will block.</p>
      <h3 id="event-loop">
        
        
          Event loop <a href="#event-loop">#</a>
        
        
      </h3>
    

<ul>
  <li>
    <p><a href="https://nodejs.org/en/docs/guides/dont-block-the-event-loop/">Node.js docs on event loop, workers, and best practices to avoid freezes</a></p>

    <ul>
      <li>
        <p>Best practices from doc above:</p>

        <ul>
          <li>Avoid “vulnerable” regex.</li>
          <li>Avoid synchronous versions of Node.js APIs for encryption, compression, file system, and child
process.</li>
          <li>Avoid using JSON parse and stringify for really large objects (these operations are very slow)
. Libraries <a href="#streaming-and-high-performance-json-apis">exist</a> to handle these performance
issues.</li>
          <li>
            <p>Avoid variable time complexity callbacks, try and keep them <code class="language-plaintext highlighter-rouge">O(n)</code>. Here are some strategies
to accomplish this.</p>

            <ol>
              <li><em>Partitioning</em>: You can use <code class="language-plaintext highlighter-rouge">setImmediate</code> and chunk the long operation into smaller
pieces.</li>
              <li><em>Offloading</em>: The only drawback here is that the main thread is in a different “namespace”
(JavaScript state of your application) than a worker thread, so you have to serialize &amp;
deserialize any objects that are passed between them. Also, you must also be careful about
understanding whether your long running operations are CPU intensive or IO intensive, since
they both have to be approached differently. However, if your app relies heavily on complex
calculations, you should think about whether Node.js is really a good fit. Node.js excels
for I/O-bound work, but for expensive computation it might not be the best option.</li>
            </ol>

            <ul>
              <li>You have <a href="#worker-threads-api-for-js-code"><strong>two choices</strong></a> to run CPU intensive JS code in
the thread pool without writing a C/C++ addon.</li>
              <li>You can create a C/C++ addon using <a href="https://nodejs.org/api/n-api.html">N-API</a>.</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><a href="https://youtu.be/P9csgxBgaZ8">Video on how the event loop works</a></p>
  </li>
</ul>
      <h3 id="worker-threads-api-for-js-code">
        
        
          Worker threads API for JS code <a href="#worker-threads-api-for-js-code">#</a>
        
        
      </h3>
    

<p>Without writing a <a href="#n-api-for-native-addons">C/C++ addon using N-API</a>, you can use either of the
following.</p>

<ul>
  <li>You can even use the <strong>new</strong>
<a href="https://nodejs.org/docs/latest/api/worker_threads.html"><code class="language-plaintext highlighter-rouge">Worker Threads</code> API in Node.js 15</a> to
run CPU intensive JS code in the thread pool without writing a C/C++ addon.</li>
  <li>You can use the new <a href="https://www.npmjs.com/package/webworker-threads">WebWorker Threads library</a>
to run the JS code in the thread pool without writing a C/C++ addon.</li>
</ul>
      <h3 id="streaming-and-high-performance-json-apis">
        
        
          Streaming and high performance JSON APIs <a href="#streaming-and-high-performance-json-apis">#</a>
        
        
      </h3>
    

<ul>
  <li>You can use <a href="https://www.npmjs.com/package/JSONStream">stream APIs</a> for JSON.</li>
  <li>Or you can use <a href="https://www.npmjs.com/package/bfj">async versions of JSON parsing APIs</a>.</li>
</ul>
      <h3 id="libuv-and-worker-threads">
        
        
          libuv and worker threads <a href="#libuv-and-worker-threads">#</a>
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">libuv</code> is a multiplatform C library for async IO based on event loops, which exposes a general task
submission API. Node.js uses the thread pool to handle “expensive” tasks.</p>

<p>This includes I/O for which an OS does not provide a non-blocking version
(<a href="https://tinyurl.com/orjpz3t">DNS</a>, and <a href="https://tinyurl.com/yz87vob9">file system</a>), as well as
particularly CPU-intensive tasks (<a href="https://tinyurl.com/ye5kqjny">Zlib</a> and
<a href="https://tinyurl.com/n3moqwk">Crypto</a>).</p>

<p>User defined <a href="https://nodejs.org/api/addons.html">C/C++ addons</a> can also be run in this thread pool.
However you should write these addons using the <a href="#n-api-for-native-addons"><code class="language-plaintext highlighter-rouge">N-API</code></a>.</p>

<p>You have <a href="#worker-threads-api-for-js-code">two choices</a> to run CPU intensive JS code in the thread
pool without writing a C/C++ addon.</p>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Libuv">Wikipedia</a></li>
  <li><a href="http://docs.libuv.org/en/v1.x/">Library website</a></li>
  <li><a href="http://docs.libuv.org/en/v1.x/design.html">Design docs</a></li>
  <li><a href="http://docs.libuv.org/en/v1.x/threadpool.html">Threadpool API</a></li>
  <li><a href="https://blog.insiderattack.net/javascript-event-loop-vs-node-js-event-loop-aea2b1b85f5c">Differences w/ browser which uses <code class="language-plaintext highlighter-rouge">libevent</code></a></li>
</ul>
      <h3 id="n-api-for-native-addons">
        
        
          N-API for native addons <a href="#n-api-for-native-addons">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="https://youtu.be/-Oniup60Afs">Video</a></li>
  <li><a href="https://github.com/nodejs/node-addon-api">GitHub repo</a></li>
  <li><a href="https://nodejs.medium.com/building-modern-native-add-ons-for-node-js-in-2020-cd3992c68e0">Tutorial on building Node.js native addons in 2020</a></li>
  <li><a href="https://tinyurl.com/yecfnkf9">Tutorial on using the N-API to create an addon in C/C++</a></li>
</ul>
      <h3 id="kotlin-native-and-c-interop">
        
        
          Kotlin Native and C interop <a href="#kotlin-native-and-c-interop">#</a>
        
        
      </h3>
    

<ul>
  <li><strong>Hypothesis</strong> - It may be possible to use Kotlin Native to generate C interoperable code in order
to write some native addons for Node.js.</li>
  <li><a href="https://kotlinlang.org/docs/native-c-interop.html#basic-interop-types">KT and C interop</a></li>
  <li><a href="https://github.com/datkt/node-addon-example">Random repo I found on github that claims to do this</a></li>
</ul>
      <h2 id="message-queue-and-es6-job-queue">
        
        
          Message Queue and ES6 Job Queue <a href="#message-queue-and-es6-job-queue">#</a>
        
        
      </h2>
    
      <h3 id="message-queue-and-settimeout-setimmediate---execute-at-next-tick">
        
        
          Message Queue and setTimeout(), setImmediate() - execute at next tick <a href="#message-queue-and-settimeout-setimmediate---execute-at-next-tick">#</a>
        
        
      </h3>
    

<p>Read the official Node.js docs about
<a href="https://nodejs.dev/learn/the-nodejs-event-loop#the-message-queue:~:text=The%20Message%20Queue,-When">event loop and message queue</a>.</p>

<p>When <code class="language-plaintext highlighter-rouge">setTimeout(()=&gt;{}, 0)</code> is called, the Browser or Node.js starts the timer. Once the timer
expires, in this case immediately as we put <code class="language-plaintext highlighter-rouge">0</code> as the timeout, the callback function is put in the
<strong>Message Queue</strong>.</p>

<ul>
  <li>The Message Queue is also where user-initiated events like click or keyboard events, or fetch
responses are queued before your code has the opportunity to react to them. Or also DOM events
like <code class="language-plaintext highlighter-rouge">onLoad</code>.</li>
  <li>The loop gives priority to the call stack, and it first processes everything it finds in the call
stack, and once there’s nothing in there, it goes to pick up things in the message queue.</li>
  <li>We don’t have to wait for functions like <code class="language-plaintext highlighter-rouge">setTimeout</code>, <code class="language-plaintext highlighter-rouge">fetch</code> or other things to do their own
work, because they are provided by the browser, and they live on their own threads. For example,
if you set the <code class="language-plaintext highlighter-rouge">setTimeout</code> timeout to 2 seconds, you don’t have to wait 2 seconds - the wait
happens elsewhere (in the worker thread pool).</li>
</ul>

<p>A <code class="language-plaintext highlighter-rouge">setTimeout()</code> callback with a <code class="language-plaintext highlighter-rouge">0ms</code> delay is very similar to <code class="language-plaintext highlighter-rouge">setImmediate()</code>. The execution
order will depend on various factors, but they will be both run in the next iteration of the event
loop.</p>
      <h3 id="processnexttick---execute-at-the-end-of-this-tick">
        
        
          process.nextTick() - execute at the end of this tick <a href="#processnexttick---execute-at-the-end-of-this-tick">#</a>
        
        
      </h3>
    

<p>Read the official Node.js docs about
<a href="https://nodejs.dev/learn/understanding-process-nexttick#link-nodejs-with-typescript:~:text=When%20we%20pass%20a%20function%20to,the%20next%20event%20loop%20tick%20starts%3A">process.nextTick()</a>.</p>

<p>Every time the event loop takes a full trip, we call it a <code class="language-plaintext highlighter-rouge">tick</code>. When we pass a function to
<code class="language-plaintext highlighter-rouge">process.nextTick()</code>, we instruct the engine to invoke this function at the end of the current
operation, before the next event loop tick starts. Here’s an example.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">process</span><span class="p">.</span><span class="nf">nextTick</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="cm">/* Do something. */</span>
<span class="p">})</span>
</code></pre></div></div>

<ul>
  <li>The event loop is busy processing the current function code.</li>
  <li>When this operation ends, the JS engine runs all the functions passed to <code class="language-plaintext highlighter-rouge">nextTick</code> calls during
that operation.</li>
  <li>It’s the way we can tell the JS engine to process a function asynchronously (after the current
function), but as soon as possible, not queue it. Calling <code class="language-plaintext highlighter-rouge">setTimeout(() =&gt; {}, 0)</code> will execute
the function at the end of next tick, <strong>much later</strong> than when using <code class="language-plaintext highlighter-rouge">nextTick()</code> which
prioritizes the call and executes it just <strong>before</strong> the beginning of the next tick.</li>
</ul>

<p>Use <code class="language-plaintext highlighter-rouge">nextTick()</code> when you want to make sure that in the next event loop iteration that code is
already executed.</p>
      <h3 id="es6-job-queue-for-promises">
        
        
          ES6 Job Queue (for Promises) <a href="#es6-job-queue-for-promises">#</a>
        
        
      </h3>
    

<p>Read the official Node.js docs about the
<a href="https://nodejs.dev/learn/the-nodejs-event-loop#es6-job-queue:~:text=ES6%20Job%20Queue">ES6 job queue</a>.</p>

<p>ECMAScript 2015 introduced the concept of the Job Queue, which is used by Promises (also introduced
in ES6/ES2015). It’s a way to execute the result of an async function as soon as possible, rather
than being put at the end of the call stack.</p>

<p>Promises that resolve before the current function ends will be executed right after the current
function.</p>

<p>Using the analogy of a roller coaster ride at an amusement park:</p>

<ul>
  <li>The <strong>message queue</strong> puts you at the back of the queue, behind all the other people, where you
will have to wait for your turn.</li>
  <li>The <strong>job queue</strong> is the “fast pass” ticket that lets you take another ride right after you
finished the previous one.</li>
</ul>

<p>Here’s an example.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">bar</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">baz</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">baz</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span><span class="p">)</span>
  <span class="nf">setTimeout</span><span class="p">(</span><span class="nx">bar</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">resolve</span><span class="p">(</span><span class="dl">"</span><span class="s2">should be right after baz, before bar</span><span class="dl">"</span><span class="p">)).</span><span class="nf">then</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">resolve</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="nf">baz</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">foo</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/call-stack-third-example.svg" alt="Call stack for the code above" /></p>

<p>Here’s
<a href="https://github.com/nodejs/nodejs.dev/blob/main/src/documentation/0029-node-event-loop/index.md">more info from nodejs.dev</a>
on this.</p>
      <h2 id="typescript-and-javascript-language">
        
        
          TypeScript and JavaScript language <a href="#typescript-and-javascript-language">#</a>
        
        
      </h2>
    
      <h3 id="promises-async-await">
        
        
          Promises, async, await <a href="#promises-async-await">#</a>
        
        
      </h3>
    

<p>It is relatively simple to reason about using promises, as a way to eliminate callback hell. It is
also relatively simple to
<a href="https://nodejs.dev/learn/understanding-javascript-promises#creating-a-promise:~:text=A%20more%20common%20example%20you%20may,and%20have%20it%20return%20a%20promise%3A">“promisify”</a>
existing callback based APIs.</p>

<blockquote>
  <p>Here are some good reference links.</p>

  <ul>
    <li><a href="https://nodejs.dev/learn/understanding-javascript-promises">Official Node.js docs on Promises</a></li>
    <li><a href="https://stackoverflow.com/a/42118995/2085356">SO thread about when a Promise actually executes</a></li>
    <li><a href="https://nodejs.dev/learn/modern-asynchronous-javascript-with-async-and-await">Top level await in Node.js</a></li>
    <li><a href="https://262.ecma-international.org/6.0/#sec-promise-executor">ECMA promise (executor) official specs</a></li>
  </ul>
</blockquote>

<p>However, on the other side of the coin, when returning a promise, how does it all work? When does
the promise execute? Here’s an example to illustrate this.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/usr/bin/env ts-node
</span>
<span class="kd">type</span> <span class="nx">ResolveFnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
<span class="kd">type</span> <span class="nx">RejectFnType</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reason</span><span class="p">?:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
<span class="kd">type</span> <span class="nx">ExecutorFnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">resolveFn</span><span class="p">:</span> <span class="nx">ResolveFnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">?:</span> <span class="nx">RejectFnType</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>

<span class="c1">// Can also write this as a named function.</span>
<span class="c1">// function myExecutorFn(resolveFn: ResolveFnType&lt;string&gt;) {</span>
<span class="kd">const</span> <span class="nx">myExecutorFn</span><span class="p">:</span> <span class="nx">ExecutorFnType</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">resolveFn</span><span class="p">:</span> <span class="nx">ResolveFnType</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">resolveFn</span><span class="p">(</span><span class="dl">"</span><span class="s2">hello world!</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">createMyPromise</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">promise</span><span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">myExecutorFn</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">promise</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">promise</span><span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nf">createMyPromise</span><span class="p">()</span>
  <span class="nx">promise</span><span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<p>After running this code in the debugger w/ breakpoints set on every line in <code class="language-plaintext highlighter-rouge">createMyPromise()</code> we
learn:</p>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">Promise</code> takes an <code class="language-plaintext highlighter-rouge">executor</code>, which is the function that actually does the work of resolving
or rejecting the promise. In this case, <code class="language-plaintext highlighter-rouge">myExecutorFn()</code>.</li>
  <li>This <code class="language-plaintext highlighter-rouge">executor</code> is run at the moment at which the <code class="language-plaintext highlighter-rouge">Promise</code> is instantiated using <code class="language-plaintext highlighter-rouge">new</code>. In this
simple example, once <code class="language-plaintext highlighter-rouge">new Promise(myExecutorFn)</code> is called, it then calls the <code class="language-plaintext highlighter-rouge">myExecutorFn</code>
function before returning a <code class="language-plaintext highlighter-rouge">promise</code> object.</li>
</ol>

<p>Here’s a more sophisticated example w/ timings and even using <code class="language-plaintext highlighter-rouge">await</code>.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/usr/bin/env ts-node
</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">chalk</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">chalk</span><span class="dl">"</span>

<span class="kd">type</span> <span class="nx">ResolveFnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
<span class="kd">type</span> <span class="nx">RejectFnType</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reason</span><span class="p">?:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
<span class="kd">type</span> <span class="nx">ExecutorFnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">resolveFn</span><span class="p">:</span> <span class="nx">ResolveFnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">?:</span> <span class="nx">RejectFnType</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>

<span class="c1">// https://nodejs.org/api/process.html#process_process_hrtime_time</span>
<span class="kd">let</span> <span class="nx">startTime</span><span class="p">:</span> <span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="kr">number</span><span class="p">]</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nf">hrtime</span><span class="p">()</span>

<span class="kd">function</span> <span class="nf">timeDiffMs</span><span class="p">():</span> <span class="kr">number</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">NS_PER_MS</span> <span class="o">=</span> <span class="mi">1</span><span class="nx">e6</span>
  <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nf">hrtime</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nx">NS_PER_MS</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">handleImmediateExecutionPromise</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Can also write this as a named function.</span>
  <span class="c1">// function myExecutorFn(resolveFn: ResolveFnType&lt;string&gt;) {</span>
  <span class="kd">const</span> <span class="nx">myExecutorFn</span><span class="p">:</span> <span class="nx">ExecutorFnType</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">resolveFn</span><span class="p">:</span> <span class="nx">ResolveFnType</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">resolveFn</span><span class="p">(</span><span class="dl">"</span><span class="s2">hello world!</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">myExecutorFn</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">red</span><span class="p">(</span><span class="s2">`immediate: </span><span class="p">${</span><span class="nx">value</span><span class="p">}</span><span class="s2">, actual delay </span><span class="p">${</span><span class="nf">timeDiffMs</span><span class="p">()}</span><span class="s2"> ms`</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">handleDeferredExecutionPromise</span><span class="p">(</span><span class="nx">delayMs</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">myExecutorFn</span><span class="p">:</span> <span class="nx">ExecutorFnType</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">resolveFn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">resolveFn</span><span class="p">(</span><span class="s2">`hello world! after </span><span class="p">${</span><span class="nx">delayMs</span><span class="p">}</span><span class="s2"> ms`</span><span class="p">)</span>
    <span class="p">},</span> <span class="nx">delayMs</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">myExecutorFn</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">green</span><span class="p">(</span><span class="s2">`using then(): </span><span class="p">${</span><span class="nx">value</span><span class="p">}</span><span class="s2">, actual delay </span><span class="p">${</span><span class="nf">timeDiffMs</span><span class="p">()}</span><span class="s2"> ms`</span><span class="p">))</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">handleDeferredExecutionPromiseWithAwait</span><span class="p">(</span><span class="nx">delayMs</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">myExecutorFn</span><span class="p">:</span> <span class="nx">ExecutorFnType</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">resolveFn</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nf">resolveFn</span><span class="p">(</span><span class="s2">`hello world! after </span><span class="p">${</span><span class="nx">delayMs</span><span class="p">}</span><span class="s2"> ms`</span><span class="p">),</span> <span class="nx">delayMs</span><span class="p">)</span>

  <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">(</span><span class="nx">myExecutorFn</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">blue</span><span class="p">(</span><span class="s2">`using await: </span><span class="p">${</span><span class="nx">value</span><span class="p">}</span><span class="s2">, actual delay </span><span class="p">${</span><span class="nf">timeDiffMs</span><span class="p">()}</span><span class="s2"> ms`</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">startTime</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nf">hrtime</span><span class="p">()</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Set startTime: </span><span class="p">${</span><span class="nx">startTime</span><span class="p">}</span><span class="s2">, actual delay calculated from this timestamp`</span><span class="p">)</span>

  <span class="nf">handleImmediateExecutionPromise</span><span class="p">()</span>
  <span class="nf">handleDeferredExecutionPromise</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">yellow</span><span class="p">(</span><span class="dl">"</span><span class="s2">before await!</span><span class="dl">"</span><span class="p">))</span>
  <span class="k">await</span> <span class="nf">handleDeferredExecutionPromiseWithAwait</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">yellow</span><span class="p">(</span><span class="dl">"</span><span class="s2">end!</span><span class="dl">"</span><span class="p">))</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>

<p>Here’s another example of using top level <code class="language-plaintext highlighter-rouge">await</code> in a Node.js program, while mixing and matching
the use of <code class="language-plaintext highlighter-rouge">async</code>, <code class="language-plaintext highlighter-rouge">await</code>, and promises.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ChildProcess</span><span class="p">,</span> <span class="nx">spawn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorConsole</span><span class="p">,</span> <span class="nx">StyledColorConsole</span><span class="p">,</span> <span class="nx">Styles</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="kd">class</span> <span class="nc">SpawnCProcToRunLinuxCommandAndGetOutput</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">find</span><span class="dl">"</span>
  <span class="k">readonly</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="dl">"</span><span class="s2">-type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">f</span><span class="dl">"</span><span class="p">]</span>

  <span class="nx">run</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">child</span><span class="p">:</span> <span class="nx">ChildProcess</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cmd</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">args</span><span class="p">)</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">resolveFn</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">child</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">exit</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">signal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Child process exited with code </span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2"> and signal </span><span class="p">${</span><span class="nx">signal</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
        <span class="nf">resolveFn</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">stdout</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="nx">Buffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Output : </span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="p">})</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">stderr</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nf">rejectFn</span><span class="p">()</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Error: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">start!</span><span class="dl">"</span><span class="p">)</span>
  <span class="k">await</span> <span class="k">new</span> <span class="nc">SpawnCProcToRunLinuxCommandAndGetOutput</span><span class="p">().</span><span class="nf">run</span><span class="p">()</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">done!</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
</code></pre></div></div>

<p>Notes on the code above:</p>

<ul>
  <li>The call to <code class="language-plaintext highlighter-rouge">main()</code> at the very bottom of the snippet actually calls an function that returns a
<code class="language-plaintext highlighter-rouge">Promise</code>. The <code class="language-plaintext highlighter-rouge">catch()</code> section actually handles any top level exceptions that are thrown.</li>
  <li>In the <code class="language-plaintext highlighter-rouge">main()</code>, which is an <code class="language-plaintext highlighter-rouge">async</code> function, which returns a <code class="language-plaintext highlighter-rouge">Promise</code>, <code class="language-plaintext highlighter-rouge">await</code> is used to wait
for the call to <code class="language-plaintext highlighter-rouge">run()</code> to actually complete. This is where promises and <code class="language-plaintext highlighter-rouge">async</code> / <code class="language-plaintext highlighter-rouge">await</code> are
used together.</li>
  <li>In <code class="language-plaintext highlighter-rouge">run()</code> a <code class="language-plaintext highlighter-rouge">Promise</code> is created (which is returned by this method) which actually is fulfilled
when the child process actually completes, or is rejected when it encounters an error.</li>
</ul>
      <h3 id="use-stricttrue-in-tsconfigjson-options">
        
        
          Use strict=true in tsconfig.json options <a href="#use-stricttrue-in-tsconfigjson-options">#</a>
        
        
      </h3>
    

<p>Always set <a href="https://www.typescriptlang.org/tsconfig#strict"><code class="language-plaintext highlighter-rouge">"strict"=true</code></a> in your
<code class="language-plaintext highlighter-rouge">tsconfig.json</code>.</p>
      <h3 id="use-unknown-over-any">
        
        
          Use unknown over any <a href="#use-unknown-over-any">#</a>
        
        
      </h3>
    

<p>Because it does not propagate:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">foo1</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">a</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">bar</span> <span class="c1">// no error</span>
  <span class="kd">const</span> <span class="nx">b</span><span class="p">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="nx">bar</span> <span class="c1">// no error</span>
  <span class="kd">const</span> <span class="nx">c</span><span class="p">:</span> <span class="p">{</span> <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">bar</span> <span class="c1">// no error</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">foo2</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">a</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">bar</span> <span class="c1">// 🔴 Type 'unknown' is not assignable to type 'string'.(2322)</span>
  <span class="kd">const</span> <span class="nx">b</span><span class="p">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="nx">bar</span> <span class="c1">// 🔴 Type 'unknown' is not assignable to type 'number'.(2322)</span>
  <span class="kd">const</span> <span class="nx">c</span><span class="p">:</span> <span class="p">{</span> <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">bar</span> <span class="c1">// 🔴 Type 'unknown' is not assignable to type '{ name: string; }'.(2322)</span>
<span class="p">}</span>
</code></pre></div></div>
      <h3 id="user-defined-type-guards">
        
        
          User defined type guards <a href="#user-defined-type-guards">#</a>
        
        
      </h3>
    

<p>A guard is not a type, but a mechanism that narrows types.</p>

<p>Here are some examples of built-in type guards.</p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">typeof</code> guard - This only works for JS primitive types that are checked at runtime (string,
number, undefined, null, Boolean, and Symbol). It does not work for interfaces because that
information is erased at runtime.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Properties</span> <span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nf">setWidth</span><span class="p">(</span><span class="nx">width</span><span class="p">:</span> <span class="kr">number</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">width</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">width</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">instanceof</code> guard - This works with classes, but not interfaces. Type information for classes is
retained at runtime by JS, but not interfaces.</p>

    <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="k">public</span> <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">greet</span><span class="p">(</span><span class="nx">obj</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">obj</span> <span class="k">instanceof</span> <span class="nx">Person</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>A custom type guard is a Boolean-returning function that can additionally assert something about
the type of its parameter. You can create user defined type guards to test if an object has the
shape of an interface.</p>
  </li>
</ol>

<ul>
  <li><a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#using-type-predicates">Docs</a></li>
  <li><a href="https://www.educative.io/courses/advanced-typescript-masterclass/g77AxgkEQG3#overview">Course</a></li>
</ul>

<p>The following code does <strong>not work</strong>.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Article</span> <span class="p">{</span>
  <span class="nl">title</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">body</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">title</span> <span class="c1">// 🔴 Error!</span>
  <span class="kd">const</span> <span class="nx">body</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">body</span> <span class="c1">// 🔴 Error!</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">doSomething</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
<span class="nf">doSomething</span><span class="p">({</span> <span class="na">foo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<p><strong>First</strong> try at using user defined type guards. It doesn’t narrow automatically!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Article</span> <span class="p">{</span>
  <span class="nl">title</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">body</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">isArticle</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">myParam</span> <span class="o">=</span> <span class="nx">param</span> <span class="k">as</span> <span class="nx">Article</span>
  <span class="c1">// 👍 One way of writing this without using string literals.</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">myParam</span><span class="p">.</span><span class="nx">title</span> <span class="o">!=</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">myParam</span><span class="p">.</span><span class="nx">body</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The following works too.</span>
    <span class="c1">// if ("title" in myParam &amp;&amp; "body" in myParam) {</span>
    <span class="k">return</span> <span class="kc">true</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nf">isArticle</span><span class="p">(</span><span class="nx">bar</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// 👎 You have to cast bar to Article as it does not narrow automatically.</span>
    <span class="kd">const</span> <span class="nx">article</span> <span class="o">=</span> <span class="nx">bar</span> <span class="k">as</span> <span class="nx">Article</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Article interface type: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">article</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">article</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">unknown type</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bar</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">doSomething</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
<span class="nf">doSomething</span><span class="p">({</span> <span class="na">foo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<p><strong>Second</strong> try at writing this. Have to use string literals for the properties!</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Article</span> <span class="p">{</span>
  <span class="nl">title</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">body</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">isArticle</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">param</span> <span class="k">is</span> <span class="nx">Article</span> <span class="p">{</span>
  <span class="c1">// 👎 You lose the ability to autocomplete title and body (as shown above), string literals are</span>
  <span class="c1">// needed, which could be a problem with keeping things in sync.</span>
  <span class="k">return</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span> <span class="k">in</span> <span class="nx">param</span> <span class="o">&amp;&amp;</span> <span class="dl">"</span><span class="s2">body</span><span class="dl">"</span> <span class="k">in</span> <span class="nx">param</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nf">isArticle</span><span class="p">(</span><span class="nx">bar</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// 👍 You don't have to cast bar to Article! It is automatically narrowed!</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Article interface type: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">unknown type</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bar</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">doSomething</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
<span class="nf">doSomething</span><span class="p">({</span> <span class="na">foo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<p><strong>Third</strong> and best try, which solves both problems with previous tries.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Article</span> <span class="p">{</span>
  <span class="nl">title</span><span class="p">:</span> <span class="kr">string</span>
  <span class="nx">body</span><span class="p">:</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">isArticle</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">param</span> <span class="k">is</span> <span class="nx">Article</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">myParam</span> <span class="o">=</span> <span class="nx">param</span> <span class="k">as</span> <span class="nx">Article</span>
  <span class="k">return </span><span class="p">(</span>
    <span class="nx">myParam</span><span class="p">.</span><span class="nx">title</span> <span class="o">!=</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span>
    <span class="nx">myParam</span><span class="p">.</span><span class="nx">body</span> <span class="o">!=</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span>
    <span class="k">typeof</span> <span class="nx">myParam</span><span class="p">.</span><span class="nx">title</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
    <span class="k">typeof</span> <span class="nx">myParam</span><span class="p">.</span><span class="nx">body</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">doSomething</span><span class="p">(</span><span class="nx">bar</span><span class="p">:</span> <span class="nx">unknown</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nf">isArticle</span><span class="p">(</span><span class="nx">bar</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Article interface type: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">unknown type</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bar</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">doSomething</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
<span class="nf">doSomething</span><span class="p">({</span> <span class="na">foo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">t</span><span class="dl">"</span><span class="p">,</span> <span class="na">bar</span><span class="p">:</span> <span class="dl">"</span><span class="s2">b</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>
      <h3 id="never-bottom-type">
        
        
          never “bottom” type <a href="#never-bottom-type">#</a>
        
        
      </h3>
    

<ol>
  <li><code class="language-plaintext highlighter-rouge">never</code> is a bottom type (which is <code class="language-plaintext highlighter-rouge">Nothing</code> in Kotlin).</li>
  <li>The opposite of “top” type like <code class="language-plaintext highlighter-rouge">Object</code> in Java, and <code class="language-plaintext highlighter-rouge">any</code> in TypeScript or Kotlin.</li>
</ol>

<p>Here’s an example.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// WTF?! param is never and this code is unreachable!</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Another example.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* @throws(Error) */</span>
<span class="kd">function</span> <span class="nf">getContentFromRoute</span><span class="p">(</span><span class="nx">parsedUrl</span><span class="p">:</span> <span class="nx">ParsedUrl</span><span class="p">,</span> <span class="nx">routes</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Route</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">Content</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">matchingRoute</span><span class="p">:</span> <span class="nx">Optional</span><span class="o">&lt;</span><span class="nx">Route</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">routes</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">it</span><span class="p">:</span> <span class="nx">Route</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">it</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">===</span> <span class="nx">parsedUrl</span><span class="p">.</span><span class="nx">pathname</span>
  <span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">bam! 🎇 🧯 🚒 💣</span><span class="dl">"</span><span class="p">)</span>

  <span class="c1">// This line is unreachable.</span>
  <span class="k">return</span> <span class="nx">matchingRoute</span><span class="p">?.</span><span class="nf">generateContentFn</span><span class="p">(</span><span class="nx">parsedUrl</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span> <span class="o">??</span> <span class="k">this</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">no route found</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">error</span><span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">never</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
      <h3 id="typescript-jsdocs">
        
        
          TypeScript JSDocs <a href="#typescript-jsdocs">#</a>
        
        
      </h3>
    

<p>Here’s more information on
<a href="https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html">TypeScript specific JSDocs</a>.</p>

<p>Here are some examples.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @param contextObject value of `it`
 * @param block lambda that accepts `it`
 * @return contextObject return the contextObject that is passed
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">_also</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">block</span><span class="p">:</span> <span class="nx">Receiver</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">T</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">block</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">contextObject</span>
<span class="p">}</span>

<span class="cm">/**
 * @param contextObject value of `this`
 * @param lambda lambda that accepts `this`
 * @return contextObject return the result of the lambda
 */</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nf">_with</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">lambda</span><span class="p">:</span> <span class="nx">ImplicitReceiverWithReturn</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">R</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">R</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">lambda</span><span class="p">.</span><span class="nx">blockWithReboundThis</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
      <h3 id="this-keyword-and-kotlin-scoping-functions">
        
        
          this keyword and Kotlin scoping functions <a href="#this-keyword-and-kotlin-scoping-functions">#</a>
        
        
      </h3>
    

<p>To understand advanced things about TypeScript, I decided to write the
<a href="https://kotlinlang.org/docs/scope-functions.html#function-selection">Kotlin scoping functions</a>
(with, apply, let, run, etc) in TypeScript.</p>

<ul>
  <li><a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/main/src/kotlin-lang-utils.ts">Sample code - Kotlin Scoping Functions</a></li>
  <li><a href="https://github.com/r3bl-org/r3bl-ts-utils/tree/main/src/__tests">Sample code - Test for above</a></li>
</ul>

<p>Here are some references:</p>

<ul>
  <li><a href="https://developerlife.com/2020/04/05/kotlin-dsl-intro/#context-and-rebinding-this">Kotlin context and <code class="language-plaintext highlighter-rouge">this</code> rebinding</a></li>
  <li><a href="https://www.typescriptlang.org/docs/handbook/functions.html#this-parameters">TypeScript handling <code class="language-plaintext highlighter-rouge">this</code> parameters</a></li>
  <li><a href="https://www.typescriptlang.org/docs/handbook/utility-types.html#thistypetype">TypeScript utility types for <code class="language-plaintext highlighter-rouge">this</code></a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call">JavaScript <code class="language-plaintext highlighter-rouge">bind</code></a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">JavaScript <code class="language-plaintext highlighter-rouge">call</code></a></li>
</ul>

<p>It is more complicated to handle “implicit” <code class="language-plaintext highlighter-rouge">this</code> scenario, since in TypeScript, there is no such
thing. So we use <code class="language-plaintext highlighter-rouge">this</code> explicitly but even so, in a given lambda rebinding <code class="language-plaintext highlighter-rouge">this</code> poses a
challenge. This is why I created an interface that describes the shape of an object which has a
function. And for this object, <code class="language-plaintext highlighter-rouge">this</code> can be bound to the <code class="language-plaintext highlighter-rouge">contextObject</code>. The <code class="language-plaintext highlighter-rouge">this</code> keyword then
works inside this object that is passed to <code class="language-plaintext highlighter-rouge">_with</code> and <code class="language-plaintext highlighter-rouge">_apply</code> shown below.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">ImplicitReceiver</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="na">blockWithReboundThis</span><span class="p">:</span> <span class="p">(</span><span class="na">this</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">ImplicitReceiverWithReturn</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">R</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="na">blockWithReboundThis</span><span class="p">:</span> <span class="p">(</span><span class="na">this</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">R</span>
<span class="p">}</span>

<span class="cm">/**
 * @param contextObject value of `this`
 * @param lambda lambda that accepts `this`
 * @return contextObject return the contextObject that is passed
 */</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nf">_apply</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">lambda</span><span class="p">:</span> <span class="nx">ImplicitReceiver</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">T</span> <span class="p">{</span>
  <span class="nx">lambda</span><span class="p">.</span><span class="nx">blockWithReboundThis</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">contextObject</span>
<span class="p">}</span>

<span class="cm">/**
 * @param contextObject value of `this`
 * @param lambda lambda that accepts `this`
 * @return contextObject return the result of the lambda
 */</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nf">_with</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">R</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">lambda</span><span class="p">:</span> <span class="nx">ImplicitReceiverWithReturn</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">R</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">R</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">lambda</span><span class="p">.</span><span class="nx">blockWithReboundThis</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="nx">contextObject</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
      <h3 id="callable-interfaces-and-implementations-in-typescript">
        
        
          Callable interfaces and implementations in TypeScript <a href="#callable-interfaces-and-implementations-in-typescript">#</a>
        
        
      </h3>
    

<p>More info:</p>

<ul>
  <li><a href="https://basarat.gitbook.io/typescript/type-system/callable">Callable interface</a></li>
  <li><a href="https://stackoverflow.com/questions/12769636/how-to-make-a-class-implement-a-call-signature-in-typescript">Implementing Callable interface in TypeScript</a></li>
  <li><a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/main/src/color-console-utils.ts">Sample code - ColorConsole class and ColorConsoleIF interface in utils</a></li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">CallableIF</span> <span class="p">{</span>
  <span class="p">(</span><span class="nx">text</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">myCallableFn</span><span class="p">:</span> <span class="nx">CallableIF</span> <span class="o">=</span> <span class="p">(</span><span class="nx">text</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">hello</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">text</span>

<span class="kd">class</span> <span class="nc">MyCallableClass</span> <span class="p">{</span>
  <span class="c1">// This is the method that actually ends up getting called.</span>
  <span class="nf">call</span><span class="p">(</span><span class="nx">text</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">hello</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">foo</span>
  <span class="p">}</span>

  <span class="c1">// Factory method is actually what implements the callable interface.</span>
  <span class="k">static</span> <span class="nf">create</span><span class="p">():</span> <span class="nx">CallableIF</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyClass</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">assign</span><span class="p">((</span><span class="nx">text</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">instance</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">text</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">myObj</span> <span class="o">=</span> <span class="nx">MyCallableClass</span><span class="p">.</span><span class="nf">create</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nf">myObj</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo</span><span class="dl">"</span><span class="p">))</span>
</code></pre></div></div>
      <h2 id="testing-with-jest">
        
        
          Testing with Jest <a href="#testing-with-jest">#</a>
        
        
      </h2>
    

<p>Use Jest framework (made by Facebook). It is not tied to React development.</p>

<ul>
  <li><a href="https://github.com/kulshekhar/ts-jest">ts-jest</a></li>
  <li><a href="https://jestjs.io/">jest</a></li>
  <li><a href="https://jestjs.io/docs/getting-started">Getting started w/ Node.js and jest</a></li>
</ul>

<ol>
  <li>Jest itself is built on top of Jasmine. Jest is fast, when compared to Karma (which is a test
runner that uses a real browser and has to be paired w/ something like Jasmine for the actual
test running).</li>
  <li>Jest does not use a real DOM (it uses <code class="language-plaintext highlighter-rouge">js-dom</code>) which makes it much faster compared to Karma.</li>
  <li>Given the speed of Jest, the huge developer adoption and support it has, along with its
multiplatform testing capabilities (Vanilla JS, Node.js, React), and it works w/ React (via
<code class="language-plaintext highlighter-rouge">ts-jest</code>), it is the testing platform of choice.</li>
</ol>
      <h3 id="setting-up-jest-and-typescript">
        
        
          Setting up Jest and TypeScript <a href="#setting-up-jest-and-typescript">#</a>
        
        
      </h3>
    

<p>It is a little complicated to set this up for TypeScript. The following instructions on the
<a href="https://jestjs.io/docs/getting-started#using-typescript">Jest getting started with TypeScript</a> are
not complete.</p>
      <h4 id="step-1---install-jest-and-types">
        
        
          Step 1 - Install Jest and types <a href="#step-1---install-jest-and-types">#</a>
        
        
      </h4>
    

<p>Run the following to get Jest and its TypeScript bindings installed, along with <code class="language-plaintext highlighter-rouge">ts-test</code> which is a
plugin that allows Jest to work directly w/ TypeScript files.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i <span class="nt">-D</span> jest ts-jest @types/jest
</code></pre></div></div>
      <h4 id="step-2---create-a-new-jestconfigts-file">
        
        
          Step 2 - Create a new jest.config.ts file <a href="#step-2---create-a-new-jestconfigts-file">#</a>
        
        
      </h4>
    

<p>This is a very important step, since this <code class="language-plaintext highlighter-rouge">jest.config.ts</code> file (which can’t be a <code class="language-plaintext highlighter-rouge">.js</code> file) will
tell Jest how to “deal” with TypeScript files. Once this is configured, everything else (running
tests from the command line using <code class="language-plaintext highlighter-rouge">jest</code> or IDEA “just work”). Remember that you won’t actually run
<code class="language-plaintext highlighter-rouge">js-test</code> but use <code class="language-plaintext highlighter-rouge">jest</code> instead; <code class="language-plaintext highlighter-rouge">js-test</code> is just a plugin for <code class="language-plaintext highlighter-rouge">jest</code> which has be configured
correctly.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">preset</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ts-jest</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// Tell Jest to use `ts-jest` plugin.</span>
  <span class="na">testEnvironment</span><span class="p">:</span> <span class="dl">"</span><span class="s2">node</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// Execution environment (can't be `ts-node`).</span>
  <span class="na">testMatch</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">&lt;rootDir&gt;/**/*.test.ts</span><span class="dl">"</span><span class="p">],</span> <span class="c1">// Test files must end in `*.test.ts`.</span>
  <span class="na">testPathIgnorePatterns</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">/node_modules/</span><span class="dl">"</span><span class="p">],</span> <span class="c1">// Don't search for tests inside `node_modules`.</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For information on what each of these keys mean, check out
<a href="https://jestjs.io/docs/configuration#testmatch-arraystring">Configuring Jest</a>.</p>
      <h4 id="step-3---create-test-files">
        
        
          Step 3 - Create test files <a href="#step-3---create-test-files">#</a>
        
        
      </h4>
    

<p>Finally, you can create a <code class="language-plaintext highlighter-rouge">.test.ts</code> file. And then IDEA should be able to run it. Here’s an
example.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">my test suite</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">a spec with an expectation</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nf">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nf">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">another spec with a different expectation</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">expect</span><span class="p">(</span><span class="kc">false</span><span class="p">).</span><span class="nf">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div>

<p>To learn how to write tests using Jasmine, check out these links.</p>

<ul>
  <li><a href="https://jasmine.github.io/2.1/introduction">Jasmine Manual - writing tests using describe, it, spyOn, etc</a></li>
  <li><a href="https://howtodoinjava.com/javascript/jasmine-unit-testing-tutorial/">Jasmine tutorial</a></li>
</ul>
      <h2 id="user-input-and-output-via-stdin-stdout">
        
        
          User input and output via stdin, stdout <a href="#user-input-and-output-via-stdin-stdout">#</a>
        
        
      </h2>
    
      <h3 id="global-console-object">
        
        
          Global console object <a href="#global-console-object">#</a>
        
        
      </h3>
    

<p>There’s a global <code class="language-plaintext highlighter-rouge">console</code> object that is configured to write to <code class="language-plaintext highlighter-rouge">process.stdout</code> and
<code class="language-plaintext highlighter-rouge">process.stderr</code>. The interesting thing is that you can pass an <code class="language-plaintext highlighter-rouge">Error</code> to <code class="language-plaintext highlighter-rouge">console.error()</code> in
order to get a stack trace. You can also use the <code class="language-plaintext highlighter-rouge">trace()</code> method. Here are examples.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello World</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">warn</span><span class="p">(</span><span class="dl">"</span><span class="s2">This is a warning!</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">This is an error</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">🐛 This captures the stack trace here!</span><span class="dl">"</span><span class="p">))</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">trace</span><span class="p">(</span><span class="dl">"</span><span class="s2">🐛 This also captures the stack trace here!</span><span class="dl">"</span><span class="p">)</span>
</code></pre></div></div>

<p>Another useful feature of console is <code class="language-plaintext highlighter-rouge">console.time(string)</code> and <code class="language-plaintext highlighter-rouge">console.timeEnd(string)</code>. The first
method starts a time (with the given string as key). A call to the second method with the same key
prints the elapsed time.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">timerName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">For loop time</span><span class="dl">"</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="c1">// Does not print anything. Starts the timer.</span>
<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">timeEnd</span><span class="p">(</span><span class="nx">timerName</span><span class="p">)</span> <span class="c1">// Prints the time that has passed, eg "For loop time:0.123ms".</span>
</code></pre></div></div>

<p>Yet another useful feature is the <code class="language-plaintext highlighter-rouge">console.table()</code> method which prints an array of objects that is
passed to it. Here’s an example.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nf">table</span><span class="p">([</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">john</span><span class="dl">"</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">12</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">jane</span><span class="dl">"</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">15</span> <span class="p">},</span>
<span class="p">])</span>
</code></pre></div></div>

<p>Here’s the output it produces.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────┬─────────┬──────────┐
│ (index) │  Name   │ Age      │
├─────────┼─────────┼──────────┤
│    0    │ 'john'  │    12    │
│    1    │ 'jane'  │    15    │
└─────────┴─────────┴──────────┘
</code></pre></div></div>
      <h3 id="console-class-and-simple-logging">
        
        
          Console class (and simple logging) <a href="#console-class-and-simple-logging">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="src/basics/console-log-to-file.ts">Sample code</a></li>
</ul>

<p>You can use the <code class="language-plaintext highlighter-rouge">Console</code> class to write to files, instead of using the global <code class="language-plaintext highlighter-rouge">console</code> object that
is tied to <code class="language-plaintext highlighter-rouge">process.stderr</code> and <code class="language-plaintext highlighter-rouge">process.stdout</code>. Here’s an example of a simple logger that writes
errors to files.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Console</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">console</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">createWriteStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./stdout.log</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">errorOutput</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">createWriteStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">./stderr.log</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Console</span><span class="p">({</span> <span class="na">stdout</span><span class="p">:</span> <span class="nx">output</span><span class="p">,</span> <span class="na">stderr</span><span class="p">:</span> <span class="nx">errorOutput</span> <span class="p">})</span>

<span class="kd">const</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nx">logger</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">number:</span><span class="dl">"</span><span class="p">,</span> <span class="kr">number</span><span class="p">)</span>
<span class="c1">// In stdout.log: number 5</span>
<span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="mi">9</span>
<span class="nx">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">error code:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span>
</code></pre></div></div>
      <h3 id="readline-from-global-console">
        
        
          readline from (global) console <a href="#readline-from-global-console">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/gkj79gjxYo9">Course</a></li>
  <li><a href="src/basics/cli-fp.ts">Sample code</a></li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">readline</code> module needs an interface to work. This interface can be a file or the console. We
want to get input from the console and output some information on the console, via <code class="language-plaintext highlighter-rouge">readline</code>.</p>

<ol>
  <li>In Node.js, the <code class="language-plaintext highlighter-rouge">process</code> object has two properties that can help us:</li>
</ol>

<ul>
  <li>👉 <code class="language-plaintext highlighter-rouge">stdout</code> for output - Prompts to the user are displayed via this.</li>
  <li>👈 <code class="language-plaintext highlighter-rouge">stdin</code> for input - User input is captured via this.</li>
</ul>

<ol>
  <li>We use the <code class="language-plaintext highlighter-rouge">createInterface</code> method to create a new <code class="language-plaintext highlighter-rouge">readline.Interface</code> instance that we can use
to:</li>
</ol>

<ul>
  <li>First, prompt the user for input as well (via <code class="language-plaintext highlighter-rouge">question</code>).</li>
  <li>Second, read user input from the console (via callback to <code class="language-plaintext highlighter-rouge">question</code>).</li>
</ul>

<ol>
  <li>Finally, when it is time to end the CLI, <code class="language-plaintext highlighter-rouge">close</code> must be called on the <code class="language-plaintext highlighter-rouge">readline.Interface</code>
otherwise the Node.js process will be waiting on the console’s <code class="language-plaintext highlighter-rouge">stdin</code> (even w/out being in the
middle of executing the <code class="language-plaintext highlighter-rouge">question</code> method). That’s just the way the Node.js
<a href="#nodejs-threading-model">threading model works</a>.</li>
</ol>
      <h4 id="fp-example-using-question-wout-using-line-event">
        
        
          FP example using question (w/out using “line” event) <a href="#fp-example-using-question-wout-using-line-event">#</a>
        
        
      </h4>
    

<p>The following are examples of functions to demonstrate the above. Here’s a function that kicks off
the CLI Node.js sample.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">readline</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">readline</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">argv</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Please type "</span><span class="p">${</span><span class="nx">Messages</span><span class="p">.</span><span class="nx">closeCommand</span><span class="p">}</span><span class="s2">" or </span><span class="p">${</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">red</span><span class="p">(</span><span class="dl">"</span><span class="s2">Ctrl+C</span><span class="dl">"</span><span class="p">)}</span><span class="s2"> to exit 🐾`</span><span class="p">)</span>
  <span class="nf">promptUserForInputViaConsoleInterface</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// https://nodejs.org/en/knowledge/command-line/how-to-parse-command-line-arguments/</span>
<span class="nf">main</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nf">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<p>Here’s a function that creates a <code class="language-plaintext highlighter-rouge">readline</code> interface connected to the console.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">createReadlineConsoleInterface</span><span class="p">():</span> <span class="nx">readline</span><span class="p">.</span><span class="nx">Interface</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">onCloseRequest</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">red</span><span class="p">(</span><span class="dl">"</span><span class="s2">Goodbye!</span><span class="dl">"</span><span class="p">))</span>
    <span class="nx">consoleInterface</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="kd">const</span> <span class="nx">consoleInterface</span><span class="p">:</span> <span class="nx">readline</span><span class="p">.</span><span class="nx">Interface</span> <span class="o">=</span> <span class="nx">readline</span><span class="p">.</span><span class="nf">createInterface</span><span class="p">({</span>
    <span class="na">input</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">,</span>
    <span class="na">output</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="nx">consoleInterface</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">close</span><span class="dl">"</span><span class="p">,</span> <span class="nx">onCloseRequest</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">consoleInterface</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">ourConsoleInterface</span><span class="p">:</span> <span class="nx">readline</span><span class="p">.</span><span class="nx">Interface</span> <span class="o">=</span> <span class="nf">createReadlineConsoleInterface</span><span class="p">()</span>
</code></pre></div></div>

<p>Here’s a function that uses the <code class="language-plaintext highlighter-rouge">readline</code> console interface to prompt the user (via
<code class="language-plaintext highlighter-rouge">process.stdout</code>) for some input, and process their response (from <code class="language-plaintext highlighter-rouge">process.stdin</code>).</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">enum</span> <span class="nx">Messages</span> <span class="p">{</span>
  <span class="nx">closeCommand</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">quit</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">userPrompt</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Type something</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">ConsoleInterfaceCallbackFn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">whatTheUserTyped</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span>

<span class="kd">function</span> <span class="nf">promptUserForInputViaConsoleInterface</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">processWhatTheUserTyped</span><span class="p">:</span> <span class="nx">ConsoleInterfaceCallbackFn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">whatTheUserTyped</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nf">userInputHandler</span><span class="p">(</span><span class="nx">whatTheUserTyped</span><span class="p">.</span><span class="nf">toLowerCase</span><span class="p">())</span>
  <span class="nx">ourConsoleInterface</span><span class="p">.</span><span class="nf">question</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">green</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">Messages</span><span class="p">.</span><span class="nx">userPrompt</span><span class="p">}</span><span class="s2">: `</span><span class="p">),</span> <span class="nx">processWhatTheUserTyped</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here’s a function that processes what the user typed.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">userInputHandler</span><span class="p">(</span><span class="nx">userInput</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// closeCommand issued. Stop the program by shutting the waiter down.</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">userInput</span> <span class="o">===</span> <span class="nx">Messages</span><span class="p">.</span><span class="nx">closeCommand</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ourConsoleInterface</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`🚀 You typed: </span><span class="p">${</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">yellow</span><span class="p">(</span><span class="nx">userInput</span><span class="p">)}</span><span class="s2">`</span><span class="p">)</span>
  <span class="nf">promptUserForInputViaConsoleInterface</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>
      <h4 id="oop-example-using-line-event-wout-using-question">
        
        
          OOP example using “line” event (w/out using question) <a href="#oop-example-using-line-event-wout-using-question">#</a>
        
        
      </h4>
    

<p>Instead of using the <code class="language-plaintext highlighter-rouge">question</code> method, we can simply rely on the <code class="language-plaintext highlighter-rouge">line</code> event, just like we rely on
the <code class="language-plaintext highlighter-rouge">close</code> event (which is fired when the user presses <code class="language-plaintext highlighter-rouge">Ctrl+C</code>).</p>

<p>Here’s an OOP version of the code above that uses this pattern (I think the code is much cleaner
w/out using <code class="language-plaintext highlighter-rouge">question</code>).</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">readline</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">readline</span><span class="dl">"</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">chalk</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">chalk</span><span class="dl">"</span>

<span class="kd">class</span> <span class="nc">UIStrings</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="nx">closeCommand</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">quit</span><span class="dl">"</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="nx">userPrompt</span> <span class="o">=</span> <span class="s2">`&gt; Please type "</span><span class="p">${</span><span class="nx">UIStrings</span><span class="p">.</span><span class="nx">closeCommand</span><span class="p">}</span><span class="s2">" or </span><span class="p">${</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">red</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">Ctrl+C</span><span class="dl">"</span>
  <span class="p">)}</span><span class="s2"> to exit 🐾`</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">CommandLineInterface</span> <span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="nx">consoleInterface</span><span class="p">:</span> <span class="nx">readline</span><span class="p">.</span><span class="nx">Interface</span>

  <span class="nf">constructor</span><span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">consoleInterface</span> <span class="o">=</span> <span class="nx">readline</span><span class="p">.</span><span class="nf">createInterface</span><span class="p">({</span>
      <span class="na">input</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">,</span>
      <span class="na">output</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">line</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onLineEntered</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">close</span><span class="dl">"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onControlCPressed</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">setPrompt</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">stop</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nx">start</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nf">prompt</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nx">setPrompt</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">consoleInterface</span><span class="p">.</span><span class="nf">setPrompt</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nx">onLineEntered</span> <span class="o">=</span> <span class="p">(</span><span class="nx">line</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch </span><span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="nx">UIStrings</span><span class="p">.</span><span class="na">closeCommand</span><span class="p">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">stop</span><span class="p">()</span>
        <span class="k">return</span>
      <span class="na">default</span><span class="p">:</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`&gt; 🚀 You typed: </span><span class="p">${</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">yellow</span><span class="p">(</span><span class="nx">line</span><span class="p">)}</span><span class="s2">`</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nx">onControlCPressed</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">red</span><span class="p">(</span><span class="dl">"</span><span class="s2">Goodbye!</span><span class="dl">"</span><span class="p">))</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">stop</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">argv</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">cli</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CommandLineInterface</span><span class="p">(</span><span class="nx">UIStrings</span><span class="p">.</span><span class="nx">userPrompt</span><span class="p">)</span>
  <span class="nx">cli</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
<span class="p">}</span>

<span class="cm">/**
 * Dump all the command line arguments to console.
 * More info: https://nodejs.org/en/knowledge/command-line/how-to-parse-command-line-arguments/
 */</span>
<span class="nf">main</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nf">splice</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>
      <h2 id="buffer">
        
        
          Buffer <a href="#buffer">#</a>
        
        
      </h2>
    

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/7nKRnv8Q9lQ#buffer-in-nodejs">Course</a></li>
  <li><a href="src/basics/buffer.ts">Sample code</a></li>
</ul>

<p>Node.js has a <code class="language-plaintext highlighter-rouge">Buffer</code> class that provides us with the functionality we discussed above. This
<code class="language-plaintext highlighter-rouge">Buffer</code> class is an array of bytes that is used to represent binary data. Streams, and other file
system operations, are usually carried out with binary data, making buffers the ideal candidates for
them.</p>

<p>The <code class="language-plaintext highlighter-rouge">Buffer</code> class is based on JavaScript’s <code class="language-plaintext highlighter-rouge">Uint8Array</code>. To put it simply, we can think of <code class="language-plaintext highlighter-rouge">Buffer</code>
objects as arrays that only contain integers from <code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">255</code>. One distinction is that <code class="language-plaintext highlighter-rouge">Buffer</code>
objects correspond to fixed-sized blocks of memory, which cannot be changed after they are created.
There is no explicit way of deleting a buffer, but setting it to null will do the job. The memory
will be handled by the garbage collector.</p>
      <h2 id="events">
        
        
          Events <a href="#events">#</a>
        
        
      </h2>
    

<ul>
  <li><a href="src/basics/events.ts">Sample code</a></li>
  <li><a href="https://nodejs.org/api/events.html#events_emitter_emit_eventname_args">EventEmitter Docs</a></li>
  <li><a href="https://www.damirscorner.com/blog/posts/20180216-VariableNumberOfArgumentsInTypescript.html">TypeScript varargs</a></li>
</ul>

<p>Some interesting things to note:</p>

<ul>
  <li>There’s a default <code class="language-plaintext highlighter-rouge">error</code> event that you can pass to an <code class="language-plaintext highlighter-rouge">EventEmitter</code>.</li>
  <li>When you call <code class="language-plaintext highlighter-rouge">emit</code> you can pass varargs as the last argument. You have to be careful about
receiving that in the event listener in the correct way.</li>
</ul>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">chalk</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">chalk</span><span class="dl">"</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">utils</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">printHeader</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">EventEmitter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">events</span><span class="dl">"</span>

<span class="kd">class</span> <span class="nc">Events</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">readonly</span> <span class="nx">TimerName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">EventsTimer</span><span class="dl">"</span>
  <span class="k">static</span> <span class="k">readonly</span> <span class="nb">Error</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span> <span class="cm">/* Special Node.js error name. */</span>
  <span class="k">static</span> <span class="k">readonly</span> <span class="nx">Event1</span> <span class="o">=</span> <span class="nc">Symbol</span><span class="p">()</span>
  <span class="k">static</span> <span class="k">readonly</span> <span class="nx">Event2</span> <span class="o">=</span> <span class="nc">Symbol</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// EventEmitter - https://nodejs.org/api/events.html#events_emitter_emit_eventname_args</span>

<span class="kd">function</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">printHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Events</span><span class="dl">"</span><span class="p">)</span>

  <span class="c1">// Start timer.</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">time</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">TimerName</span><span class="p">)</span>

  <span class="nx">utils</span><span class="p">.</span><span class="nf">_let</span><span class="p">(</span><span class="k">new</span> <span class="nc">EventEmitter</span><span class="p">(),</span> <span class="p">(</span><span class="nx">emitter</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Handle Event1.</span>
    <span class="nx">emitter</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">Event1</span><span class="p">,</span> <span class="p">(...</span><span class="na">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">blue</span><span class="p">(</span><span class="s2">`emitter.on -&gt; Event1, args: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">args</span><span class="p">)}</span><span class="s2">`</span><span class="p">))</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">timeLog</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">TimerName</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1">// Handle Event2.</span>
    <span class="nx">emitter</span><span class="p">.</span><span class="nf">once</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">Event2</span><span class="p">,</span> <span class="p">(...</span><span class="na">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">green</span><span class="p">(</span><span class="s2">`emitter.once -&gt; Event2, args: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">args</span><span class="p">)}</span><span class="s2">`</span><span class="p">))</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">timeLog</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">TimerName</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1">// Handle Error.</span>
    <span class="nx">emitter</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="p">(...</span><span class="na">errorArgs</span><span class="p">:</span> <span class="kr">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nf">red</span><span class="p">(</span><span class="s2">`emitter.on('error') -&gt; errorArgs: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">errorArgs</span><span class="p">)}</span><span class="s2">`</span><span class="p">))</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">timeLog</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">TimerName</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1">// Fire Event1.</span>
    <span class="nf">printHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Fire Event1</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">utils</span><span class="p">.</span><span class="nf">_let</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">Event1</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">fireEvent</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="dl">"</span><span class="s2">🐵</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span> <span class="p">})</span>
      <span class="nf">fireEvent</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1">// Fire Event2.</span>
    <span class="nf">printHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Fire Event2</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">utils</span><span class="p">.</span><span class="nf">_let</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nx">Event2</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">fireEvent</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span>
      <span class="nf">fireEvent</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1">// Fire Error.</span>
    <span class="nf">printHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Fire Error</span><span class="dl">"</span><span class="p">)</span>
    <span class="nf">fireError</span><span class="p">(</span><span class="nx">emitter</span><span class="p">)</span>
    <span class="nf">fireError</span><span class="p">(</span><span class="nx">emitter</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="dl">"</span><span class="s2">💣</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">errorCode</span><span class="p">:</span> <span class="mi">50</span> <span class="p">})</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1">// TypeScript varargs -</span>
<span class="c1">// https://www.damirscorner.com/blog/posts/20180216-VariableNumberOfArgumentsInTypescript.html</span>

<span class="kd">const</span> <span class="nx">fireError</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">emitter</span><span class="p">:</span> <span class="nx">EventEmitter</span><span class="p">,</span>
  <span class="nx">delayMs</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">errorArgs</span><span class="p">:</span> <span class="p">(</span><span class="kr">string</span> <span class="o">|</span> <span class="nx">object</span><span class="p">)[]</span>
<span class="p">)</span> <span class="o">=&gt;</span>
  <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">emitter</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="nx">Events</span><span class="p">.</span><span class="nb">Error</span><span class="p">,</span> <span class="p">...</span><span class="nx">errorArgs</span><span class="p">)</span>
  <span class="p">},</span> <span class="nx">delayMs</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">fireEvent</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">emitter</span><span class="p">:</span> <span class="nx">EventEmitter</span><span class="p">,</span>
  <span class="nx">eventType</span><span class="p">:</span> <span class="nx">symbol</span> <span class="o">|</span> <span class="kr">string</span><span class="p">,</span>
  <span class="nx">delayMs</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">args</span><span class="p">:</span> <span class="p">(</span><span class="kr">string</span> <span class="o">|</span> <span class="nx">object</span><span class="p">)[]</span>
<span class="p">)</span> <span class="o">=&gt;</span>
  <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">emitter</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span>
  <span class="p">},</span> <span class="nx">delayMs</span><span class="p">)</span>

<span class="nf">main</span><span class="p">()</span>
</code></pre></div></div>
      <h2 id="files">
        
        
          Files <a href="#files">#</a>
        
        
      </h2>
    

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/YQorL9rDQEW">Course</a></li>
  <li><a href="src/basics/files.ts">Sample code</a></li>
</ul>

<p>There are many <code class="language-plaintext highlighter-rouge">fs</code> APIs - async, sync, and promises. Use the <code class="language-plaintext highlighter-rouge">fs.promises</code> API so that it works
well with async / await and promises.</p>
      <h2 id="modules">
        
        
          Modules <a href="#modules">#</a>
        
        
      </h2>
    

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/m25YKr666wE">Course</a></li>
</ul>

<ol>
  <li>Unlike browsers, global in Node.js is scoped to each module. So each module in Node.js has its
own <code class="language-plaintext highlighter-rouge">global</code> object. And there is no such thing as the concept of a browser “global”.</li>
  <li>Each TS or JS file is considered a “module” by Node.js.</li>
  <li>A Node.js <code class="language-plaintext highlighter-rouge">package</code> is not the same as a <code class="language-plaintext highlighter-rouge">module</code>. Modules are related to exports and imports.
Packages are things that are published to npm and added to other packages as deps.</li>
</ol>
      <h2 id="os-streams-process-network-etc">
        
        
          OS, streams, process, network, etc. <a href="#os-streams-process-network-etc">#</a>
        
        
      </h2>
    
      <h3 id="os">
        
        
          OS <a href="#os">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/N8qMPx1ZAzD">Course</a></li>
  <li><a href="src/basics/os.ts">Sample code</a></li>
</ul>
      <h3 id="process">
        
        
          Process <a href="#process">#</a>
        
        
      </h3>
    

<p>You can listen to various events fired by the <code class="language-plaintext highlighter-rouge">process</code> global object (which is also an
<code class="language-plaintext highlighter-rouge">EventEmitter</code> instance). Here are some common ones: <code class="language-plaintext highlighter-rouge">beforeExit</code>, <code class="language-plaintext highlighter-rouge">exit</code>, and <code class="language-plaintext highlighter-rouge">uncaughtException</code>.
Refer`to the sample code listed below for more details.</p>

<ul>
  <li><a href="https://www.educative.io/courses/learn-nodejs-complete-course-for-beginners/xlxR82ozxxE">Course</a></li>
  <li><a href="src/basics/process.ts">Sample code</a></li>
  <li><a href="https://nodejs.org/api/process.html#process_process_channel">Node.js docs - Process</a></li>
  <li><a href="https://www.dynatrace.com/news/blog/understanding-garbage-collection-and-hunting-memory-leaks-in-node-js/">Tutorial - Node.js memory model</a></li>
</ul>
      <h3 id="streams-backpressure-pipes-files">
        
        
          Streams, backpressure, pipes, files <a href="#streams-backpressure-pipes-files">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="https://nodejs.org/api/stream.html">Node.js docs - Stream</a></li>
  <li><a href="https://nodejs.org/en/docs/guides/backpressuring-in-streams/">Node.js docs - Backpressure and pipes</a></li>
  <li><a href="https://nodejs.org/api/stream.html#stream_stream_pipeline_streams_callback/">Node.js docs - pipeline</a></li>
  <li><a href="https://jscomplete.com/learn/node-beyond-basics/node-streams">Tutorial - Stream</a></li>
  <li><a href="https://medium.com/dev-bits/writing-memory-efficient-software-applications-in-node-js-5575f646b67f">Tutorial - Streams, large file IO, and memory usage</a></li>
  <li><a href="https://www.dynatrace.com/news/blog/understanding-garbage-collection-and-hunting-memory-leaks-in-node-js/">Article - GC and memory leaks in Node.js</a></li>
  <li><a href="https://stackoverflow.com/a/60459320/2085356">Discussion - Difference between pipe and pipeline</a></li>
  <li><a href="https://stackoverflow.com/a/67435044/2085356">Discussion - Get latest version of Node.js TS bindings</a></li>
  <li><a href="https://github.com/nodejs/node/issues/35731">Discussion - Latest version of Node.js and stream promises</a></li>
  <li><a href="src/streams/stream.ts">Sample code</a></li>
</ul>

<p>All streams are instances of <a href="https://nodejs.org/api/events.html#events_class_eventemitter"><code class="language-plaintext highlighter-rouge">EventEmitter</code></a>. They emit events that can be used to read
and write data. However, we can consume streams data in a simpler way using the <a href="https://nodejs.org/en/knowledge/advanced/streams/how-to-use-stream-pipe"><code class="language-plaintext highlighter-rouge">pipe()</code></a>
method (defined in <a href="https://nodejs.org/api/stream.html#stream_readable_pipe_destination_options"><code class="language-plaintext highlighter-rouge">Stream</code></a>). This method also handles errors, end-of-files, and the
cases when one stream is slower or faster than the other (backpressure).</p>

<blockquote>
  <p>In other words:</p>

  <table>
    <thead>
      <tr>
        <th>Paradigm to work with Streams</th>
        <th>How to use</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Events (stream is also EventEmitter)</td>
        <td>Use EventEmitter and attach listeners for <code class="language-plaintext highlighter-rouge">data</code> etc</td>
      </tr>
      <tr>
        <td>Pipes (method defined on Stream)</td>
        <td><code class="language-plaintext highlighter-rouge">pipe()</code>, which also handles errors, EOFs, backpressure</td>
      </tr>
    </tbody>
  </table>
</blockquote>
      <h4 id="pipe">
        
        
          pipe <a href="#pipe">#</a>
        
        
      </h4>
    

<p>Here’s some pseudocode to demonstrate how all this fits together.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">readableSrc</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">writableDest</span><span class="p">)</span>
</code></pre></div></div>

<p>And in more complex cases.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">readableSrc</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">transformStream1</span><span class="p">).</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">transformStream2</span><span class="p">).</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">finalWrtitableDest</span><span class="p">)</span>
</code></pre></div></div>

<p>Using a Linux analogy.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>a | b | c | d
</code></pre></div></div>

<p>Is equivalent to.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">a</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>

<span class="c1">// Which is equivalent to:</span>
<span class="nx">a</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
<span class="nx">b</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<span class="nx">c</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
</code></pre></div></div>

<p>There is a lot to digest in the sample code above. There are some big concepts with streams and
files. The async nature of Node.js really shows itself here. Here are some interesting things to
note.</p>

<ol>
  <li>File reads are asynchronous by nature. So when the <code class="language-plaintext highlighter-rouge">pipe()</code> function is called on a stream that
happens asynchronously so there’s no waiting for it to finish and it returns an <code class="language-plaintext highlighter-rouge">EventEmitter</code>.
That’s how these calls can be chained together.</li>
  <li>Without backpressure, the memory load is really high when writing a file “inefficiently”. This
also has the result of making the gc work even harder, and the CPU even harder dealing w/ memory
management. Piping and backpressure resolve this issue and the results are stark!</li>
  <li>File writes using a stream are async, but they also buffer in the OS file system. Linux will
buffer the file and delay write it, even though Node.js will report that the file write is
complete. This means that running <code class="language-plaintext highlighter-rouge">fs.stat()</code> immediately after the file write will result in
incorrect file size being reported, since the size on disk is still growing.</li>
  <li>There are <a href="https://stackoverflow.com/a/21583831/2085356">multiple ways</a> of creating your own
<code class="language-plaintext highlighter-rouge">Writable</code> and <code class="language-plaintext highlighter-rouge">Readable</code> streams. You can use the simplified constructor API or use classes
instead.</li>
  <li>The <code class="language-plaintext highlighter-rouge">console</code> global object is just a <code class="language-plaintext highlighter-rouge">Writable</code> stream! This makes it possible to overwrite the
output that has already been written w/out generating a new line! This is handy for showing long
running progress. Take a look at
<a href="https://github.com/r3bl-org/r3bl-ts-utils/blob/main/src/color-console-utils.ts">color-console-utils.kt</a>
<code class="language-plaintext highlighter-rouge">consoleLogInPlace</code> method.</li>
  <li>Piping is an incredibly powerful feature for working with streams in a high performance and
memory efficient way. Read the docs and tutorials above for details.</li>
</ol>
      <h4 id="pipeline-transform-stream-and-errors">
        
        
          pipeline, transform stream, and errors <a href="#pipeline-transform-stream-and-errors">#</a>
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">pipe()</code> does not report errors. <code class="language-plaintext highlighter-rouge">pipeline()</code> is what you must use when it comes to detecting error
conditions. Here’s an example using a transform stream (which performs <code class="language-plaintext highlighter-rouge">gzip</code> compression).</p>

<p>Here’s a snippet that uses a <code class="language-plaintext highlighter-rouge">gzip</code> transform stream in between a read and write stream, with the
use of backpressure, in other words:</p>

<p><code class="language-plaintext highlighter-rouge">Reader(UncompressedFile)</code> -&gt; <code class="language-plaintext highlighter-rouge">gzip</code> transform -&gt; <code class="language-plaintext highlighter-rouge">Writer(NewCompressedFile)</code></p>

<p>Or:</p>

<p><code class="language-plaintext highlighter-rouge">Reader(UncompressedFile)</code> <code class="language-plaintext highlighter-rouge">|</code> <code class="language-plaintext highlighter-rouge">gzip</code> transform <code class="language-plaintext highlighter-rouge">|</code> <code class="language-plaintext highlighter-rouge">Writer(NewCompressedFile)</code></p>

<p>Note - The promisified version of <code class="language-plaintext highlighter-rouge">pipline</code> on only works on Node.JS v15 and higher.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ColorConsole</span><span class="p">,</span> <span class="nx">sleep</span><span class="p">,</span> <span class="nx">StyledColorConsole</span><span class="p">,</span> <span class="nx">Styles</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Constants</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Constants</span><span class="dl">"</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">fs</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">zlib</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">zlib</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">pipeline</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">stream/promises</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">CompressLargeFileEfficiently</span> <span class="p">{</span>
  <span class="nx">performCompression</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">actuallyCompress</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>

    <span class="c1">// Wait for disk flush.</span>
    <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">textStyle1</span><span class="p">.</span><span class="nx">blue</span><span class="p">)(</span>
      <span class="dl">"</span><span class="s2">Waiting for disk to flush the write to file for 5s...</span><span class="dl">"</span>
    <span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>
    <span class="k">await</span> <span class="nf">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nx">actuallyCompress</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">uncompressedSrcFileReader</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">createReadStream</span><span class="p">(</span><span class="nx">Constants</span><span class="p">.</span><span class="nx">filePath</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">compressedDestFileWriter</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">createWriteStream</span><span class="p">(</span><span class="nx">Constants</span><span class="p">.</span><span class="nx">compressedFilePath</span><span class="p">)</span>

    <span class="kd">const</span> <span class="nx">gzipTransformer</span> <span class="o">=</span> <span class="nx">zlib</span><span class="p">.</span><span class="nf">createGzip</span><span class="p">()</span>

    <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">textStyle1</span><span class="p">)(</span><span class="s2">`Using pipeline() to compress file`</span><span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>
    <span class="k">await</span> <span class="nf">pipeline</span><span class="p">(</span><span class="nx">uncompressedSrcFileReader</span><span class="p">,</span> <span class="nx">gzipTransformer</span><span class="p">,</span> <span class="nx">compressedDestFileWriter</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="k">new</span> <span class="nc">CompressLargeFileEfficiently</span><span class="p">().</span><span class="nf">performCompression</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>

<span class="c1">// One line version of two blocks above.</span>
<span class="c1">// await new CompressLargeFileEfficiently().performCompression().catch(console.error)</span>
</code></pre></div></div>
      <h3 id="child-process">
        
        
          Child process <a href="#child-process">#</a>
        
        
      </h3>
    

<ul>
  <li><a href="https://nodejs.org/api/child_process.html">Node.js docs - Child process</a></li>
  <li><a href="https://jscomplete.com/learn/node-beyond-basics/child-processes">Tutorial - Child process</a></li>
  <li><a href="src/cproc/child-process.ts">Sample code</a></li>
</ul>

<p>Node.js makes it easy to spawn other child processes (OS processes and other instances of itself) in
order to scale or overcome its single threaded nature.</p>

<blockquote>
  <p>Only when spawning other instances of itself it does it use IPC to send messages back and forth
between these instances.</p>
</blockquote>

<p>When combined w/ streams and <code class="language-plaintext highlighter-rouge">pipe()</code> this creates an incredibly powerful way to run processes and
manage process execution on your host OS.</p>

<ul>
  <li>A child process (<code class="language-plaintext highlighter-rouge">ChildProcess</code>) is also an <code class="language-plaintext highlighter-rouge">EventEmitter</code> (<code class="language-plaintext highlighter-rouge">ChildProcess</code> is a subclass).</li>
  <li>It has 3 streams as well: <code class="language-plaintext highlighter-rouge">stdin</code>, <code class="language-plaintext highlighter-rouge">stdout</code>, <code class="language-plaintext highlighter-rouge">stderr</code>. You can use <code class="language-plaintext highlighter-rouge">pipe()</code> on them! Every
<code class="language-plaintext highlighter-rouge">Stream</code> is also an <code class="language-plaintext highlighter-rouge">EventEmitter</code>.</li>
</ul>

<p>There are four different ways to create a child process in Node:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">spawn()</code> - this is what we will look deeply into in this section. It can be used to run any OS
command via a child process of the Node.js instance that executes this function.</li>
  <li><code class="language-plaintext highlighter-rouge">fork()</code> - this is what spawns another Node.js instance and IPC is used to communicate between
the instances.</li>
  <li><code class="language-plaintext highlighter-rouge">exec()</code> - this actually spawns a shell in order to execute the command that is passed. It has
one other major difference. It buffers the command’s generated output and passes the whole output
value to a callback function (instead of using streams, which is what <code class="language-plaintext highlighter-rouge">spawn</code> does).</li>
  <li><code class="language-plaintext highlighter-rouge">execFile()</code> - this is like <code class="language-plaintext highlighter-rouge">exec()</code> except that it does not generate a shell before executing
the command.</li>
</ol>

<blockquote>
  <ul>
    <li>There are also sync versions of these functions that block the main thread.</li>
    <li>There is currently no promisified version, though you can use the
<a href="https://nodejs.org/api/util.html#util_util_promisify_original"><code class="language-plaintext highlighter-rouge">util.promisify()</code></a>
functionality of Node.js to use promises. Here’s a
<a href="https://stackoverflow.com/a/67379845/2085356">thread on SO</a> that shows some samples of how to
write the promises yourself using TypeScript.</li>
  </ul>
</blockquote>

<p>The examples in this section only look at the situation where you want to spawn a program on your OS
in a child process of the Node.js process that you have started (and the other approaches are just
skimmed).</p>
      <h4 id="deep-dive-into-spawn">
        
        
          Deep dive into spawn() <a href="#deep-dive-into-spawn">#</a>
        
        
      </h4>
    

<p>The <code class="language-plaintext highlighter-rouge">spawn</code> function launches a command in a new process and we can use it to pass that command any
arguments. Here’s an example.</p>
      <h5 id="example-1---spawn-a-child-process-to-execute-a-command">
        
        
          Example 1 - spawn a child process to execute a command <a href="#example-1---spawn-a-child-process-to-execute-a-command">#</a>
        
        
      </h5>
    

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ChildProcess</span><span class="p">,</span> <span class="nx">spawn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorConsole</span><span class="p">,</span> <span class="nx">StyledColorConsole</span><span class="p">,</span> <span class="nx">Styles</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">SpawnCProcToRunLinuxCommandAndGetOutput</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">find</span><span class="dl">"</span>
  <span class="k">readonly</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">}</span><span class="s2">/github/notes/`</span><span class="p">,</span> <span class="dl">"</span><span class="s2">-type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">f</span><span class="dl">"</span><span class="p">]</span>

  <span class="nx">run</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">child</span><span class="p">:</span> <span class="nx">ChildProcess</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cmd</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">resolveFn</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">child</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">exit</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">signal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">blue</span><span class="p">)(</span>
          <span class="s2">`Child process exited with code </span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2"> and signal </span><span class="p">${</span><span class="nx">signal</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">).</span><span class="nf">consoleLog</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="nf">resolveFn</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">stdout</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="nx">Buffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">StyledColorConsole</span><span class="p">.</span><span class="nc">Primary</span><span class="p">(</span><span class="s2">`Output : </span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLogInPlace</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="nx">child</span><span class="p">.</span><span class="nx">stderr</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">red</span><span class="p">)(</span><span class="s2">`Error: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>
        <span class="nf">rejectFn</span><span class="p">()</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="k">new</span> <span class="nc">SpawnCProcToRunLinuxCommandAndGetOutput</span><span class="p">().</span><span class="nf">run</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
</code></pre></div></div>

<p>Here are some notes on the code snippet above:</p>

<ul>
  <li><a href="https://nodejs.org/api/child_process.html#child_process_class_childprocess"><code class="language-plaintext highlighter-rouge">ChildProcess</code></a> is a subclass of <a href="https://nodejs.org/api/events.html#events_class_eventemitter"><code class="language-plaintext highlighter-rouge">EventEmitter</code></a>.
    <ul>
      <li>Events that we can register handlers for with the <code class="language-plaintext highlighter-rouge">ChildProcess</code> instances are:</li>
      <li><code class="language-plaintext highlighter-rouge">disconnect</code>, <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">close</code>, and <code class="language-plaintext highlighter-rouge">message</code>.</li>
    </ul>
  </li>
  <li>To get a stream out of it, you can use the <code class="language-plaintext highlighter-rouge">stdin</code>, <code class="language-plaintext highlighter-rouge">stdout</code>, and <code class="language-plaintext highlighter-rouge">stderr</code> properties of the
<code class="language-plaintext highlighter-rouge">ChildProcess</code> instance, using:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">child.stdin</code>, <code class="language-plaintext highlighter-rouge">child.stdout</code>, and <code class="language-plaintext highlighter-rouge">child.stderr</code>.</li>
      <li>When those streams get closed, the child process that was using them will emit the <code class="language-plaintext highlighter-rouge">close</code>
event. This <code class="language-plaintext highlighter-rouge">close</code> event is different than the <code class="language-plaintext highlighter-rouge">exit</code> event because multiple child processes
might share the same “stdio” streams, so one child process exiting does not mean that the
streams got closed.</li>
    </ul>
  </li>
</ul>
      <h5 id="stdio-streams-for-getting-input-to-and-output-from-child-process-commands">
        
        
          “stdio” streams for getting input to and output from child process commands <a href="#stdio-streams-for-getting-input-to-and-output-from-child-process-commands">#</a>
        
        
      </h5>
    

<p>Child processes (used to execute commands) have streams that are <code class="language-plaintext highlighter-rouge">Readable</code> and <code class="language-plaintext highlighter-rouge">Writable</code>. We can
use them to send data to commands and to get the output or error from the commands.</p>

<blockquote>
  <p>In a <strong>child process</strong>, this is the <strong>inverse</strong> of those types found in a <strong>main process</strong>.</p>

  <table>
    <thead>
      <tr>
        <th>Stream</th>
        <th>R/W</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="https://nodejs.org/api/process.html#process_process_stdin"><code class="language-plaintext highlighter-rouge">process.stdin</code></a></td>
        <td>Readable</td>
      </tr>
      <tr>
        <td><a href="https://nodejs.org/api/child_process.html#child_process_subprocess_stdin"><code class="language-plaintext highlighter-rouge">child.stdin</code></a></td>
        <td>Writable</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<p>We can use the event driven approach to get data in and out of these child processes, they are
<a href="https://nodejs.org/api/events.html#events_class_eventemitter">event emitters</a>. We can listen to different events (eg: <code class="language-plaintext highlighter-rouge">data</code>) on those “stdio” streams that
are attached to every child process.</p>

<blockquote>
  <p>In other words:</p>

  <table>
    <thead>
      <tr>
        <th>What you need from command</th>
        <th>What to use</th>
        <th>Stream</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Output from command</td>
        <td><code class="language-plaintext highlighter-rouge">child.stdout.on("data")</code></td>
        <td>Readable</td>
      </tr>
      <tr>
        <td>Error from command</td>
        <td><code class="language-plaintext highlighter-rouge">child.stderr.on("data")</code></td>
        <td>Readable</td>
      </tr>
      <tr>
        <td>Input to command</td>
        <td><code class="language-plaintext highlighter-rouge">child.stdin</code></td>
        <td>Writable</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<p>However it is easier to use the</p>

<ul>
  <li>We can use the child process <code class="language-plaintext highlighter-rouge">stdin</code> which is a <code class="language-plaintext highlighter-rouge">Writable</code> stream.</li>
  <li>Just like any <code class="language-plaintext highlighter-rouge">Writable</code> stream, the easiest way to consume it is using <code class="language-plaintext highlighter-rouge">pipe()</code>.</li>
  <li>We simply pipe a <code class="language-plaintext highlighter-rouge">Readable</code> stream into a <code class="language-plaintext highlighter-rouge">Writable</code> stream.</li>
</ul>
      <h5 id="example-2---pipe-processstdin-into-child-process-command">
        
        
          Example 2 - pipe process.stdin into child process command <a href="#example-2---pipe-processstdin-into-child-process-command">#</a>
        
        
      </h5>
    

<p>Since the main process <code class="language-plaintext highlighter-rouge">stdin</code> is a <code class="language-plaintext highlighter-rouge">Readable</code> stream, we can pipe that into a child process <code class="language-plaintext highlighter-rouge">stdin</code>
stream. For example:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ChildProcess</span><span class="p">,</span> <span class="nx">spawn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorConsole</span><span class="p">,</span> <span class="nx">notNil</span><span class="p">,</span> <span class="nx">StyledColorConsole</span><span class="p">,</span> <span class="nx">Styles</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">SpawnCProcAndPipeStdinToLinuxCommand</span> <span class="p">{</span>
  <span class="nx">run</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Secondary</span><span class="p">)(</span>
      <span class="s2">`Type words, then press Ctrl+D to count them...`</span>
    <span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>

    <span class="kd">const</span> <span class="na">wcCommand</span><span class="p">:</span> <span class="nx">ChildProcess</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="dl">"</span><span class="s2">wc</span><span class="dl">"</span><span class="p">)</span>

    <span class="c1">// Send input to command (from process.stdin), ie, process.stdin | wcCommand.stdin.</span>
    <span class="nf">notNil</span><span class="p">(</span><span class="nx">wcCommand</span><span class="p">.</span><span class="nx">stdin</span><span class="p">,</span> <span class="p">(</span><span class="nx">wcCommandStdin</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">wcCommandStdin</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">resolveFn</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">wcCommand</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">exit</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">signal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">blue</span><span class="p">)(</span>
          <span class="s2">`Child process exited with code </span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2"> and signal </span><span class="p">${</span><span class="nx">signal</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">).</span><span class="nf">consoleLog</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="nf">resolveFn</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="nx">wcCommand</span><span class="p">.</span><span class="nx">stdout</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="nx">Buffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">StyledColorConsole</span><span class="p">.</span><span class="nc">Primary</span><span class="p">(</span><span class="s2">`Output: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLogInPlace</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="nx">wcCommand</span><span class="p">.</span><span class="nx">stderr</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">red</span><span class="p">)(</span><span class="s2">`Error: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>
        <span class="nf">rejectFn</span><span class="p">()</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="k">new</span> <span class="nc">SpawnCProcAndPipeStdinToLinuxCommand</span><span class="p">().</span><span class="nf">run</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
</code></pre></div></div>

<p>In the example above:</p>

<ul>
  <li>The child process invokes the <code class="language-plaintext highlighter-rouge">wc</code> command, which counts lines, words, and characters in Linux.</li>
  <li>We then pipe the main process <code class="language-plaintext highlighter-rouge">stdin</code> (which is a <code class="language-plaintext highlighter-rouge">Readable</code> stream) into the child process
<code class="language-plaintext highlighter-rouge">stdin</code> (which is a <code class="language-plaintext highlighter-rouge">Writable</code> stream).</li>
  <li>The result of this combination is that we get a standard input mode where we can type something,
and when we hit <code class="language-plaintext highlighter-rouge">Ctrl+D</code> what we typed will be used as the input of the <code class="language-plaintext highlighter-rouge">wc</code> command.</li>
</ul>
      <h5 id="example-3---pipe-the-output-of-one-child-process-command-into-another-one">
        
        
          Example 3 - pipe the output of one child process command into another one <a href="#example-3---pipe-the-output-of-one-child-process-command-into-another-one">#</a>
        
        
      </h5>
    

<p>We can also pipe the standard input/output of multiple processes on each other, just like we can do
with Linux commands. For example, we can pipe the <code class="language-plaintext highlighter-rouge">stdout</code> of the <code class="language-plaintext highlighter-rouge">find</code> command to the <code class="language-plaintext highlighter-rouge">stdin</code> of
the <code class="language-plaintext highlighter-rouge">wc</code> command to count all the files in the current directory.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ChildProcess</span><span class="p">,</span> <span class="nx">spawn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ColorConsole</span><span class="p">,</span> <span class="nx">notNil</span><span class="p">,</span> <span class="nx">StyledColorConsole</span><span class="p">,</span> <span class="nx">Styles</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">SpawnCProcToPipeOutputOfOneLinuxCommandIntoAnother</span> <span class="p">{</span>
  <span class="nx">run</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">findChildProcess</span><span class="p">:</span> <span class="nx">ChildProcess</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="dl">"</span><span class="s2">find</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span>
      <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">}</span><span class="s2">/github/notes/`</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">-type</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">f</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">])</span>

    <span class="kd">const</span> <span class="na">wcChildProcess</span><span class="p">:</span> <span class="nx">ChildProcess</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="dl">"</span><span class="s2">wc</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">-l</span><span class="dl">"</span><span class="p">])</span>

    <span class="nf">notNil</span><span class="p">(</span><span class="nx">findChildProcess</span><span class="p">.</span><span class="nx">stdout</span><span class="p">,</span> <span class="p">(</span><span class="nx">find</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nf">notNil</span><span class="p">(</span><span class="nx">wcChildProcess</span><span class="p">.</span><span class="nx">stdin</span><span class="p">,</span> <span class="p">(</span><span class="nx">wc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">find</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">wc</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">resolveFn</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">wcChildProcess</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">exit</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">signal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">blue</span><span class="p">)(</span>
          <span class="s2">`Child process exited with code </span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2"> and signal </span><span class="p">${</span><span class="nx">signal</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">).</span><span class="nf">consoleLog</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="nf">resolveFn</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="nx">wcChildProcess</span><span class="p">.</span><span class="nx">stdout</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="nx">Buffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">StyledColorConsole</span><span class="p">.</span><span class="nc">Primary</span><span class="p">(</span><span class="s2">`Number of files </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLogInPlace</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="nx">wcChildProcess</span><span class="p">.</span><span class="nx">stderr</span><span class="p">?.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">red</span><span class="p">)(</span><span class="s2">`Error: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>
        <span class="nf">rejectFn</span><span class="p">()</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="k">new</span> <span class="nc">SpawnCProcToPipeOutputOfOneLinuxCommandIntoAnother</span><span class="p">().</span><span class="nf">run</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
</code></pre></div></div>
      <h5 id="example-4---ugly-code-to-redirect-the-output-of-one-child-process-command-to-another-one">
        
        
          Example 4 - ugly code to redirect the output of one child process command to another one <a href="#example-4---ugly-code-to-redirect-the-output-of-one-child-process-command-to-another-one">#</a>
        
        
      </h5>
    

<p>Without using <code class="language-plaintext highlighter-rouge">pipe()</code> the code would be pretty ugly.</p>

<p>Let’s convert the following shell script to Node.js w/out using <code class="language-plaintext highlighter-rouge">pipe()</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps ax | <span class="nb">grep </span>ssh
</code></pre></div></div>

<p>Here’s the ugly code (using <code class="language-plaintext highlighter-rouge">pipe()</code> is far superior).</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">spawn</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">ps</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="dl">"</span><span class="s2">ps</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">ax</span><span class="dl">"</span><span class="p">])</span>
<span class="kd">const</span> <span class="nx">grep</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="dl">"</span><span class="s2">grep</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">ssh</span><span class="dl">"</span><span class="p">])</span>

<span class="nx">ps</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">grep</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">ps</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`ps stderr: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">ps</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">close</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">code</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`ps process exited with code </span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">grep</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">grep</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
<span class="p">})</span>
<span class="nx">grep</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">onsole</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`grep stderr: </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">grep</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">close</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">code</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`grep process exited with code </span><span class="p">${</span><span class="nx">code</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>
      <h4 id="killing-or-aborting-a-child-process">
        
        
          Killing or aborting a child process <a href="#killing-or-aborting-a-child-process">#</a>
        
        
      </h4>
    

<p>To kill a child process, you can call
<a href="https://nodejs.org/api/child_process.html#child_process_subprocess_kill_signal"><code class="language-plaintext highlighter-rouge">kill()</code></a>.</p>

<p>If the <code class="language-plaintext highlighter-rouge">signal</code> option (of type <code class="language-plaintext highlighter-rouge">AbortSignal</code>) is enabled, calling <code class="language-plaintext highlighter-rouge">.abort()</code> on the corresponding
<code class="language-plaintext highlighter-rouge">AbortController</code> is similar to calling <code class="language-plaintext highlighter-rouge">.kill()</code> on the child process except the error passed to
the callback will be an <code class="language-plaintext highlighter-rouge">AbortError</code>.
<a href="https://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options">Node.js docs</a>
. For example:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">spawn</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AbortController</span><span class="p">()</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">signal</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">controller</span>

<span class="kd">const</span> <span class="nx">grep</span> <span class="o">=</span> <span class="nf">spawn</span><span class="p">(</span><span class="dl">"</span><span class="s2">grep</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">ssh</span><span class="dl">"</span><span class="p">],</span> <span class="p">{</span> <span class="nx">signal</span> <span class="p">})</span>
<span class="nx">grep</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// This will be called with err being an AbortError if the controller aborts</span>
<span class="p">})</span>
<span class="nx">controller</span><span class="p">.</span><span class="nf">abort</span><span class="p">()</span> <span class="c1">// Stops the child process</span>
</code></pre></div></div>
      <h4 id="brief-exploration-of-exec">
        
        
          Brief exploration of exec() <a href="#brief-exploration-of-exec">#</a>
        
        
      </h4>
    

<p>Here’s an example.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">exec</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span><span class="p">)</span>

<span class="nf">exec</span><span class="p">(</span><span class="dl">"</span><span class="s2">find . -type f | wc -l</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`exec error: </span><span class="p">${</span><span class="nx">err</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Number of files </span><span class="p">${</span><span class="nx">stdout</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>
      <h4 id="brief-exploration-of-fork">
        
        
          Brief exploration of fork() <a href="#brief-exploration-of-fork">#</a>
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">fork()</code> is a variation of <code class="language-plaintext highlighter-rouge">spawn()</code> for spawning node processes. The biggest difference between
<code class="language-plaintext highlighter-rouge">spawn</code> and <code class="language-plaintext highlighter-rouge">fork</code> is that a communication channel is established to the child process when using
<code class="language-plaintext highlighter-rouge">fork</code>, so we can use <code class="language-plaintext highlighter-rouge">send()</code> on the forked process along with the global <code class="language-plaintext highlighter-rouge">process</code> object itself
to exchange messages between the parent and forked processes.</p>

<p>We do this through the <code class="language-plaintext highlighter-rouge">EventEmitter</code> module interface. Here’s an example:</p>

<p>The parent file, <code class="language-plaintext highlighter-rouge">parent.js</code>:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">fork</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">forked</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">(</span><span class="dl">"</span><span class="s2">child.js</span><span class="dl">"</span><span class="p">)</span>

<span class="nx">forked</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Message from child</span><span class="dl">"</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">forked</span><span class="p">.</span><span class="nf">send</span><span class="p">({</span> <span class="na">hello</span><span class="p">:</span> <span class="dl">"</span><span class="s2">world</span><span class="dl">"</span> <span class="p">})</span>
</code></pre></div></div>

<p>The child file, <code class="language-plaintext highlighter-rouge">child.js</code>:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">process</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Message from parent:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nf">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">process</span><span class="p">.</span><span class="nf">send</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">counter</span><span class="o">++</span> <span class="p">})</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>
      <h4 id="example-of-replacing-a-fish-script-using-spawn">
        
        
          Example of replacing a fish script using spawn <a href="#example-of-replacing-a-fish-script-using-spawn">#</a>
        
        
      </h4>
    

<p>Here’s a simple fish script that looks for the path to <code class="language-plaintext highlighter-rouge">linuxbrew</code> in <code class="language-plaintext highlighter-rouge">$HOME/.profile</code> so that GNOME
sessions can load it into their path. This is needed for processes that are spawned from GNOME shell
to be able to use Node.js that is installed using Linuxbrew.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env fish</span>

<span class="nb">set </span>searchString <span class="s2">"linuxbrew"</span>
<span class="nb">set </span>dotProfileFile <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.profile"</span>

<span class="k">function </span>_writeToDotProfileFile
  <span class="nb">echo</span> <span class="o">&gt;&gt;</span> <span class="nv">$dotProfileFile</span> <span class="s1">'
if [ -d "/home/linuxbrew/.linuxbrew" ] ; then
  PATH="/home/linuxbrew/.linuxbrew/bin:$PATH"
fi
'</span>
end

<span class="k">function </span>addLinuxbrewToGnomeSessionPath
  <span class="nb">set</span> <span class="nt">-l</span> grepResponse <span class="o">(</span><span class="nb">grep</span> <span class="nv">$searchString</span> <span class="nv">$dotProfileFile</span><span class="o">)</span>

  <span class="c"># echo "grepResponse: '$grepResponse'"</span>

  <span class="k">if </span><span class="nb">test</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$grepResponse</span><span class="s2">"</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$searchString</span><span class="s2"> found in </span><span class="nv">$dotProfileFile</span><span class="s2">, nothing to do."</span>
  <span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$searchString</span><span class="s2"> not found in </span><span class="nv">$dotProfileFile</span><span class="s2">, make sure to add it."</span>
    _writeToDotProfileFile
  end
end

<span class="k">if </span><span class="nb">test</span> <span class="o">(</span><span class="nb">uname</span><span class="o">)</span> <span class="o">=</span> <span class="s2">"Linux"</span>
  <span class="c"># This is Linux.</span>
  addLinuxbrewToGnomeSessionPath
<span class="k">else</span>
  <span class="c"># This is macOS.</span>
end
</code></pre></div></div>

<p>Now, here’s the equivalent script written in Node.js using <code class="language-plaintext highlighter-rouge">spawn()</code>.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">_also</span><span class="p">,</span> <span class="nx">ColorConsole</span><span class="p">,</span> <span class="nx">Optional</span><span class="p">,</span> <span class="nx">StyledColorConsole</span><span class="p">,</span> <span class="nx">Styles</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">r3bl-ts-utils</span><span class="dl">"</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">fs</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span>

<span class="cm">/**
 * Using constant object instead of enum (better choice here since it allows computed values).
 * More info:
 * - https://www.typescriptlang.org/docs/handbook/enums.html#objects-vs-enums
 * - https://blog.logrocket.com/const-assertions-are-the-killer-new-typescript-feature-b73451f35802/
 */</span>
<span class="kd">const</span> <span class="nx">MyConstants</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">gnomeDotProfileFile</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/.profile</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">linuxbrewSearchTerm</span><span class="p">:</span> <span class="dl">"</span><span class="s2">linuxbrew</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">defaultLinuxbrewPath</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/home/linuxbrew/.linuxbrew</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}</span> <span class="k">as</span> <span class="kd">const</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nc">SpawnCProcToReplaceFunctionalityOfFishScript</span> <span class="p">{</span>
  <span class="nx">run</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">isFound</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">doesGnomeProfileContainLinuxbrewPath</span><span class="p">()</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">isFound</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">green</span><span class="p">)(</span>
          <span class="s2">`Nothing to do, </span><span class="p">${</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">linuxbrewSearchTerm</span><span class="p">}</span><span class="s2"> is already in </span><span class="p">${</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">gnomeDotProfileFile</span><span class="p">}</span><span class="s2">`</span>
        <span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>
        <span class="k">return</span>
      <span class="p">}</span>
      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">addPathToGnomeProfileFile</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">red</span><span class="p">)(</span><span class="s2">`Error: </span><span class="p">${</span><span class="nx">e</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleError</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// https://nodesource.com/blog/understanding-streams-in-nodejs/</span>
  <span class="nx">doesGnomeProfileContainLinuxbrewPath</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">resolveFn</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">isFound</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nf">_also</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nf">createReadStream</span><span class="p">(</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">gnomeDotProfileFile</span><span class="p">),</span> <span class="p">(</span><span class="nx">it</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">it</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="nx">Buffer</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">isFound</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">linuxbrewSearchTerm</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="nx">it</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nf">resolveFn</span><span class="p">(</span><span class="nx">isFound</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="nx">it</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nf">rejectFn</span><span class="p">()</span>
        <span class="p">})</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">addPathToGnomeProfileFile</span> <span class="o">=</span> <span class="k">async </span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">overriddenLinuxbrewPath</span><span class="p">:</span> <span class="nx">Optional</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PATH</span><span class="p">?.</span><span class="nf">split</span><span class="p">(</span><span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">filter</span><span class="p">((</span><span class="nx">pathElement</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">pathElement</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">linuxbrewSearchTerm</span><span class="p">))</span>
      <span class="p">.</span><span class="nf">shift</span><span class="p">()</span>
    <span class="kd">const</span> <span class="na">linuxbrewPath</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="nx">overriddenLinuxbrewPath</span> <span class="o">??</span> <span class="nx">MyConstants</span><span class="p">.</span><span class="nx">defaultLinuxbrewPath</span>

    <span class="nx">StyledColorConsole</span><span class="p">.</span><span class="nc">Primary</span><span class="p">(</span><span class="s2">`linuxbrewPath: </span><span class="p">${</span><span class="nx">linuxbrewPath</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">snippetToAppend</span> <span class="o">=</span> <span class="s2">`if [ -d "</span><span class="p">${</span><span class="nx">linuxbrewPath</span><span class="p">}</span><span class="s2">" ] ; then
  PATH="</span><span class="p">${</span><span class="nx">linuxbrewPath</span><span class="p">}</span><span class="s2">/bin:$PATH"
fi`</span>

    <span class="nx">StyledColorConsole</span><span class="p">.</span><span class="nc">Primary</span><span class="p">(</span><span class="s2">`snippet: </span><span class="p">${</span><span class="nx">snippetToAppend</span><span class="p">}</span><span class="s2">`</span><span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">((</span><span class="nx">resolveFn</span><span class="p">,</span> <span class="nx">rejectFn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nf">appendFile</span><span class="p">(</span>
        <span class="nx">MyConstants</span><span class="p">.</span><span class="nx">gnomeDotProfileFile</span><span class="p">,</span>
        <span class="nx">snippetToAppend</span><span class="p">,</span>
        <span class="p">(</span><span class="na">err</span><span class="p">:</span> <span class="nx">NodeJS</span><span class="p">.</span><span class="nx">ErrnoException</span> <span class="o">|</span> <span class="kc">null</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">_onErr</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nf">rejectFn</span><span class="p">()</span>
            <span class="nx">ColorConsole</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="nx">Styles</span><span class="p">.</span><span class="nx">Primary</span><span class="p">.</span><span class="nx">red</span><span class="p">)(</span>
              <span class="s2">`Problem appending file </span><span class="p">${</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">gnomeDotProfileFile</span><span class="p">}</span><span class="s2">`</span>
            <span class="p">).</span><span class="nf">consoleError</span><span class="p">()</span>
          <span class="p">}</span>
          <span class="kd">const</span> <span class="nx">_onOk</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nf">resolveFn</span><span class="p">()</span>
            <span class="nx">StyledColorConsole</span><span class="p">.</span><span class="nc">Primary</span><span class="p">(</span>
              <span class="s2">`Appended file </span><span class="p">${</span><span class="nx">MyConstants</span><span class="p">.</span><span class="nx">gnomeDotProfileFile</span><span class="p">}</span><span class="s2">`</span>
            <span class="p">).</span><span class="nf">consoleLog</span><span class="p">()</span>
          <span class="p">}</span>
          <span class="nx">err</span> <span class="p">?</span> <span class="nf">_onErr</span><span class="p">()</span> <span class="p">:</span> <span class="nf">_onOk</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="k">new</span> <span class="nc">SpawnCProcToReplaceFunctionalityOfFishScript</span><span class="p">().</span><span class="nf">run</span><span class="p">()</span>
<span class="p">}</span>

<span class="nf">main</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
</code></pre></div></div>
      <h2 id="publishing-npm-packages">
        
        
          Publishing npm packages <a href="#publishing-npm-packages">#</a>
        
        
      </h2>
    

<ul>
  <li><a href="https://github.com/r3bl-org/r3bl-ts-utils">r3bl-ts-utils</a> - This repo is published on npm (<code class="language-plaintext highlighter-rouge">npm i r3bl-ts-utils</code>) and used in the code
here. The README contains instructions on how to publish a package and update it as well.</li>
  <li><a href="https://itnext.io/step-by-step-building-and-publishing-an-npm-typescript-package-44fe7164964c">Excellent tutorial on how to publish an npm package</a>.</li>
  <li><a href="https://stackoverflow.com/a/41285281/2085356"><code class="language-plaintext highlighter-rouge">.npmignore</code> and <code class="language-plaintext highlighter-rouge">files</code> directive in <code class="language-plaintext highlighter-rouge">package.json</code></a>.</li>
</ul>

        <!--
    Display all the categories for this page
    More info:
    - Tutorial - http://tinyurl.com/yc6fq6zx
    - Liquid language reference - http://tinyurl.com/y8s4qpwo
-->
<div class="categories-block">
    
    
    <span class="category">
            <a href="/category/Node">
                #node</a>
        </span>
    
    <span class="category">
            <a href="/category/Server">
                #server</a>
        </span>
    
    <span class="category">
            <a href="/category/TypeScript">
                #typescript</a>
        </span>
    
    <span class="category">
            <a href="/category/Web">
                #web</a>
        </span>
    
</div>

        
<blockquote>

📦 Install our useful Rust command line apps using <code>cargo install r3bl-cmdr</code>
(they are from the <a href="https://github.com/r3bl-org/r3bl-open-core">r3bl-open-core</a>
project):
<ul>
  <li>🐱<code>giti</code>: run interactive git commands with confidence in your terminal</li>
  <li>🦜<code>edi</code>: edit Markdown with style in your terminal</li>
</ul>

<p>
<kbd>giti in action</kbd>
<video width="100%" controls>
  <source src="https://github.com/nazmulidris/developerlife.com/assets/2966499/262f59d1-a95c-4af3-accf-c3d6cac6e586" type="video/mp4"/>
</video>
</p>

<p>
<kbd>edi in action</kbd>
<video width="100%" controls>
  <source src="https://github.com/nazmulidris/developerlife.com/assets/2966499/f2c4b07d-b5a2-4f41-af7a-06d1b6660c41" type="video/mp4"/>
</video>
</p>

</blockquote>

        <!--
    Display related posts (by category)
    More info:
    - Tutorial - http://tinyurl.com/j5tevq7
    - Liquid language reference - http://tinyurl.com/y9ru5msq
-->
<div class="related-post-block">

    <h3>Related Posts</h3>

    <!-- Get all the related posts into the string `postsString`-->
    
    
    

    <!--
        At this point `postsString` string might look like:
        Post 3|Post 1|Post 3|Post 2|Post 1|Post 3|Post 2|
    -->

    <!-- Remove all the dupes from the `postsString` string, and split it into an array -->
    

    <ul>
        
            
                
                <li>
                    <a class="post-list" href="/2021/11/25/ink-v3-advanced-ui-components/">
                        Reference handbook for using Ink v3.2.0 components (w/ React, Node.js and TypeScript)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/11/05/ink-v3-advanced/">
                        Advanced guide to Ink v3.2.0 (w/ React, Node.js and TypeScript)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/11/04/introduction-to-ink-v3/">
                        Introduction to Ink v3.2.0 (w/ React, Node.js and TypeScript)
                    </a>
                </li>
            
        
            
        
            
                
                <li>
                    <a class="post-list" href="/2024/05/15/tokio-tracing-otel-rust/">
                        Build with Naz : tokio tracing &amp; OTel and how to use it in Rust
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2024/04/28/rust-polymorphism-dyn-impl-trait-objects-for-testing-and-extensibiity/">
                        Build with Naz : Rust Polymorphism, dyn, impl, using existing traits, trait objects for testing and extensibility
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2024/04/21/build-async-interactive-cli-apps-in-rust/">
                        Build with Naz : Build interactive and non blocking CLI apps with ease in Rust using r3bl_terminal_async
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2024/01/13/write-simple-netcat-in-rust/">
                        Write a simple netcat client and server in Rust
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2024/01/13/write-simple-chat-server-in-rust/">
                        Write a simple TCP chat server in Rust
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2019/12/02/project-loom-experiment/">
                        Experimenting w/ Fibers in Project Loom preview
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2011/04/13/creating-asynchronous-servlets-with-tomcat-7-servlet-3-0-api/">
                        Creating asynchronous servlets with Tomcat 7 (Servlet 3.0 API)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2009/03/06/using-json-for-mobile-object-exchange/">
                        Using JSON for mobile object exchange
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2008/04/21/geocoding-tutorial-accessing-google-static-maps-from-java/">
                        Geocoding tutorial - Accessing Google Static Maps from Java
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2007/11/27/what-is-xml-an-introduction/">
                        What is XML? An introduction
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2000/09/20/advanced-threads/">
                        Advanced Threads
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/1998/12/01/xml-and-java-tutorial-part-1/">
                        XML and Java Tutorial, Part 1
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/10/19/react-hooks-redux-typescript-handbook/">
                        React hooks (v17.0.3) and Redux handbook using TypeScript (v4.3.4)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2021/10/19/css-responsive-design-handbook/">
                        CSS responsive design using Grid, Flexbox, and media queries handbook
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2016/10/06/getting-started-with-react-redux-and-firebase/">
                        Building a real world app using React, Redux, Firebase, and Typescript
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2016/10/02/getting-started-with-react-and-firebase/">
                        Building a real world app using React, Firebase, and Typescript
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2023/08/11/chrome-extension-shortlink/">
                        Build a Chrome Extension using Manifest V3
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2019/08/25/guide-to-building-responsive-web-apps/">
                        A pragmatic guide to designing and building responsive web applications
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2019/07/06/starter-project-typescript-karma-jasmine-webpack/">
                        TypeScript starter project w/ Webpack 4, Karma, Jasmine
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2018/08/22/vue-vueitfy-webpack/">
                        Vue.js, Webpack, Vueitify, Electron, and vue-cli
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2018/08/15/introduction-to-vue/">
                        Getting started with Vue.js
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/11/15/flexbox-getting-started-part-1-2/">
                        Flexbox: Getting started (Part 1/2)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/11/14/flexbox-building-a-navigation-bar-part-2-2/">
                        Flexbox: Building a navigation bar (Part 2/2)
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/07/19/loading-csv-files-in-javascript-and-node/">
                        Loading CSV files in Node
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2017/04/26/flexbox-layouts-and-lists-with-react-native/">
                        Flexbox layouts and lists with React Native
                    </a>
                </li>
            
        
            
                
                <li>
                    <a class="post-list" href="/2016/10/12/firebase-presence/">
                        Using Firebase for user presence tracking
                    </a>
                </li>
            
        
    </ul>

</div>

        <a class="u-url" href="/2021/07/02/nodejs-typescript-handbook/" hidden></a>
    </div></article>
</div>
      </main><div>
  <section class="sidebar">
    <h2 class="star-us-github-heading">
      Subscribe to our Rust live coding
      <a href="https://www.youtube.com/@developerlifecom">YouTube Channel</a
      ><span class="heading-emoji"> 🦀</span>
    </h2>

    <!-- video on intro to testing (with playlist) -->
    <!-- <iframe
      src="https://www.youtube.com/embed/videoseries?si=7gmhXY5DVYJG7OdU&amp;list=PLofhE49PEwmwLR_4Noa0dFOSPmSpIg_l8"
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
    >
    </iframe> -->

    <!-- rust async readline and spinner & playlist -->
    <!-- <iframe
      src="https://www.youtube.com/embed/videoseries?si=i37Ei9nCfvslOoaI&amp;list=PLofhE49PEwmwelPkhfiqdFQ9IXnmGdnSE"
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin"
      allowfullscreen
    >
    </iframe> -->

  <!-- rust tokio tracing and otel for async rust & playlist -->
  <iframe
    src="https://www.youtube.com/embed/Wf8JrLgBuKI?si=cmLaUWs-pbJ39lLc"
    title="YouTube video player"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen>
  </iframe>

    <br />
    <br />

    <h2 class="star-us-github-heading">
      Use our extensions, apps, binary and library crates<span class="heading-emoji"> 📦</span>
    </h2>

    <ul class="sidebar-ul">
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/cmdr" target="_blank">
          <img class="star-icon-img" src="/assets/r3bl-apps.svg" />
          <div class="sidebar-list-item">
            <p class="p-tag">INSTALL & USE OUR APPS (giti, edi)</p>
            <h3 class="sidebar-h3"><code>r3bl-cmdr</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/shortlink" target="_blank">
          <img class="star-icon-img" src="/assets/r3bl-shortlink.svg" />
          <div class="sidebar-list-item">
            <p class="p-tag">SHORTLINK browser extension</p>
            <h3 class="sidebar-h3"><code>shortlink</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tui" target="_blank">
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TUI LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_tui</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a href="https://github.com/r3bl-org/r3bl-open-core/tree/main/tuify" target="_blank">
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TUIFY LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_tuify</code></h3>
          </div>
        </a>
      </li>
      <li class="app-container">
        <a
          href="https://github.com/r3bl-org/r3bl-open-core/tree/main/terminal_async"
          target="_blank"
        >
          <img class="star-icon-img" src="/assets/crate.png" />
          <div class="sidebar-list-item">
            <p class="p-tag">R3BL TERMINAL ASYNC LIB</p>
            <h3 class="sidebar-h3"><code>r3bl_terminal_async</code></h3>
          </div>
        </a>
      </li>
    </ul>

    <br />

    <h2 class="star-us-github-heading">
      Join our <a href="https://discord.gg/PhuF4qFpcA">Discord</a>
      <span class="heading-emoji"> 💬</span>
    </h2>
  </section>
</div>
</div><footer class="site-footer h-card">

    <div class="wrapper">

        <div class="footer-col-wrapper">

            <div class="footer-col"><!-- <p>
    developerlife.com site was started in Nov 1998 with coverage for
    topics related to Java, XML, and web and desktop technologies.
    Today it covers Kotlin, TypeScript, Node.js, React, Android, JDK,
    Web, Cloud technologies, User Experience Engineering (UXE)
    and design topics. © Nazmul Idris 2022. All rights reserved.
</p> -->
<div>
  <p class="footer-p">
    developerlife.com site was started in Nov 1998 by <a href="https://developerlife.com/about-me/">Nazmul Idris</a>, with coverage for topics related to Java, XML,
    and web and desktop technologies. Today it covers Rust, TUI, CLI, Kotlin, TypeScript, Node.js, React, Android,
    JDK, Web, Cloud technologies, User Experience Engineering (UXE) and design topics. © Nazmul
    Idris 2022. All rights reserved.
  </p>
  <div class="footer-container">
    <!-- element 1 -->
    <kbd>
      <a class="footer-elem-1" href="/subscribe.html" target="_blank"
        >Subscribe for updates</a
      >
    </kbd>

    <!-- element 2 -->
    <kbd>
      <a class="footer-elem-2" href="https://r3bl.com" target="_blank">Sponsored by R3BL</a>
    </kbd>
  </div>
</div>
</div>

        </div>

    </div>

</footer>
<script>
//open external links in a new window
function external_new_window() {
    for(var c = document.getElementsByTagName("a"), a = 0;a < c.length;a++) {
    var b = c[a];
    b.getAttribute("href") && b.hostname !== location.hostname && (b.target = "_blank")
    }
}
//open PDF links in a new window
function pdf_new_window ()
{
    if (!document.getElementsByTagName) return false;
    var links = document.getElementsByTagName("a");
    for (var eleLink=0; eleLink < links.length; eleLink ++) {
    if ((links[eleLink].href.indexOf('.pdf') !== -1)||(links[eleLink].href.indexOf('.doc') !== -1)||(links[eleLink].href.indexOf('.docx') !== -1)) {
        links[eleLink].onclick =
        function() {
            window.open(this.href);
            return false;
        }
    }
    }
} 
pdf_new_window()
external_new_window();
</script></body>
</html>
