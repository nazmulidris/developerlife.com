---
title: "Use just to manage project specific commands"
author: Nazmul Idris
date: 2023-08-28 15:00:00+00:00
excerpt: |
  A guide on how to create just files (which are like make files)
  to manage project specific commands. In a cross platform way.
layout: post
categories:
  - Rust
  - CLI
---

<img class="post-hero-image" src="{{ 'assets/justfile.svg' | relative_url }}"/>

<!-- TOC -->

- [Introduction](#introduction)
- [Prerequisites](#prerequisites)
- [Basic usage](#basic-usage)
- [Advanced usage](#advanced-usage)
  - [Run on Windows](#run-on-windows)
  - [Pass arguments into commands](#pass-arguments-into-commands)
- [Next steps](#next-steps)

<!-- /TOC -->

## Introduction
<a id="markdown-introduction" name="introduction"></a>


In this tutorial we will learn how to use [`just`](https://github.com/casey/just) by example to
manage project specific commands. `just` is like `make`, but it is written in Rust, and it works
with `cargo`.

Before we get started, please take a look at the
[`just` project README](https://github.com/casey/just).

> ðŸš€ Please star and fork / clone the
> [r3bl_ansi_color repo](https://github.com/r3bl-org/r3bl_ansi_color) ðŸŒŸ.
> We will use this repo as
> an example to learn how to use `just` to manage project specific commands.

## Prerequisites
<a id="markdown-prerequisites" name="prerequisites"></a>


ðŸŒ  In order for our `just` file to work, we must first install the Rust toolchain and `just` and
`cargo-watch`:

1. Install the Rust toolchain using `rustup` by following the instructions
   [here](https://rustup.rs/).
1. Install `cargo-watch` using `cargo install cargo-watch`.
1. Install `flamegraph` using `cargo install flamegraph`.
1. [Install](https://just.systems/man/en/chapter_4.html) `just` on your system using
   `cargo install just`. It is available for Linux, macOS, and Windows.
   - If you want shell completions for `just` you can follow
     [these instructions](https://github.com/casey/just#shell-completion-scripts).
   - If you install `just` using `cargo install just` or `brew install just` you will not get shell
     completions without doing one extra configuration step. So on Linux it is best to use
     `sudo apt install -y just` if you want them.

## Basic usage
<a id="markdown-basic-usage" name="basic-usage"></a>

For Rust projects, typically we will have a build, run, test project specific commands. Let's start
with these simple ones first. The benefit of `just` is that we can use it to run these commands on
any platform (Linux, Mac, Windows). And we don't need to create OS or shell specific scripts to do
this ðŸŽ‰.

Let's start by creating a `justfile` in the root of our project. The `justfile` is where we will
define our project specific commands. Here is what it looks like for the
[`r3bl_ansi_color` repo](https://github.com/r3bl-org/r3bl_ansi_color/blob/main/justfile):

```text
build:
  cargo build

clean:
  cargo clean

run:
  cargo run --example main
```

These are pretty simple commands. The syntax is pretty simple. The first line is the command name.
And the second line is the command to run. The command can be a single command or a series of
commands.

Now in order to run this, we can just run `just --list` in the root of our project. And it will show
us the list of commands that we can run.

```bash
$ just --list
Available recipes:
    build
    clean
    run
```

Then to run a command, we can just run `just <command_name>`. For example, to run the `build`
command, we can run `just build`.

```bash
$ just build
```

## Advanced usage
<a id="markdown-advanced-usage" name="advanced-usage"></a>

We will demonstrate two advanced use cases:

1. Using a shell that is not the default shell. This is useful for running `just` commands on
   Windows.
1. Passing arguments into `just` commands.

### Run on Windows
<a id="markdown-run-on-windows" name="run-on-windows"></a>

Currently our `justfile` will run on Linux and macOS. To make it run on Windows, we have to add
another line to it.

```bash
# https://just.systems/man/en/chapter_25.html?highlight=windows#settings
# On Windows, use powershell, otherwise use sh.
set windows-shell := ["powershell.exe", "-c"]
```

On macOS and Linux this will be ignored. But on Windows, it will use PowerShell to run the commands.
The `windows-shell` is a variable that is sell in the context of the `justfile`. The `:=` is the
assignment operator. And the `["powershell.exe", "-c"]` is an array of strings that will be used to
run the commands.

### Pass arguments into commands
<a id="markdown-pass-arguments-into-commands" name="pass-arguments-into-commands"></a>

We can also pass arguments into our commands. Let's say that we have a command that we can use to
run a single test. We can pass the name of the test into the command. Here is what it looks like:

```bash
watch-one-test test_name:
  # More info on cargo test: https://doc.rust-lang.org/cargo/commands/cargo-test.html
  # More info on cargo watch: https://github.com/watchexec/cargo-watch
  cargo watch -x check -x 'test -- --test-threads=1 --nocapture {{test_name}}' -c -q
```

There are a few things to note here:

1. The syntax to name the command is still the same as before.
1. However, we have added another string after the command name, which is the argument name
   `test_name`. If an argument is not passed in then `just` will display an error and print a
   message stating that an argument is required.
1. This argument is used just like a variable would in a `justfile`. The `{{` and `}}` enclose a
   variable name.

Now we can run this command by passing in the name of the test that we want to run. For example, if
we want to run the `test_ansi_color` test, we can run `just watch-one-test test_ansi_color`.

```bash
$ just watch-one-test bold
```

Here's an example of a `justfile` that has a lot more commands for you to look at:
[r3bl_ansi_color justfile](https://github.com/r3bl-org/r3bl_ansi_color/blob/main/justfile).

## Next steps
<a id="markdown-next-steps" name="next-steps"></a>


The `just` project [README](https://github.com/casey/just) has lots of information on how to use
`just`. It is best to have a specific thing you are looking for before you visit this page. Here are
some interesting links inside the README:

1. [Command line arguments](https://github.com/casey/just#recipe-parameters).
1. [Support for .env files](https://github.com/casey/just#dotenv-integration).
1. [Conditional expressions](https://github.com/casey/just#conditional-expressions).
1. [Setting variables](https://github.com/casey/just#setting-variables-from-the-command-line).

> ðŸš€ Please star and fork / clone the
> [r3bl_ansi_color repo](https://github.com/r3bl-org/r3bl_ansi_color) ðŸŒŸ.
> We will use this repo as
> an example to learn how to use `just` to manage project specific commands.

If you would like to get involved in an open source project and like Rust crates, please feel free
to contribute to the [r3bl_ansi_color repo](https://github.com/r3bl-org/r3bl_ansi_color). There are
a lot of small features that need to be added. And they can be a nice stepping stone into the world
of open source contribution ðŸŽ‰.
